<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Apply hazard ratios to reference curves – &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exeter Oncology Model: Renal Cell Carcinoma edition</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-52e9b796d18e6b1858fb23b0c5e2bf64.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/exeter_pentag_small.png" alt="Exeter PenTAG" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exeter Oncology Model: Renal Cell Carcinoma edition</span>
    </a>
  </div>
          <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/nice-digital/NICE-model-repo/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
            <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../pages/walkthrough_preface.html">Code walkthrough</a></li><li class="breadcrumb-item"><a href="../../pages/walkthrough/code3_hr.html">Apply hazard ratios to reference curves</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/acronyms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acryonyms</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Context</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/appraisals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NICE appraisals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/publication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">List of articles and reports</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Model overview</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/model_overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Detailed summary</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/plain_english.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Plain english summary</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Installation</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Code walkthrough</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/walkthrough_preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/input_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Input data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/walkthrough/code1_setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Set-up</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/walkthrough/code2_extrapolate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Extrapolate reference curves</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/walkthrough/code3_hr.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Apply hazard ratios to reference curves</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/walkthrough/code4_prep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prepare other data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/walkthrough/code5_model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Economic modelling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/report.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Report</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/probabilistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/scenarios.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Scenario analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/license.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Licence</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/citation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Citation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/changelog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Changelog</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#import-and-process-results-of-proportional-hazards-nma-ph-nma" id="toc-import-and-process-results-of-proportional-hazards-nma-ph-nma" class="nav-link active" data-scroll-target="#import-and-process-results-of-proportional-hazards-nma-ph-nma">Import and process results of proportional hazards NMA (PH NMA)</a>
  <ul class="collapse">
  <li><a href="#import-results" id="toc-import-results" class="nav-link" data-scroll-target="#import-results">Import results</a></li>
  <li><a href="#set-3l-to-2l-and-ttd-and-ttp-to-pfs" id="toc-set-3l-to-2l-and-ttd-and-ttp-to-pfs" class="nav-link" data-scroll-target="#set-3l-to-2l-and-ttd-and-ttp-to-pfs">Set 3L to 2L, and TTD and TTP to PFS</a></li>
  <li><a href="#find-mean-hrs" id="toc-find-mean-hrs" class="nav-link" data-scroll-target="#find-mean-hrs">Find mean HRs</a></li>
  </ul></li>
  <li><a href="#import-and-process-results-of-fractional-polynomial-nma-fp-nma" id="toc-import-and-process-results-of-fractional-polynomial-nma-fp-nma" class="nav-link" data-scroll-target="#import-and-process-results-of-fractional-polynomial-nma-fp-nma">Import and process results of fractional polynomial NMA (FP NMA)</a>
  <ul class="collapse">
  <li><a href="#import-results-1" id="toc-import-results-1" class="nav-link" data-scroll-target="#import-results-1">Import results</a></li>
  <li><a href="#set-cabozantinib-as-reference" id="toc-set-cabozantinib-as-reference" class="nav-link" data-scroll-target="#set-cabozantinib-as-reference">Set cabozantinib as reference</a></li>
  <li><a href="#set-3l-to-2l" id="toc-set-3l-to-2l" class="nav-link" data-scroll-target="#set-3l-to-2l">Set 3L to 2L</a></li>
  <li><a href="#find-unique-combinations" id="toc-find-unique-combinations" class="nav-link" data-scroll-target="#find-unique-combinations">Find unique combinations</a></li>
  <li><a href="#duplicate-results-with-rwe-as-reference-trial" id="toc-duplicate-results-with-rwe-as-reference-trial" class="nav-link" data-scroll-target="#duplicate-results-with-rwe-as-reference-trial">Duplicate results with RWE as reference trial</a></li>
  <li><a href="#copy-into-p" id="toc-copy-into-p" class="nav-link" data-scroll-target="#copy-into-p">Copy into p</a></li>
  </ul></li>
  <li><a href="#create-nested-list-with-ph-nma-and-fp-nma-results" id="toc-create-nested-list-with-ph-nma-and-fp-nma-results" class="nav-link" data-scroll-target="#create-nested-list-with-ph-nma-and-fp-nma-results">Create nested list with PH NMA and FP NMA results</a>
  <ul class="collapse">
  <li><a href="#set-up-empty-list" id="toc-set-up-empty-list" class="nav-link" data-scroll-target="#set-up-empty-list">Set-up empty list</a></li>
  <li><a href="#create-numeric-trial-column-in-ir_table_eff_data_settings" id="toc-create-numeric-trial-column-in-ir_table_eff_data_settings" class="nav-link" data-scroll-target="#create-numeric-trial-column-in-ir_table_eff_data_settings">Create numeric trial column in <code>i$R_table_eff_data_settings</code></a></li>
  <li><a href="#add-nma-hrs" id="toc-add-nma-hrs" class="nav-link" data-scroll-target="#add-nma-hrs">Add NMA HRs</a></li>
  </ul></li>
  <li><a href="#add-more-assumption-based-hrs" id="toc-add-more-assumption-based-hrs" class="nav-link" data-scroll-target="#add-more-assumption-based-hrs">Add more “assumption-based” HRs</a></li>
  <li><a href="#apply-hrs-to-the-extrapolated-rwe-survival-times" id="toc-apply-hrs-to-the-extrapolated-rwe-survival-times" class="nav-link" data-scroll-target="#apply-hrs-to-the-extrapolated-rwe-survival-times">Apply HRs to the extrapolated RWE survival times</a></li>
  <li><a href="#apply-modifications-to-the-survival-times" id="toc-apply-modifications-to-the-survival-times" class="nav-link" data-scroll-target="#apply-modifications-to-the-survival-times">Apply modifications to the survival times</a>
  <ul class="collapse">
  <li><a href="#prior-adjuvant-treatments" id="toc-prior-adjuvant-treatments" class="nav-link" data-scroll-target="#prior-adjuvant-treatments">Prior adjuvant treatments</a></li>
  <li><a href="#effect-waning" id="toc-effect-waning" class="nav-link" data-scroll-target="#effect-waning">Effect waning</a></li>
  <li><a href="#general-population-mortality" id="toc-general-population-mortality" class="nav-link" data-scroll-target="#general-population-mortality">General population mortality</a></li>
  <li><a href="#curve-overlap" id="toc-curve-overlap" class="nav-link" data-scroll-target="#curve-overlap">Curve overlap</a></li>
  <li><a href="#set-5l-to-4l" id="toc-set-5l-to-4l" class="nav-link" data-scroll-target="#set-5l-to-4l">Set 5L to 4L</a></li>
  </ul></li>
  <li><a href="#view-the-generated-curves" id="toc-view-the-generated-curves" class="nav-link" data-scroll-target="#view-the-generated-curves">View the generated curves</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/nice-digital/NICE-model-repo/edit/main/pages/walkthrough/code3_hr.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/nice-digital/NICE-model-repo/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../pages/walkthrough_preface.html">Code walkthrough</a></li><li class="breadcrumb-item"><a href="../../pages/walkthrough/code3_hr.html">Apply hazard ratios to reference curves</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Apply hazard ratios to reference curves</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>On this page, the hazard ratios (HR) from some pre-run network meta-analyses (NMA) are applied to the extrapolated RWE survival curves generated on the previous page.</p>
<section id="import-and-process-results-of-proportional-hazards-nma-ph-nma" class="level2">
<h2 class="anchored" data-anchor-id="import-and-process-results-of-proportional-hazards-nma-ph-nma">Import and process results of proportional hazards NMA (PH NMA)</h2>
<section id="import-results" class="level3">
<h3 class="anchored" data-anchor-id="import-results">Import results</h3>
<p>Import results from the PH NMA, as described in <a href="../../pages/input_data.html">Input data</a>. The code chunk sets new column names for the result table, and creates a duplicate of the <code>Endpoint</code> column called <code>Reference.endpoint</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.3.5 Comparative efficacy propagation (NMA) ---------------------------------------------------------------</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Pull in the data and calculate means by pop line mol endpoint reftrt and reftrial</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># First read in RDS file containing the PH NMA coda samples</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.3.5.1.1 PH NMA data -----------------------------------------------------</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Option to read in PH NMA CODA from local machine, uncomment this and comment out the line below to use</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>RDS_path2 <span class="ot">&lt;-</span> <span class="fu">file.path</span>(d_path, <span class="st">"PH_NMA_CODA.rds"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(RDS_path2)) {</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  i<span class="sc">$</span>PHNMA <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(RDS_path2)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  i<span class="sc">$</span>PHNMA <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(rstudioapi<span class="sc">::</span><span class="fu">selectFile</span>(</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Please select 'PH_NMA_CODA.rds'"</span>,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"PH_NMA_CODA.rds"</span>,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="st">"./1_Data/"</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">filter =</span> <span class="st">"R Files (*.rds)"</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">existing =</span> <span class="cn">TRUE</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(i<span class="sc">$</span>PHNMA<span class="sc">$</span>data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Run"</span>, <span class="st">"Population"</span>, <span class="st">"Line"</span>, <span class="st">"Molecule"</span>, <span class="st">"Endpoint"</span>, <span class="st">"Reference.treatment"</span>, <span class="st">"Reference.trial"</span>, <span class="st">"HR"</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>PHNMA<span class="sc">$</span>data<span class="sc">$</span>Reference.endpoint <span class="ot">&lt;-</span> i<span class="sc">$</span>PHNMA<span class="sc">$</span>data<span class="sc">$</span>Endpoint</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
View <code>i$PHNMA$data</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(i<span class="sc">$</span>PHNMA<span class="sc">$</span>data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 3%">
<col style="width: 10%">
<col style="width: 4%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 19%">
<col style="width: 15%">
<col style="width: 9%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Run</th>
<th style="text-align: right;">Population</th>
<th style="text-align: right;">Line</th>
<th style="text-align: right;">Molecule</th>
<th style="text-align: right;">Endpoint</th>
<th style="text-align: right;">Reference.treatment</th>
<th style="text-align: right;">Reference.trial</th>
<th style="text-align: right;">HR</th>
<th style="text-align: right;">Reference.endpoint</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.8958580</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.7821468</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.4324613</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.7571763</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9492596</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.8561836</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="set-3l-to-2l-and-ttd-and-ttp-to-pfs" class="level3">
<h3 class="anchored" data-anchor-id="set-3l-to-2l-and-ttd-and-ttp-to-pfs">Set 3L to 2L, and TTD and TTP to PFS</h3>
<p>This sections implements some assumptions where we the relative effectiveness of one group/endpoint is assumed to apply to another.</p>
<p><strong>2L and 3L</strong>: The effectiveness of 3L treatments is assumed to be equal to their effectiveness at 2L, so it simply copies the data the effectiveness data from 2L (<code>i$PHNMA$data[Line==2,]</code>) but replaces the <code>Line</code> with <code>3</code> and appends it to the main data table (<code>i$PHNMA$data</code>).</p>
<p><strong>PFS, TTD and TTP</strong>: The time to treatment discontinuation (TTD) and time to progression (TTP) HRs are assumed to be equal to the HR for progression-free survival (PFS). If we refer to the endpoint look-up table, we can see that PFS is endpoint 1, then TTD is 2 and TTP is 3. Hence, in the code below, the PFS results (<code>i$PHNMA$data[Endpoint==1,]</code>) are simply copied, but with the endpoint replaced with 2 or 3, before appending it back to the main data table.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
View endpoint lookup table
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>lookup<span class="sc">$</span>ipd<span class="sc">$</span>endpoint</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

</div>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>PHNMA<span class="sc">$</span>assume3L      <span class="ot">&lt;-</span> i<span class="sc">$</span>PHNMA<span class="sc">$</span>data[Line<span class="sc">==</span><span class="dv">2</span>,]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>PHNMA<span class="sc">$</span>assume3L<span class="sc">$</span>Line <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>PHNMA<span class="sc">$</span>data         <span class="ot">&lt;-</span> <span class="fu">rbind</span>(i<span class="sc">$</span>PHNMA<span class="sc">$</span>data,i<span class="sc">$</span>PHNMA<span class="sc">$</span>assume3L)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>PHNMA<span class="sc">$</span>assumeTTD <span class="ot">&lt;-</span> i<span class="sc">$</span>PHNMA<span class="sc">$</span>data[Endpoint<span class="sc">==</span><span class="dv">1</span>,]</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>PHNMA<span class="sc">$</span>assumeTTD<span class="sc">$</span>Endpoint <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>PHNMA<span class="sc">$</span>data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(i<span class="sc">$</span>PHNMA<span class="sc">$</span>data,i<span class="sc">$</span>PHNMA<span class="sc">$</span>assumeTTD)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>PHNMA<span class="sc">$</span>assumeTTP <span class="ot">&lt;-</span> i<span class="sc">$</span>PHNMA<span class="sc">$</span>data[Endpoint<span class="sc">==</span><span class="dv">1</span>,]</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>PHNMA<span class="sc">$</span>assumeTTP<span class="sc">$</span>Endpoint <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>PHNMA<span class="sc">$</span>data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(i<span class="sc">$</span>PHNMA<span class="sc">$</span>data,i<span class="sc">$</span>PHNMA<span class="sc">$</span>assumeTTP)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
View <code>i$PHNMA$data</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>To view are implemented assumptions we can, for example, look at the results from 2L and 3L, and see that they are the same:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(i<span class="sc">$</span>PHNMA<span class="sc">$</span>data[i<span class="sc">$</span>PHNMA<span class="sc">$</span>data<span class="sc">$</span>Line<span class="sc">==</span><span class="dv">2</span>,]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 3%">
<col style="width: 10%">
<col style="width: 4%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 19%">
<col style="width: 15%">
<col style="width: 9%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Run</th>
<th style="text-align: right;">Population</th>
<th style="text-align: right;">Line</th>
<th style="text-align: right;">Molecule</th>
<th style="text-align: right;">Endpoint</th>
<th style="text-align: right;">Reference.treatment</th>
<th style="text-align: right;">Reference.trial</th>
<th style="text-align: right;">HR</th>
<th style="text-align: right;">Reference.endpoint</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.8940210</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.6664276</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.8515765</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.6339945</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">999</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.4503489</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.9477019</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(i<span class="sc">$</span>PHNMA<span class="sc">$</span>data[i<span class="sc">$</span>PHNMA<span class="sc">$</span>data<span class="sc">$</span>Line<span class="sc">==</span><span class="dv">3</span>,]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 3%">
<col style="width: 10%">
<col style="width: 4%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 19%">
<col style="width: 15%">
<col style="width: 9%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Run</th>
<th style="text-align: right;">Population</th>
<th style="text-align: right;">Line</th>
<th style="text-align: right;">Molecule</th>
<th style="text-align: right;">Endpoint</th>
<th style="text-align: right;">Reference.treatment</th>
<th style="text-align: right;">Reference.trial</th>
<th style="text-align: right;">HR</th>
<th style="text-align: right;">Reference.endpoint</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.8940210</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.6664276</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.8515765</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.6339945</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">999</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.4503489</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.9477019</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="find-mean-hrs" class="level3">
<h3 class="anchored" data-anchor-id="find-mean-hrs">Find mean HRs</h3>
<p>The mean HR by population, line, molecule, endpoint, reference treatment and reference trial are calculated.</p>
<p>These are then add to <code>p</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean from the CODA samples for deterministic analysis</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>PHNMA<span class="sc">$</span>means <span class="ot">&lt;-</span> i<span class="sc">$</span>PHNMA<span class="sc">$</span>data[,.(<span class="at">HR =</span> <span class="fu">mean</span>(HR)),by<span class="ot">=</span><span class="fu">list</span>(Population,Line,Molecule,Endpoint,Reference.treatment,Reference.trial)]</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.3.5.1.2 DETERMINISTIC CODA --------------------------------------------</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># for the deterministic analysis we use the means. </span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>releff<span class="sc">$</span>CODA<span class="sc">$</span>PH <span class="ot">&lt;-</span> i<span class="sc">$</span>PHNMA<span class="sc">$</span>means</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
View <code>i$PHNMA$means</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(i<span class="sc">$</span>PHNMA<span class="sc">$</span>means))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 6%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 25%">
<col style="width: 20%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Population</th>
<th style="text-align: right;">Line</th>
<th style="text-align: right;">Molecule</th>
<th style="text-align: right;">Endpoint</th>
<th style="text-align: right;">Reference.treatment</th>
<th style="text-align: right;">Reference.trial</th>
<th style="text-align: right;">HR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.7935352</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.7033510</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.8178626</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.7226217</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9224925</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.7946571</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="import-and-process-results-of-fractional-polynomial-nma-fp-nma" class="level2">
<h2 class="anchored" data-anchor-id="import-and-process-results-of-fractional-polynomial-nma-fp-nma">Import and process results of fractional polynomial NMA (FP NMA)</h2>
<section id="import-results-1" class="level3">
<h3 class="anchored" data-anchor-id="import-results-1">Import results</h3>
<p>Import results from the FP NMA, as described in <a href="../../pages/input_data.html">Input data</a>. The code chunk sets new column names for the result table, and converts the time from weeks to month (<code>*52</code> as 52 weeks per year, then <code>/12</code> to get months).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.3.5.2.1 FP NMA data -----------------------------------------------------</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in FP NMA data</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>FPNMA <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#read in means for deterministic and PSA parameters for probabilistic</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># option to read in from local machine, uncomment the below and comment out line 949 to use</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>RDS_path3 <span class="ot">&lt;-</span> <span class="fu">file.path</span>(d_path, <span class="st">"FPNMA_means.rds"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(RDS_path3)) {</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  i<span class="sc">$</span>FPNMA<span class="sc">$</span>means  <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(RDS_path3)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  i<span class="sc">$</span>FPNMA<span class="sc">$</span>means <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(rstudioapi<span class="sc">::</span><span class="fu">selectFile</span>(</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Load in FP NMA CODA (FPNMA_means.rds)"</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">"FPNMA_means.rds"</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">path =</span> <span class="st">"./1_Data/"</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">filter =</span> <span class="st">"R Files (*.rds)"</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">existing =</span> <span class="cn">TRUE</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">#tidy means column names and timing</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(i<span class="sc">$</span>FPNMA<span class="sc">$</span>means)[<span class="fu">colnames</span>(i<span class="sc">$</span>FPNMA<span class="sc">$</span>means) <span class="sc">==</span> <span class="st">"intervention_code"</span>] <span class="ot">&lt;-</span> <span class="st">"Molecule"</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(i<span class="sc">$</span>FPNMA<span class="sc">$</span>means)[<span class="fu">colnames</span>(i<span class="sc">$</span>FPNMA<span class="sc">$</span>means) <span class="sc">==</span> <span class="st">"reference_treatment_code"</span>] <span class="ot">&lt;-</span> <span class="st">"Reference.treatment"</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(i<span class="sc">$</span>FPNMA<span class="sc">$</span>means)[<span class="fu">colnames</span>(i<span class="sc">$</span>FPNMA<span class="sc">$</span>means) <span class="sc">==</span> <span class="st">"ref_trial_code"</span>] <span class="ot">&lt;-</span> <span class="st">"Reference.trial"</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(i<span class="sc">$</span>FPNMA<span class="sc">$</span>means)[<span class="fu">colnames</span>(i<span class="sc">$</span>FPNMA<span class="sc">$</span>means) <span class="sc">==</span> <span class="st">"population"</span>] <span class="ot">&lt;-</span> <span class="st">"Population"</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(i<span class="sc">$</span>FPNMA<span class="sc">$</span>means)[<span class="fu">colnames</span>(i<span class="sc">$</span>FPNMA<span class="sc">$</span>means) <span class="sc">==</span> <span class="st">"line"</span>] <span class="ot">&lt;-</span> <span class="st">"Line"</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(i<span class="sc">$</span>FPNMA<span class="sc">$</span>means)[<span class="fu">colnames</span>(i<span class="sc">$</span>FPNMA<span class="sc">$</span>means) <span class="sc">==</span> <span class="st">"endpoint"</span>] <span class="ot">&lt;-</span> <span class="st">"Endpoint"</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(i<span class="sc">$</span>FPNMA<span class="sc">$</span>means)[<span class="fu">colnames</span>(i<span class="sc">$</span>FPNMA<span class="sc">$</span>means) <span class="sc">==</span> <span class="st">"V1"</span>] <span class="ot">&lt;-</span> <span class="st">"HR"</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>FPNMA<span class="sc">$</span>means<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">round</span>(i<span class="sc">$</span>FPNMA<span class="sc">$</span>means<span class="sc">$</span>time <span class="sc">*</span> <span class="dv">52</span> <span class="sc">/</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
View <code>i$FPNMA$means</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(i<span class="sc">$</span>FPNMA<span class="sc">$</span>means))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 5%">
<col style="width: 10%">
<col style="width: 23%">
<col style="width: 5%">
<col style="width: 10%">
<col style="width: 12%">
<col style="width: 18%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">time</th>
<th style="text-align: right;">Molecule</th>
<th style="text-align: right;">Reference.treatment</th>
<th style="text-align: right;">Line</th>
<th style="text-align: right;">Endpoint</th>
<th style="text-align: right;">Population</th>
<th style="text-align: right;">Reference.trial</th>
<th style="text-align: right;">HR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6.0866273</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.7948374</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.6307802</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.6127038</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.6141338</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.6184885</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="set-cabozantinib-as-reference" class="level3">
<h3 class="anchored" data-anchor-id="set-cabozantinib-as-reference">Set cabozantinib as reference</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># means</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Rebasing to allow use of cabo as reference treatment in 2nd line</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># repeats for means (stored in i which are later transferred to p) </span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>FPNMA<span class="sc">$</span>means <span class="ot">&lt;-</span> <span class="fu">f_rebase_for_cabo_as_ref_in_2L</span>(<span class="at">FPNMAdata =</span> i<span class="sc">$</span>FPNMA<span class="sc">$</span>means)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the now redundant objects we made in order to do this</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="set-3l-to-2l" class="level3">
<h3 class="anchored" data-anchor-id="set-3l-to-2l">Set 3L to 2L</h3>
<p>As implemented for PH NMA, the HRs for 3L are assumed to be the same as at 2L, and this is implemented here using <code>f_3L_rel_effect_same_as_2L()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>FPNMA<span class="sc">$</span>means <span class="ot">&lt;-</span> <span class="fu">f_3L_rel_effect_same_as_2L</span>(<span class="at">FPNMAdata =</span> i<span class="sc">$</span>FPNMA<span class="sc">$</span>means) </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="find-unique-combinations" class="level3">
<h3 class="anchored" data-anchor-id="find-unique-combinations">Find unique combinations</h3>
<p><code>f_gen_destinations()</code> finds unique combinations of population, line, molecule, endpoint, reference treatment and reference trial. A duplicate version of these results is made where the referebce.trial is set to 2 (real-world evidence (RWE)). These are combined and saved as <code>i$FPNMA$destinations</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 1 row for each destination PLMTE, so that we know where to put the</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># fp data without having to iterate much</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>FPNMA<span class="sc">$</span>destinations <span class="ot">&lt;-</span> <span class="fu">f_gen_destinations</span>(<span class="at">fp_data =</span> i<span class="sc">$</span>FPNMA<span class="sc">$</span>means)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
View <code>i$FPNMA$destinations</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(i<span class="sc">$</span>FPNMA<span class="sc">$</span>destinations))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 15%">
<col style="width: 7%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 28%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Population</th>
<th style="text-align: right;">Line</th>
<th style="text-align: right;">Molecule</th>
<th style="text-align: right;">Endpoint</th>
<th style="text-align: right;">Reference.treatment</th>
<th style="text-align: right;">Reference.trial</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="duplicate-results-with-rwe-as-reference-trial" class="level3">
<h3 class="anchored" data-anchor-id="duplicate-results-with-rwe-as-reference-trial">Duplicate results with RWE as reference trial</h3>
<p><code>f_add_reference_trial_2()</code> creates a duplicate version of <code>i$FPNMA$means</code> where the trial is set to 2 (real-world evidence).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add in reference.trial 2</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>FPNMA<span class="sc">$</span>means <span class="ot">&lt;-</span> <span class="fu">f_add_reference_trial_2</span>(<span class="at">fp_data =</span> i<span class="sc">$</span>FPNMA<span class="sc">$</span>means)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="copy-into-p" class="level3">
<h3 class="anchored" data-anchor-id="copy-into-p">Copy into p</h3>
<p>Copy items into <code>p</code>, removing molecules with “NA” and limiting time horizon.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.3.5.2.2 DETERMINISTIC CODA --------------------------------------------</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>releff<span class="sc">$</span>CODA<span class="sc">$</span>FP <span class="ot">&lt;-</span> i<span class="sc">$</span>FPNMA<span class="sc">$</span>means</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>releff<span class="sc">$</span>fp_dest <span class="ot">&lt;-</span> i<span class="sc">$</span>FPNMA<span class="sc">$</span>destinations[<span class="sc">!</span><span class="fu">is.na</span>(Molecule), ]</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># limit to time horizon</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>releff<span class="sc">$</span>CODA<span class="sc">$</span>FP <span class="ot">&lt;-</span> p<span class="sc">$</span>releff<span class="sc">$</span>CODA<span class="sc">$</span>FP[time <span class="sc">&lt;=</span> p<span class="sc">$</span>basic<span class="sc">$</span>th, ]</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">#eliminate NAs in molecule</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>releff<span class="sc">$</span>fp_dest <span class="ot">&lt;-</span> i<span class="sc">$</span>FPNMA<span class="sc">$</span>destinations[<span class="sc">!</span><span class="fu">is.na</span>(Molecule), ]</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># A note on i vs p ---------------------------------------------------------------</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co"># P is for the parameters for one model scenario. the relative efficacy network is required</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co"># in order to compute the s(t) for all the different PLMTEs we need to power the model with.</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Therefore, the samples which are used should go into p not i.</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co"># However, the full CODA samples are a different matter as particularly for the</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co"># FPNMA these are large files and there's no need to copy paste this many times.</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Instead when we get to the point of the releff network, THEN we can be putting </span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co"># it into p. this is because for a particular probabilistic iteration,  </span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co"># scenario and so on we can pull through the right HRs to the right place!</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="create-nested-list-with-ph-nma-and-fp-nma-results" class="level2">
<h2 class="anchored" data-anchor-id="create-nested-list-with-ph-nma-and-fp-nma-results">Create nested list with PH NMA and FP NMA results</h2>
<section id="set-up-empty-list" class="level3">
<h3 class="anchored" data-anchor-id="set-up-empty-list">Set-up empty list</h3>
<p>This section uses <code>f_NMA_generateNetwork()</code> to create an empty list with the unique values for population &gt; line &gt; molecule &gt; trial &gt; endpoint (PLMTE). For each of these PLMTE, it then has:</p>
<ul>
<li><code>$dest</code> - which holds the numbers for the PLMTE</li>
<li><code>$orig</code> - empty list of PLMTE plus dist and source</li>
<li><code>$hr</code> - set to 1</li>
<li><code>$fp</code> - empty list</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.3.5.3 Empty relative efficacy network ---------------------------------</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Turn this into a list structure using the same naming convention as the rest of the model:</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co"># For this population, population line molecule trial and endpoint, generate a list</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># of spaces containing information on the relationship between other</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># population line molecule trial and endpoint pairings and this one.</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># For example, we need to be able to do the following:</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># - HR applied to other subgroup for same line mol tr endpoint</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co"># - HR applied to same subgroup for different line same mol tr endpoint</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># - HR applied to same subgroup same line different mol different tr same endpoint</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># - HR applied to same subgroup same line different mol same tr same endpoint</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co"># - HR applied to same subgroup same line different mol tr endpoint</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co"># The best way to cope with all this is to basically list out where</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co"># the extrapolation is coming from USING THE SAME NAMES AS IN i$surv$reg</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co"># but with the addition of the selected distribution</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co"># So, we have a list with dest for destination (i.e. this extrapolation)</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co"># origin (where it's coming from), and hr (what to apply to it)</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="co"># The next step (a different function) populates orig</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>releff<span class="sc">$</span>network <span class="ot">&lt;-</span> <span class="fu">f_NMA_generateNetwork</span>(i<span class="sc">$</span>id<span class="sc">$</span>ipd,i<span class="sc">$</span>lookup<span class="sc">$</span>ipd)</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co"># To visualize it a bit, the structure looks like tree roots. Like this:</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 1   Root                                    </span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 2    ¦--pop_0                               </span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="co"># 3    ¦   ¦--line_1                          </span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 4    ¦   ¦   ¦--mol_0                       </span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="co"># 5    ¦   ¦   ¦   ¦--trial_0                 </span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="co"># 6    ¦   ¦   ¦   ¦   ¦--endpoint_0          </span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="co"># 7    ¦   ¦   ¦   ¦   ¦   ¦--dest            </span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="co"># 8    ¦   ¦   ¦   ¦   ¦   °--orig            </span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 9    ¦   ¦   ¦   ¦   ¦--endpoint_1          </span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 10   ¦   ¦   ¦   ¦   ¦   ¦--dest            </span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="co"># 11   ¦   ¦   ¦   ¦   ¦   °--orig            </span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a><span class="co"># 12   ¦   ¦   ¦   ¦   ¦--endpoint_2          </span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a><span class="co"># 13   ¦   ¦   ¦   ¦   ¦   ¦--dest            </span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a><span class="co"># 14   ¦   ¦   ¦   ¦   ¦   °--orig            </span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a><span class="co"># 15   ¦   ¦   ¦   ¦   ¦--endpoint_3          </span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 16   ¦   ¦   ¦   ¦   ¦   ¦--dest            </span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a><span class="co"># 17   ¦   ¦   ¦   ¦   ¦   °--orig            </span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a><span class="co"># 18   ¦   ¦   ¦   ¦   ¦--endpoint_4          </span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a><span class="co"># 19   ¦   ¦   ¦   ¦   ¦   ¦--dest            </span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 20   ¦   ¦   ¦   ¦   ¦   °--orig            </span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a><span class="co"># 21   ¦   ¦   ¦   ¦   ¦--endpoint_5          </span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a><span class="co"># 22   ¦   ¦   ¦   ¦   ¦   ¦--dest            </span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a><span class="co"># 23   ¦   ¦   ¦   ¦   ¦   °--orig            </span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a><span class="co"># 24   ¦   ¦   ¦   ¦   ¦--endpoint_6          </span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a><span class="co"># 25   ¦   ¦   ¦   ¦   ¦   ¦--dest            </span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 26   ¦   ¦   ¦   ¦   ¦   °--orig            </span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a><span class="co"># 27   ¦   ¦   ¦   ¦   °--endpoint_7          </span></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a><span class="co"># 28   ¦   ¦   ¦   ¦       ¦--dest            </span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a><span class="co"># 29   ¦   ¦   ¦   ¦       °--orig            </span></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a><span class="co"># 80   ¦   ¦   ¦--mol_1                       </span></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a><span class="co"># 81   ¦   ¦   ¦   ¦--trial_0                 </span></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a><span class="co"># 82   ¦   ¦   ¦   ¦   ¦--endpoint_0          </span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a><span class="co"># 83   ¦   ¦   ¦   ¦   ¦   ¦--dest            </span></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a><span class="co"># 84   ¦   ¦   ¦   ¦   ¦   °--orig            </span></span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a><span class="co"># 85   ¦   ¦   ¦   ¦   ¦--endpoint_1          </span></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a><span class="co"># 86   ¦   ¦   ¦   ¦   ¦   ¦--dest            </span></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a><span class="co"># 87   ¦   ¦   ¦   ¦   ¦   °--orig            </span></span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a><span class="co"># 88   ¦   ¦   ¦   ¦   ¦--endpoint_2          </span></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a><span class="co"># 89   ¦   ¦   ¦   ¦   ¦   ¦--dest            </span></span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a><span class="co"># 90   ¦   ¦   ¦   ¦   ¦   °--orig            </span></span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a><span class="co"># 91   ¦   ¦   ¦   ¦   ¦--endpoint_3          </span></span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a><span class="co"># 92   ¦   ¦   ¦   ¦   ¦   ¦--dest            </span></span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a><span class="co"># 93   ¦   ¦   ¦   ¦   ¦   °--orig            </span></span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a><span class="co"># 94   ¦   ¦   ¦   ¦   ¦--endpoint_4          </span></span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a><span class="co"># 95   ¦   ¦   ¦   ¦   ¦   ¦--dest            </span></span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a><span class="co"># 96   ¦   ¦   ¦   ¦   ¦   °--orig            </span></span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a><span class="co"># 97   ¦   ¦   ¦   ¦   ¦--endpoint_5          </span></span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a><span class="co"># 98   ¦   ¦   ¦   ¦   ¦   ¦--dest            </span></span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a><span class="co"># 99   ¦   ¦   ¦   ¦   ¦   °--orig            </span></span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a><span class="co"># 100  ¦   ¦   ¦   ¦   °--... 2 nodes w/ 4 sub</span></span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a><span class="co"># 101  ¦   ¦   ¦   °--... 2 nodes w/ 54 sub   </span></span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a><span class="co"># 102  ¦   ¦   °--... 12 nodes w/ 956 sub     </span></span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a><span class="co"># 103  ¦   °--... 5 nodes w/ 6288 sub         </span></span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a><span class="co"># 104  °--... 3 nodes w/ 25463 sub             </span></span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a><span class="co"># A function (or functions) is (are) required to do several things, IN THIS ORDER:</span></span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-89"><a href="#cb17-89" aria-hidden="true" tabindex="-1"></a><span class="co">#  1. Put the HRs from the PH NMA in the destinations, using the CODA sample identifiers to set the origin.</span></span>
<span id="cb17-90"><a href="#cb17-90" aria-hidden="true" tabindex="-1"></a><span class="co">#  2. Put the time-varying HRs from the FP NMA in the destinations, using the identifiers to set the origins</span></span>
<span id="cb17-91"><a href="#cb17-91" aria-hidden="true" tabindex="-1"></a><span class="co">#  3. Use the table R_table_eff_data_settings from Excel to apply any superseding &amp; any assumption/ad-hoc stuff (HRs, assume equal to and so on)</span></span>
<span id="cb17-92"><a href="#cb17-92" aria-hidden="true" tabindex="-1"></a><span class="co">#  4. Use the final network object to propagate relative efficacy throughout the network, producing a set of extrapolations with RE applied.</span></span>
<span id="cb17-93"><a href="#cb17-93" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
View the empty <code>p$releff$network</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>See example of PMTE 0 and L1:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>releff<span class="sc">$</span>network<span class="sc">$</span>pop_0<span class="sc">$</span>line_1<span class="sc">$</span>mol_0<span class="sc">$</span>trial_0<span class="sc">$</span>endpoint_0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$dest
$dest$pop
[1] "pop_0"

$dest$line
[1] "line_1"

$dest$mol
[1] "mol_0"

$dest$trial
[1] "trial_0"

$dest$endpoint
[1] "endpoint_0"


$orig
$orig$pop
NULL

$orig$line
NULL

$orig$mol
NULL

$orig$trial
NULL

$orig$endpoint
NULL

$orig$dist
NULL

$orig$source
NULL


$hr
[1] 1

$fp
list()</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="create-numeric-trial-column-in-ir_table_eff_data_settings" class="level3">
<h3 class="anchored" data-anchor-id="create-numeric-trial-column-in-ir_table_eff_data_settings">Create numeric trial column in <code>i$R_table_eff_data_settings</code></h3>
<p>This generates a column <code>Trial</code> in the table <code>i$R_table_eff_data_settings</code> if it doesn’t already exist. Whilst this isn’t used in making the empty nested list, it will be later used by<code>f_NMA_AddAssumptionsToNetwork()</code> and <code>f_releff_PropNetwork()</code>.</p>
<p>The new <code>Trial</code> column is a numeric version of the column <code>i$R_table_eff_data_settings$Trial.name.if.effectiveness.source.is.trial</code>. The conversion between the categorical and numeric versions is done using the look-up <code>i$lookup$ipd$trial</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate DESTINATION trial number column if it doesn't already exist:</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="st">"Trial"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(i<span class="sc">$</span>R_table_eff_data_settings)) {</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  i<span class="sc">$</span>R_table_eff_data_settings<span class="sc">$</span>Trial <span class="ot">&lt;-</span> i<span class="sc">$</span>lookup<span class="sc">$</span>ipd<span class="sc">$</span>trial<span class="sc">$</span>Number[<span class="fu">match</span>(i<span class="sc">$</span>R_table_eff_data_settings<span class="sc">$</span>Trial.name.if.effectiveness.source.is.trial,i<span class="sc">$</span>lookup<span class="sc">$</span>ipd<span class="sc">$</span>trial<span class="sc">$</span>Description)]</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
View the new column
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Filtering to the unique trial columns, we can see that this has either set Trial to 0 or 2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">unique</span>(i<span class="sc">$</span>R_table_eff_data_settings <span class="sc">%&gt;%</span> <span class="fu">select</span>(Trial.name.if.effectiveness.source.is.trial, Trial)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Trial.name.if.effectiveness.source.is.trial</th>
<th style="text-align: right;">Trial</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">0</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">8</td>
<td style="text-align: left;">Real world evidence</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="add-nma-hrs" class="level3">
<h3 class="anchored" data-anchor-id="add-nma-hrs">Add NMA HRs</h3>
<p>These functions add the HRs from the PH NMA (<code>p$releff$CODA$PH</code>) and FP NMA (<code>p$releff$CODA$FP</code>) to the nested list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.3.5.4 Linking inputs from PH and FP NMAs --------------------------------------------</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the information we have from the PHNMA CODA sample to populate the corresponding</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># places within p$releff$network</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>releff<span class="sc">$</span>network <span class="ot">&lt;-</span> <span class="fu">f_NMA_linkPHNMA</span>(</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">network       =</span> p<span class="sc">$</span>releff<span class="sc">$</span>network,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">hr_table      =</span> p<span class="sc">$</span>releff<span class="sc">$</span>CODA<span class="sc">$</span>PH</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co"># All treatments included in the network:</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(c(unique(p$releff$means$Molecule),unique(p$releff$means$Reference.treatment),unique(i$R_table_eff_data_settings$Origin.treatment),unique(i$R_table_eff_data_settings$Treatment)))</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Link in the fractional polynomial point estimate time-varying hazard ratios</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>releff<span class="sc">$</span>network <span class="ot">&lt;-</span> <span class="fu">f_NMA_linkFPNMA</span>(</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">network       =</span> p<span class="sc">$</span>releff<span class="sc">$</span>network,</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">destinations  =</span> p<span class="sc">$</span>releff<span class="sc">$</span>fp_dest,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">hr_table      =</span> p<span class="sc">$</span>releff<span class="sc">$</span>CODA<span class="sc">$</span>FP,</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">time_horizon  =</span> p<span class="sc">$</span>basic<span class="sc">$</span>th</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co"># See e.g.</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="co"># p$releff$network$pop_0$line_1$mol_1$trial_0$endpoint_0</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="co"># To see that the time-varying hazard has been passed along :)</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Remember that we only need to apply this one to the stuff that is NOT direct </span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="co"># survival analysis applied to the data. HOWEVER, we need those rows in the table</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a><span class="co"># as well as we need the "origin" distributional selections to fill in our output!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
View the updated <code>p$releff$network</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>See example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PH NMA HR</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>releff<span class="sc">$</span>network<span class="sc">$</span>pop_0<span class="sc">$</span>line_1<span class="sc">$</span>mol_4<span class="sc">$</span>trial_0<span class="sc">$</span>endpoint_0<span class="sc">$</span>hr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7935352</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Time-varying FP NMA HRs</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(p<span class="sc">$</span>releff<span class="sc">$</span>network<span class="sc">$</span>pop_0<span class="sc">$</span>line_1<span class="sc">$</span>mol_4<span class="sc">$</span>trial_0<span class="sc">$</span>endpoint_0<span class="sc">$</span>fp<span class="sc">$</span>HR, <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.9321210 0.7399991 0.7015206 0.6987356 0.7068145 0.7182071 0.7301949
 [8] 0.7417350 0.7524420 0.7622070 0.7710399 0.7790003 0.7861653 0.7926152
[15] 0.7984263 0.8036691 0.8084066 0.8126947 0.8165829 0.8201147</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="add-more-assumption-based-hrs" class="level2">
<h2 class="anchored" data-anchor-id="add-more-assumption-based-hrs">Add more “assumption-based” HRs</h2>
<p>The column <code>i$R_table_eff_data_settings$Effectiveness.data.source</code> sets some of the sources of HRs.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
View <code>i$R_table_eff_data_settings$Effectiveness.data.source</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(i<span class="sc">$</span>R_table_eff_data_settings<span class="sc">$</span>Effectiveness.data.source)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                      0             Apply HR to         Assume equal to 
                    247                      49                      44 
                 FP_NMA                  PH_NMA Trial survival analysis 
                     22                      39                      19 </code></pre>
</div>
</div>
</div>
</div>
</div>
<p>If the setting <code>dd_use_PHnma_for_FPnma</code> was set to “Yes” in the excel spreadsheet, then it will replace “FP_NMA” with “PH_NMA” in this list - thereby, forcing the model to use the PH NMA HRs instead of including some from FP NMA.</p>
<p>By default, this is currently set to “No”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.3.5.5 Assumptions from Excel ------------------------------------------</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the setting dd_use_PHnma_for_FPnma from excel. This supersedes what's selected</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># in efficacy settings, changing all FP NMA entries to PH NMA to force the model to use</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># the PH NMA CODA sample over and above the FP NMA!</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (i<span class="sc">$</span>dd_use_PHnma_for_FPnma <span class="sc">==</span> <span class="st">"Yes"</span>) {</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  i<span class="sc">$</span>which_fpnma <span class="ot">&lt;-</span> <span class="fu">which</span>(i<span class="sc">$</span>R_table_eff_data_settings<span class="sc">$</span>Effectiveness.data.source <span class="sc">==</span> <span class="st">"FP_NMA"</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  i<span class="sc">$</span>R_table_eff_data_settings<span class="sc">$</span>Effectiveness.data.source[i<span class="sc">$</span>which_fpnma] <span class="ot">&lt;-</span> <span class="st">"PH_NMA"</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co"># QC point: to test whether all entries to Effectiveness.data.source are in the</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co"># lookup list, compare these two:</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co"># table(i$R_table_eff_data_settings$Effectiveness.data.source)</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co"># i$List_eff_datasources</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co"># i.e.,</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co"># setdiff(names(table(i$R_table_eff_data_settings$Effectiveness.data.source)),i$List_eff_datasources)</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="co"># "0" is fine as that's empty cells, but there should be nothing else.</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="co"># setdiff(names(table(i$R_table_eff_data_settings$Effectiveness.data.source)),i$List_eff_datasources)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function <code>f_NMA_AddAssumptionsToNetwork()</code> adds the “assumption-based” HRs according to <code>i$R_table_eff_data_settings$Effectiveness.data.source</code>. There are five categories within this:</p>
<ul>
<li><strong>Trial</strong> - <code>Trial survival analysis</code> - for these entries, they are a reference curve, so the function checks the origin and destination match, and then add some extra information from excel (e.g.&nbsp;dist, source, setting <code>fp</code> to empty list)</li>
<li><strong>FP NMA or PH NMA</strong> - <code>FP_NMA</code>, <code>PH_NMA</code> - as I’ve understood it, this populates the hazard ratio for a given comparison using the FP/PH NMA HR from the same comparison in a different trial - so, even though the HR data has come from a different context (different trial), we are saying it is still applicable to this treatment comparison.</li>
<li><strong>ET flag</strong> - <code>Assume equal to</code> - the treatment and reference treatment are considered to be equally effective, so the HR is set to 1</li>
<li><strong>AHR flag</strong> - <code>Apply HR to</code> - these entries have a HR provided in the Excel spreadsheet under a column <code>HR.to.apply</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>releff<span class="sc">$</span>network <span class="ot">&lt;-</span> <span class="fu">f_NMA_AddAssumptionsToNetwork</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">network            =</span> p<span class="sc">$</span>releff<span class="sc">$</span>network,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">phnma_table        =</span> p<span class="sc">$</span>releff<span class="sc">$</span>CODA<span class="sc">$</span>PH,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fpnma_table        =</span> p<span class="sc">$</span>releff<span class="sc">$</span>CODA<span class="sc">$</span>FP,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fpnma_destinations =</span> p<span class="sc">$</span>releff<span class="sc">$</span>fp_dest,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">excel_table        =</span> <span class="fu">data.table</span>(i<span class="sc">$</span>R_table_eff_data_settings),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">trial_flag         =</span> i<span class="sc">$</span>List_eff_datasources[<span class="dv">1</span>],</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">fpnma_flag         =</span> i<span class="sc">$</span>List_eff_datasources[<span class="dv">3</span>],</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">phnma_flag         =</span> i<span class="sc">$</span>List_eff_datasources[<span class="dv">2</span>],</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">et_flag            =</span> i<span class="sc">$</span>List_eff_datasources[<span class="dv">4</span>],</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">ahr_flag           =</span> i<span class="sc">$</span>List_eff_datasources[<span class="dv">5</span>],</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose            =</span> qc_mode</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Example to see all the HRs for population 0 in some nice tables </span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co"># f_releff_extract_all_HRs(p$releff$network)</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co"># assign to an object to browse through it</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="apply-hrs-to-the-extrapolated-rwe-survival-times" class="level2">
<h2 class="anchored" data-anchor-id="apply-hrs-to-the-extrapolated-rwe-survival-times">Apply HRs to the extrapolated RWE survival times</h2>
<p>The function <code>f_surv_getExtrapolations()</code> creates a nested list with survival times <code>st</code> for each PLMTE, as copied from <code>i$surv$reg</code> (the RWE survival analysis).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.3.5.6 Propagating the network -----------------------------------------</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Now that we have collected together all of the survival extrapolations for all</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># of the data we have, and all of the HRs, whether by assumption or derived</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># via NMA, plus all of the underlying distributional selections, we can proceed</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># to "proliferate" the evidence network, starting from the extrapolations we have already</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># and working "outwards" from that point, arriving at ONLY the extrapolation for each</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># possibility (rather than all distributions). From there, we can "cherry-pick"</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># those population line molecule trial endpoint distribution HR application choices</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># to "build-up" a given treatment pathway.</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co"># These are still "raw" extraps, so should be in i as they're not used for </span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co"># computation of pf. </span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>surv<span class="sc">$</span>extraps <span class="ot">&lt;-</span> <span class="fu">f_surv_getExtrapolations</span>(<span class="at">regs =</span> i<span class="sc">$</span>surv<span class="sc">$</span>reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function <code>f_releff_PropNetwork()</code> then applies the HR in <code>p$releff$network</code> to the survival times, saving the resulting nested list as <code>p$surv$st</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># propagate the extrapolation and comparative efficacy data/assumptions:</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Because this is for a particular iteration of the model, it should go into object p</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># which is the input set for running one model.</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>surv<span class="sc">$</span>st <span class="ot">&lt;-</span> <span class="fu">f_releff_PropNetwork</span>(</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">network =</span> p<span class="sc">$</span>releff<span class="sc">$</span>network,</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">extraps =</span> i<span class="sc">$</span>surv<span class="sc">$</span>extraps,</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">dos     =</span> <span class="dv">10</span>,</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> qc_mode,</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist_lookups =</span> p<span class="sc">$</span>basic<span class="sc">$</span>lookup<span class="sc">$</span>dist,</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">excel_table =</span> <span class="fu">data.table</span>(i<span class="sc">$</span>R_table_eff_data_settings)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co"># active trial depends on excel settings so it's hard to anticipate. 2 for all</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co"># lines if rwe and </span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co"># # pop 0 first line nivo mono trial 0</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="co"># f_qc_surv_gethead(p$surv$st,p = 0,l = 1,m = 1,t = 2,len = 3)</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="co"># # pop 0 line 2 nivo mono trial 1</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="co"># f_qc_surv_gethead(p$surv$st,p = 0,l = 2,m = 0,t = 2,len = 3)</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a><span class="co"># # follow pazo through the lines - so close! only OS in 4L but the others are all working</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="co"># # (just show me the first couple of rows from each for brevity). mol 5 selected</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="co"># # because it runs through all treatment lines</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="co"># f_qc_surv_gethead(p$surv$st,p = 0,l = 1,m = 5,t = 0,len = 3)</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a><span class="co"># f_qc_surv_gethead(p$surv$st,p = 0,l = 2,m = 5,t = 1,len = 3)</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a><span class="co"># f_qc_surv_gethead(p$surv$st,p = 0,l = 3,m = 5,t = 1,len = 3)</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a><span class="co"># f_qc_surv_gethead(p$surv$st,p = 0,l = 4,m = 5,t = 1,len = 3)</span></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a><span class="co"># # Risk pop 1 first line nivo cabo from trial and then rwe:</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a><span class="co"># f_qc_surv_gethead(p$surv$st,1,1,1,2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
View <code>p$surv$st</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This list is similar to <code>p$releff$network</code> but with the addition of survivals, as demonstrated below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(p<span class="sc">$</span>surv<span class="sc">$</span>st<span class="sc">$</span>pop_0<span class="sc">$</span>line_3<span class="sc">$</span>mol_0<span class="sc">$</span>trial_2<span class="sc">$</span>endpoint_2<span class="sc">$</span>st, <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1.0000000 0.9921156 0.9782498 0.9609062 0.9410968 0.9194740 0.8965183
 [8] 0.8726074 0.8480469 0.8230890 0.7979435 0.7727850 0.7477591 0.7229864
[15] 0.6985662 0.6745796 0.6510916 0.6281539 0.6058063 0.5840786</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="apply-modifications-to-the-survival-times" class="level2">
<h2 class="anchored" data-anchor-id="apply-modifications-to-the-survival-times">Apply modifications to the survival times</h2>
<section id="prior-adjuvant-treatments" class="level3">
<h3 class="anchored" data-anchor-id="prior-adjuvant-treatments">Prior adjuvant treatments</h3>
<p>By default, this is not run as <code>i$dd_adjforprioradjuvant</code> is set to “No”.</p>
<p>However, if “Yes”, it would adjust the survival times again for endpoint 0 (overall survival, OS) by applying another hazard ratio that is associated with prior adjuvant treatment.</p>
<p>An adjuvant treatment is an additional treatment given alongside the primary treatment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.3.6 Extrapolation modifications ---------------------------------------</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This subsection focuses on applying the required modifications to the "raw" extrapolations</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># now that we have propagated comparative efficacy. We need to first apply any adjustments for treatment effect waning </span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># and then check the following:</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  - mortality never falls below that of the general population</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  - The extrapolations which are NOT censored for death do not cross (in abs or hazard) OS</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co"># During technical engagement functionality will be added here to adjust for the impact of prior adjuvant treatment as part of scenario analysis</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(i<span class="sc">$</span>dd_adjforprioradjuvant <span class="sc">==</span> <span class="st">"Yes"</span>) {</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  p<span class="sc">$</span>surv<span class="sc">$</span>st <span class="ot">&lt;-</span> <span class="fu">f_surv_adjuvant_HR</span>(</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">st              =</span> p<span class="sc">$</span>surv<span class="sc">$</span>st,</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">adjuvant_impact =</span> i<span class="sc">$</span>R_table_prior_IO_impact_eff,</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">demo_table      =</span> p<span class="sc">$</span>demo<span class="sc">$</span>table,</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">lookup          =</span> p<span class="sc">$</span>basic<span class="sc">$</span>lookup,</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose         =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="effect-waning" class="level3">
<h3 class="anchored" data-anchor-id="effect-waning">Effect waning</h3>
<p>Treatment effect waning is the loss of a treatment’s benefits over time. It is only applied to some PLMTEs, as specified by <code>i$R_table_TE_waning_settings$apply.waning</code>.</p>
<p>This is implemented using the function <code>f_surv_twaning_apply()</code>, which reduces the effect to match the reference treatment once it reaches a certain cycle.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Curve crossing should be fixed on the treatment sequence level, NOT the original PLMT level</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># through E. This is because doing it that way round could lead to implausible</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># extrapolations. For instance, if the PFS from somewhere else was being injected</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># in (e.g. if trial 0 for OS and trial 1 from a different PLMT for PFS via equivalence</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># assumption), it may be the case that the assumed equal PFS crosses OS.</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Therefore, curve crossing fixes should be performed on the individual treatment</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># pathways.</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co"># In conclusion, this section ONLY adjusts for gpop mortality, and curve crossing</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co"># adjustment is performed AFTER f_seq_extrapCollector is used to pull through</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co"># the correct extrapolations to the correct DESTINATION locations. </span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co"># The function is ONLY applied to OS lines.</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Because we have pulled through the metatadata to our PLMTEs s(t) objects, </span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="co"># we can use the "dest" element to decide which row of Excel range R_table_ptchar</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="co"># to apply in the general population mortality</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Firstly, treatment effect waning. This is done on unadjusted curves and is </span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="co"># not included in the model base-case.</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the information on patient characteristics from Excel into a data table</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>i<span class="sc">$</span>R_table_ptchar <span class="ot">&lt;-</span> <span class="fu">data.table</span>(i<span class="sc">$</span>R_table_ptchar)</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a><span class="co"># BEFORE adjusting for general population, we must apply treatment effect waning.</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a><span class="co">#        Evidence has suggested that this predominantly affects 1L treatments,</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a><span class="co">#        and the table "R_table_TE_waning_settings" has been populated to capture</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a><span class="co">#        waning. This provides information on the "destination" and the nature</span></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a><span class="co">#        of the treatment effect waning. The "destination" information is then</span></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a><span class="co">#        used to link to the efficacy settings table "R_table_eff_data_settings"</span></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a><span class="co">#        in excel. This table contains the corresponding information on the "origin".</span></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a><span class="co">#        In the case of 1L treatments, this is the reference curve</span></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a><span class="do">##### Treatment effect waning application is defined in the main Excel workbook for input</span></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a><span class="do">##### For each treatment and outcome:</span></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a><span class="do">##### apply: yes / no</span></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a><span class="do">##### method: either absolute survival or hazards</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a><span class="do">##### when TE waning starts (years)</span></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a><span class="do">##### when TE waning is fully implemented (years)</span></span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a><span class="do">##### linear graduation is used between the start and end time</span></span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Note this function produces a warning which details when there is a danger of TE waning in the usual fashion (setting hazards the same)</span></span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a><span class="co"># being implemented producing counterintuitive results. In this case we use the higher of the hazards to prevent this problem</span></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">sum</span>(i<span class="sc">$</span>R_table_TE_waning_settings<span class="sc">$</span>apply.waning <span class="sc">==</span> <span class="st">"Yes"</span>) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>  p<span class="sc">$</span>surv<span class="sc">$</span>st <span class="ot">&lt;-</span> <span class="fu">f_surv_twaning_apply</span>(</span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">st_list     =</span> p<span class="sc">$</span>surv<span class="sc">$</span>st,</span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">tab_waning  =</span> <span class="fu">data.table</span>(i<span class="sc">$</span>R_table_TE_waning_settings),</span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">tab_eff_set =</span> <span class="fu">data.table</span>(i<span class="sc">$</span>R_table_eff_data_settings),</span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose     =</span> qc_mode</span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in treatment_effect_waning_with_absolute(surv_active = plmte$st, :
Hazard rate in the active treatment is more than the hazard rate in the
reference treatment in 1890 cycles, the first of which is 198 . Using the
higher of the two hazards where they cross!</code></pre>
</div>
</div>
</section>
<section id="general-population-mortality" class="level3">
<h3 class="anchored" data-anchor-id="general-population-mortality">General population mortality</h3>
<p>In this section, the survival curves are calculated for the general population, and these are then used to adjust the treatment survival curves.</p>
<section id="generate-the-general-population-survival-curves" class="level4">
<h4 class="anchored" data-anchor-id="generate-the-general-population-survival-curves">Generate the general population survival curves</h4>
<p>The survival curves are for overall survival. They are calculated for each population and each line of therapy. They can be created using one of two functions:</p>
<ul>
<li><code>f_surv_GenOSLines_det()</code> - calculates curves based on characteristics provided in a table</li>
<li><code>f_surv_GenOSLines_ipd()</code> - calculates curves based on individual patient data</li>
</ul>
<p>The default option is to use patient-level data (<code>i$dd_age_sex_source == "PLD")</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate all the gpop lines we can generate:</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>surv<span class="sc">$</span>gpop <span class="ot">&lt;-</span> <span class="cf">if</span> (i<span class="sc">$</span>dd_age_sex_source <span class="sc">==</span> <span class="st">"Mean"</span>) <span class="fu">f_surv_GenOSLines_det</span>(</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">R_table_ptchar         =</span> i<span class="sc">$</span>R_table_ptchar,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">R_table_mort_lifeTable =</span> i<span class="sc">$</span>R_table_mort_lifeTable,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">t_yr                   =</span> p<span class="sc">$</span>basic<span class="sc">$</span>t_yr,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">lookups                =</span> i<span class="sc">$</span>lookup</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>) <span class="cf">else</span> <span class="fu">f_surv_GenOSLines_ipd</span>(</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">R_table_patientagesex  =</span> i<span class="sc">$</span>R_table_patientagesex,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">R_table_mort_lifeTable =</span> i<span class="sc">$</span>R_table_mort_lifeTable,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">t_yr                   =</span> p<span class="sc">$</span>basic<span class="sc">$</span>t_yr,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">lookups                =</span> i<span class="sc">$</span>lookup</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
View <code>p$surv$gpop</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>As an example, the overall survival times for population 0 line 1 from the general population are:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(p<span class="sc">$</span>surv<span class="sc">$</span>gpop<span class="sc">$</span>pop_0<span class="sc">$</span>line_1<span class="sc">$</span>os, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1.0000000 0.9996541 0.9993084 0.9989626 0.9986170 0.9982715 0.9979260
 [8] 0.9975807 0.9972355 0.9968905</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="compare-curves-generated-by-means-v.s.-patient-level-data" class="level4">
<h4 class="anchored" data-anchor-id="compare-curves-generated-by-means-v.s.-patient-level-data">Compare curves generated by means v.s. patient-level data</h4>
<p>If running the script in <code>qc_mode</code>, this code chunk will compare the general population survival curves produced based on average characteristics in a table to those produced from person-level data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># During QC model we produce a comparison between mean-based and IPD based general population OS lines:</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (qc_mode) {</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  i<span class="sc">$</span>gpop <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">means =</span> <span class="fu">f_surv_GenOSLines_det</span>(</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">R_table_ptchar         =</span> i<span class="sc">$</span>R_table_ptchar,</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">R_table_mort_lifeTable =</span> i<span class="sc">$</span>R_table_mort_lifeTable,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">t_yr                   =</span> p<span class="sc">$</span>basic<span class="sc">$</span>t_yr,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">lookups                =</span> i<span class="sc">$</span>lookup</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">ipd =</span> <span class="fu">f_surv_GenOSLines_ipd</span>(</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">R_table_patientagesex  =</span> i<span class="sc">$</span>R_table_patientagesex,</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">R_table_mort_lifeTable =</span> i<span class="sc">$</span>R_table_mort_lifeTable,</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">t_yr                   =</span> p<span class="sc">$</span>basic<span class="sc">$</span>t_yr,</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">lookups                =</span> i<span class="sc">$</span>lookup</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compare all risk population first-line across the 2 methods</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>  i<span class="sc">$</span>gpop<span class="sc">$</span>plotdat <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">t =</span> <span class="fu">rep</span>(p<span class="sc">$</span>basic<span class="sc">$</span>t_yr,<span class="dv">2</span>),</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">os =</span> <span class="fu">c</span>(i<span class="sc">$</span>gpop<span class="sc">$</span>means<span class="sc">$</span>pop_0<span class="sc">$</span>line_1<span class="sc">$</span>os,i<span class="sc">$</span>gpop<span class="sc">$</span>ipd<span class="sc">$</span>pop_0<span class="sc">$</span>line_1<span class="sc">$</span>os),</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Means"</span>,p<span class="sc">$</span>basic<span class="sc">$</span>th<span class="sc">+</span><span class="dv">1</span>),<span class="fu">rep</span>(<span class="st">"Patient data"</span>,p<span class="sc">$</span>basic<span class="sc">$</span>th<span class="sc">+</span><span class="dv">1</span>))</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>  i<span class="sc">$</span>gpop<span class="sc">$</span>comp_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(i<span class="sc">$</span>gpop<span class="sc">$</span>plotdat, <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> os, <span class="at">colour =</span> method)) <span class="sc">+</span> </span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>, <span class="at">legend.title=</span><span class="fu">element_blank</span>()) <span class="sc">+</span> </span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">"Time (years)"</span>, <span class="at">y =</span> <span class="st">"% Survival"</span>) <span class="sc">+</span> </span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.05</span>))) <span class="sc">+</span> </span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent)</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(qc_mode) {</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">filename =</span> <span class="fu">file.path</span>(<span class="st">"./4_Output/"</span>,<span class="st">"gpop_1L_method_comparison.png"</span>),</span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot =</span> i<span class="sc">$</span>gpop<span class="sc">$</span>comp_plot,</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">device =</span> <span class="st">"png"</span>,</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">units =</span> <span class="st">"cm"</span>,</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">15</span></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="adjust-treatment-curves-based-on-general-population" class="level4">
<h4 class="anchored" data-anchor-id="adjust-treatment-curves-based-on-general-population">Adjust treatment curves based on general population</h4>
<p>The function <code>f_surv_gpopadjust()</code> adjusts the survival curves based on the general population survival curves. This is to ensure that the advanced renal cell carcinoma (aRCC) patients are not projected to live longer than the general population.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># adjust all OS lines in p$surv$st for gpop mortality</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>surv<span class="sc">$</span>st <span class="ot">&lt;-</span> <span class="fu">f_surv_gpopadjust</span>(<span class="at">st      =</span> p<span class="sc">$</span>surv<span class="sc">$</span>st,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">gpop    =</span> p<span class="sc">$</span>surv<span class="sc">$</span>gpop,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">method  =</span> <span class="st">"hazardmax"</span>,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">verbose =</span> qc_mode)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="curve-overlap" class="level3">
<h3 class="anchored" data-anchor-id="curve-overlap">Curve overlap</h3>
<p>A known limitation of extrapolating curves individually within survival analysis is that it can produce curves where PFS lies above OS (which is impossible in real-life). Hence, in cases where this occurs, it was adjusted so that PFS &lt;= OS (and also, TTD &lt;= OS, and PFS &lt;= TTP). This was implemented using the functions <code>f_surv_PFSxOS()</code>, <code>f_surv_TTDxOS()</code>, and <code>f_surv_PFSxTTP()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust PFS and TTD for OS - PFS and TTD cannot exceed OS</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>surv<span class="sc">$</span>st <span class="ot">&lt;-</span> <span class="fu">f_surv_PFSxOS</span>(p<span class="sc">$</span>surv<span class="sc">$</span>st, <span class="cf">if</span>(i<span class="sc">$</span>dd_adj_cross_curves <span class="sc">==</span> <span class="st">"Use hazards"</span>){<span class="st">"hazardmax"</span>} <span class="cf">else</span>{<span class="st">"abs"</span>})</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>surv<span class="sc">$</span>st <span class="ot">&lt;-</span> <span class="fu">f_surv_TTDxOS</span>(p<span class="sc">$</span>surv<span class="sc">$</span>st, <span class="cf">if</span>(i<span class="sc">$</span>dd_adj_cross_curves <span class="sc">==</span> <span class="st">"Use hazards"</span>){<span class="st">"hazardmax"</span>} <span class="cf">else</span>{<span class="st">"abs"</span>})</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust TTP, PFS cannot go above TTP, this is done on absolute survival rather than allowing flexibility to look at hazards</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>surv<span class="sc">$</span>st <span class="ot">&lt;-</span> <span class="fu">f_surv_PFSxTTP</span>(<span class="at">st =</span> p<span class="sc">$</span>surv<span class="sc">$</span>st,<span class="at">method =</span>  <span class="st">"abs"</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co"># The below should produce a string of positive or 0s</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="co"># p$surv$st$pop_0$line_1$mol_7$trial_2$endpoint_3$st - p$surv$st$pop_0$line_1$mol_7$trial_2$endpoint_1$st</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="set-5l-to-4l" class="level3">
<h3 class="anchored" data-anchor-id="set-5l-to-4l">Set 5L to 4L</h3>
<p>Here, the survival times for 5L (ie. best supportive care, BSC) are set to those from 4L.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Last assumption - 5L =4L. this moves over BSC when it comes after 4 active treatments.</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>surv<span class="sc">$</span>st <span class="ot">&lt;-</span> <span class="fu">lapply</span>(p<span class="sc">$</span>surv<span class="sc">$</span>st, <span class="cf">function</span>(popu) {</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  popu<span class="sc">$</span>line_5 <span class="ot">&lt;-</span> popu<span class="sc">$</span>line_4</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(popu)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="view-the-generated-curves" class="level2">
<h2 class="anchored" data-anchor-id="view-the-generated-curves">View the generated curves</h2>
<p>If running with <code>qc_mode</code>, this would plot survival extrapolations and hazard curves for each PLMTE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.3.7 Visual QC of final curves ---------------------------------------</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Here's an example of how to run the QC plots. These serve as a useful check</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># later on too, because it reveals where some PLMTEs have not been populated.</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co"># f_qc_surv_ExtrapPlot(</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   st   = p$surv$st,</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   popu = "pop_0",</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   li   = "line_1",</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   mo   = "mol_1",</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   tr   = "trial_2",</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   t_yr = p$basic$t_yr,</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   th = p$basic$th</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co"># f_qc_surv_EstHazPlot(</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   st   = p$surv$st,</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   gpop = p$surv$gpop,</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   popu = "pop_0",</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   li   = "line_1",</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   mo   = "mol_1",</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   tr   = "trial_2",</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   t_yr = p$basic$t_yr,</span></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   th   = p$basic$th</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Here is a QC method for visually having a look at the extrapolated survival</span></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a><span class="co"># after all relative efficacy has been applied. This creates a LOT of graphs. You can look through them by pressing the arrow on the plots window</span></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (qc_mode) {</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>  i<span class="sc">$</span>excel_destinations <span class="ot">&lt;-</span> <span class="fu">data.table</span>(i<span class="sc">$</span>R_table_eff_data_settings)[Include.in.this.analysis.<span class="sc">==</span><span class="st">"Yes"</span>,<span class="fu">list</span>(Population,Treatment.line,Molecule,Origin.trial,End.point)]</span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>  i<span class="sc">$</span>surv<span class="sc">$</span>ExtrapSenseCheck <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(</span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(i<span class="sc">$</span>excel_destinations),</span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">init =</span> <span class="fu">f_NMA_generateNetwork</span>(i<span class="sc">$</span>id<span class="sc">$</span>ipd,i<span class="sc">$</span>lookup<span class="sc">$</span>ipd),</span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">accumulate =</span> <span class="cn">FALSE</span>,</span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">f =</span> <span class="cf">function</span>(prev, dest_row) {</span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a>      dat <span class="ot">&lt;-</span> <span class="fu">as.list</span>(i<span class="sc">$</span>excel_destinations[dest_row,])</span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a>      d <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">pop =</span> <span class="fu">paste0</span>(<span class="st">"pop_"</span>,dat<span class="sc">$</span>Population),</span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">line =</span> <span class="fu">paste0</span>(<span class="st">"line_"</span>,dat<span class="sc">$</span>Treatment.line),</span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">mol =</span> <span class="fu">paste0</span>(<span class="st">"mol_"</span>,dat<span class="sc">$</span>Molecule),</span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">trial =</span> <span class="fu">paste0</span>(<span class="st">"trial_"</span>,dat<span class="sc">$</span>Origin.trial),</span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">endpoint =</span> <span class="fu">paste0</span>(<span class="st">"endpoint_"</span>,dat<span class="sc">$</span>End.point)</span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">paste0</span>(</span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Drawing plots: "</span>,</span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">" row "</span>, dest_row, <span class="st">" i$surv$ExtrapSenseCheck$"</span>,</span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a>        d<span class="sc">$</span>pop, <span class="st">"$"</span>,</span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true" tabindex="-1"></a>        d<span class="sc">$</span>line, <span class="st">"$"</span>,</span>
<span id="cb45-52"><a href="#cb45-52" aria-hidden="true" tabindex="-1"></a>        d<span class="sc">$</span>mol, <span class="st">"$"</span>,</span>
<span id="cb45-53"><a href="#cb45-53" aria-hidden="true" tabindex="-1"></a>        d<span class="sc">$</span>trial, <span class="st">"$plots"</span>,</span>
<span id="cb45-54"><a href="#cb45-54" aria-hidden="true" tabindex="-1"></a>        <span class="st">"</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb45-55"><a href="#cb45-55" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb45-56"><a href="#cb45-56" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb45-57"><a href="#cb45-57" aria-hidden="true" tabindex="-1"></a>      p_extrap <span class="ot">&lt;-</span> <span class="fu">f_qc_surv_ExtrapPlot</span>(</span>
<span id="cb45-58"><a href="#cb45-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">st   =</span> p<span class="sc">$</span>surv<span class="sc">$</span>st,</span>
<span id="cb45-59"><a href="#cb45-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">popu =</span> d<span class="sc">$</span>pop,</span>
<span id="cb45-60"><a href="#cb45-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">li   =</span> d<span class="sc">$</span>line,</span>
<span id="cb45-61"><a href="#cb45-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">mo   =</span> d<span class="sc">$</span>mol,</span>
<span id="cb45-62"><a href="#cb45-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">tr   =</span> d<span class="sc">$</span>trial,</span>
<span id="cb45-63"><a href="#cb45-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">t_yr =</span> p<span class="sc">$</span>basic<span class="sc">$</span>t_yr,</span>
<span id="cb45-64"><a href="#cb45-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">th =</span> p<span class="sc">$</span>basic<span class="sc">$</span>th</span>
<span id="cb45-65"><a href="#cb45-65" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb45-66"><a href="#cb45-66" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb45-67"><a href="#cb45-67" aria-hidden="true" tabindex="-1"></a>      p_haz <span class="ot">&lt;-</span> <span class="fu">f_qc_surv_EstHazPlot</span>(</span>
<span id="cb45-68"><a href="#cb45-68" aria-hidden="true" tabindex="-1"></a>        <span class="at">st   =</span> p<span class="sc">$</span>surv<span class="sc">$</span>st,</span>
<span id="cb45-69"><a href="#cb45-69" aria-hidden="true" tabindex="-1"></a>        <span class="at">gpop =</span> p<span class="sc">$</span>surv<span class="sc">$</span>gpop,</span>
<span id="cb45-70"><a href="#cb45-70" aria-hidden="true" tabindex="-1"></a>        <span class="at">popu =</span> d<span class="sc">$</span>pop,</span>
<span id="cb45-71"><a href="#cb45-71" aria-hidden="true" tabindex="-1"></a>        <span class="at">li   =</span> d<span class="sc">$</span>line,</span>
<span id="cb45-72"><a href="#cb45-72" aria-hidden="true" tabindex="-1"></a>        <span class="at">mo   =</span> d<span class="sc">$</span>mol,</span>
<span id="cb45-73"><a href="#cb45-73" aria-hidden="true" tabindex="-1"></a>        <span class="at">tr   =</span> d<span class="sc">$</span>trial,</span>
<span id="cb45-74"><a href="#cb45-74" aria-hidden="true" tabindex="-1"></a>        <span class="at">t_yr =</span> p<span class="sc">$</span>basic<span class="sc">$</span>t_yr,</span>
<span id="cb45-75"><a href="#cb45-75" aria-hidden="true" tabindex="-1"></a>        <span class="at">th   =</span> p<span class="sc">$</span>basic<span class="sc">$</span>th</span>
<span id="cb45-76"><a href="#cb45-76" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb45-77"><a href="#cb45-77" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb45-78"><a href="#cb45-78" aria-hidden="true" tabindex="-1"></a>      plmt <span class="ot">&lt;-</span> prev[[d<span class="sc">$</span>pop]][[d<span class="sc">$</span>line]][[d<span class="sc">$</span>mol]][[d<span class="sc">$</span>trial]]</span>
<span id="cb45-79"><a href="#cb45-79" aria-hidden="true" tabindex="-1"></a>      plmt<span class="sc">$</span>plots <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb45-80"><a href="#cb45-80" aria-hidden="true" tabindex="-1"></a>        <span class="at">p_extrap =</span> p_extrap,</span>
<span id="cb45-81"><a href="#cb45-81" aria-hidden="true" tabindex="-1"></a>        <span class="at">p_haz =</span> p_haz</span>
<span id="cb45-82"><a href="#cb45-82" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb45-83"><a href="#cb45-83" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb45-84"><a href="#cb45-84" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Save 2 plots for each PLM available. Takes a while to run.</span></span>
<span id="cb45-85"><a href="#cb45-85" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (qc_mode) {</span>
<span id="cb45-86"><a href="#cb45-86" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggsave</span>(</span>
<span id="cb45-87"><a href="#cb45-87" aria-hidden="true" tabindex="-1"></a>          <span class="at">filename =</span> <span class="fu">file.path</span>(<span class="st">"./4_Output"</span>,<span class="fu">paste0</span>(<span class="st">"p_extrap_"</span>,<span class="fu">paste</span>(d[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>],<span class="at">collapse=</span><span class="st">"_"</span>),<span class="st">".png"</span>)),</span>
<span id="cb45-88"><a href="#cb45-88" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot     =</span> plmt<span class="sc">$</span>plots<span class="sc">$</span>p_extrap,</span>
<span id="cb45-89"><a href="#cb45-89" aria-hidden="true" tabindex="-1"></a>          <span class="at">device =</span> <span class="st">"png"</span>,</span>
<span id="cb45-90"><a href="#cb45-90" aria-hidden="true" tabindex="-1"></a>          <span class="at">units =</span> <span class="st">"cm"</span>,</span>
<span id="cb45-91"><a href="#cb45-91" aria-hidden="true" tabindex="-1"></a>          <span class="at">width =</span> <span class="dv">15</span></span>
<span id="cb45-92"><a href="#cb45-92" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb45-93"><a href="#cb45-93" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggsave</span>(</span>
<span id="cb45-94"><a href="#cb45-94" aria-hidden="true" tabindex="-1"></a>          <span class="at">filename =</span> <span class="fu">file.path</span>(<span class="st">"./4_Output"</span>,<span class="fu">paste0</span>(<span class="st">"p_tp_"</span>,<span class="fu">paste</span>(d[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>],<span class="at">collapse=</span><span class="st">"_"</span>),<span class="st">".png"</span>)),</span>
<span id="cb45-95"><a href="#cb45-95" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot     =</span> plmt<span class="sc">$</span>plots<span class="sc">$</span>p_haz,</span>
<span id="cb45-96"><a href="#cb45-96" aria-hidden="true" tabindex="-1"></a>          <span class="at">device =</span> <span class="st">"png"</span>,</span>
<span id="cb45-97"><a href="#cb45-97" aria-hidden="true" tabindex="-1"></a>          <span class="at">units =</span> <span class="st">"cm"</span>,</span>
<span id="cb45-98"><a href="#cb45-98" aria-hidden="true" tabindex="-1"></a>          <span class="at">width =</span> <span class="dv">15</span></span>
<span id="cb45-99"><a href="#cb45-99" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb45-100"><a href="#cb45-100" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb45-101"><a href="#cb45-101" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb45-102"><a href="#cb45-102" aria-hidden="true" tabindex="-1"></a>      prev[[d<span class="sc">$</span>pop]][[d<span class="sc">$</span>line]][[d<span class="sc">$</span>mol]][[d<span class="sc">$</span>trial]] <span class="ot">&lt;-</span> plmt</span>
<span id="cb45-103"><a href="#cb45-103" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb45-104"><a href="#cb45-104" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(prev)</span>
<span id="cb45-105"><a href="#cb45-105" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb45-106"><a href="#cb45-106" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb45-107"><a href="#cb45-107" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-108"><a href="#cb45-108" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
View some example plots
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Although <code>qc_mode</code> is set to FALSE, we can still use the functions to view an example of a survival and hazard curves.</p>
<!-- We use the .md file produced from this .qmd to then create the seperate walkthrough pages, and I've found these images then don't display correctly, hence below we have hidden sections that create, save and display the plots, as well as some repeat sections of code that do not attempt to output figures -->
<div class="sourceCode" id="cb46"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="in">f_qc_surv_ExtrapPlot(</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="in">  st   = p$surv$st,</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="in">  popu = "pop_0",</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="in">  li   = "line_1",</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="in">  mo   = "mol_1",</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="in">  tr   = "trial_2",</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="in">  t_yr = p$basic$t_yr,</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="in">  th = p$basic$th</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="example_extrap.png" class="img-fluid"></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="in">f_qc_surv_EstHazPlot(</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="in">  st   = p$surv$st,</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="in">  gpop = p$surv$gpop,</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="in">  popu = "pop_0",</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="in">  li   = "line_1",</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="in">  mo   = "mol_1",</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="in">  tr   = "trial_2",</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="in">  t_yr = p$basic$t_yr,</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="in">  th   = p$basic$th</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="example_esthaz.png" class="img-fluid"></p>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/nice-digital\.github\.io\/NICE-model-repo\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/nice-digital/NICE-model-repo/edit/main/pages/walkthrough/code3_hr.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/nice-digital/NICE-model-repo/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>