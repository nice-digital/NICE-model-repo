[
  {
    "objectID": "pages/input_data.html",
    "href": "pages/input_data.html",
    "title": "Input data",
    "section": "",
    "text": "There are five input data files (stored in 1_Data/) that are used by 2_Scripts/Model_Structure.R.\nThese are each described below.",
    "crumbs": [
      "Code walkthrough",
      "Input data"
    ]
  },
  {
    "objectID": "pages/input_data.html#excel-user-interface",
    "href": "pages/input_data.html#excel-user-interface",
    "title": "Input data",
    "section": "Excel user interface",
    "text": "Excel user interface\n\n\n\n\n\n\nID6184_RCC_model inputs FAD version [UK RWE unredacted, ACIC redacted, cPAS redacted].xlsm\n\n\n\n\n\nThe majority of inputs for the code are made using an excel spreadsheet. This is currently populated with inputs that align with the final appraisal document (FAD) for TA964/ID6184, which is the appraisal of cabozantinib with nivolumab for untreated advanced renal cell carcinoma. Some of the inputs have been redacted in the publicly available spreadsheet as they are either academic and commercial in confidence (ACIC) or relate to the confident patient access scheme (cPAS). Hence, this version does not contain confidential company data, confidential price discounts or company individual patient data and treatment sequence data. The model does now contain UK real-world evidence (RWE) data which was redacted at the time of the appraisal at the request of the UK real-world evidence (RWE) data holders.\nThe data in the excel workbook will be imported to R using the sheet named ranges. In R, a nested list will be created where the Name is the reference for each item and the Cell Range is the content of the list.\nTo illustrate how this works, this example works through the parameter which contains a list of treatments allowed for population 1.\nOn the named ranges sheet, row 184 has Name List_pop1_allowed and Cell Range =Lists!$BA$11:$BA$22.\n\nOn the Lists sheet, we can see the list of allowed treatments.\n\nThen, if we import the excel spreadsheet, we can view that same parameter within the nested list i.\n\n# Import the functions required\nsource(file.path(\"../../3_Functions/excel/extract.R\"))\n\n# Import the excel file\nexcel_path &lt;- \"../../1_Data/ID6184_RCC_model inputs FAD version [UK RWE unredacted, ACIC redacted, cPAS redacted].xlsm\"\ni &lt;- f_excel_extract(excel_path, verbose = FALSE)\n\n# Tidy the imported parameters\ni &lt;- c(i,f_excel_cleanParams(i$R_table_param))\n\n# View the parameter\ni$List_pop1_allowed\n\n [1] \"avelumab_plus_axitinib\"      \"axitinib\"                   \n [3] \"cabozantinib\"                \"everolimus\"                 \n [5] \"lenvatinib_plus_everolimus\"  \"cabozantinib_plus_nivolumab\"\n [7] \"nivolumab_monotherapy\"       \"pazopanib\"                  \n [9] \"sunitinib\"                   \"tivozanib\"",
    "crumbs": [
      "Code walkthrough",
      "Input data"
    ]
  },
  {
    "objectID": "pages/input_data.html#hazard-ratios-hr-from-the-network-meta-analyses-nma",
    "href": "pages/input_data.html#hazard-ratios-hr-from-the-network-meta-analyses-nma",
    "title": "Input data",
    "section": "Hazard ratios (HR) from the network meta-analyses (NMA)",
    "text": "Hazard ratios (HR) from the network meta-analyses (NMA)\n\n\n\n\n\n\nPH_NMA_CODA.rds and FPNMA_means.rds\n\n\n\n\n\nThese files contain the outputs of the proportional hazards NMA (PH NMA) and the fractional polynomial NMA (FP NMA). In the publicly available versions, time to next treatment as a surrogate for nivolumab plus ipilimumab is not available to the public as this data was marked as confidential by the data holders.\n\n# Import the NMA results\nRDS_path2 &lt;- \"../../1_Data/PH_NMA_CODA.rds\"\nRDS_path3 &lt;- \"../../1_Data/FPNMA_means.rds\"\ni$PHNMA &lt;- readRDS(RDS_path2)\ni$FPNMA$means  &lt;- readRDS(RDS_path3)\n\n\n# Preview the PH NMA results\nkable(head(i$PHNMA$data))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nrun\npopulation\nline\nmolecule\nendpoint\nreferencetreatment\nreferencetrial\nhr\n\n\n\n\n1\n0\n1\n4\n0\n7\n0\n0.8958580\n\n\n1\n0\n1\n1\n0\n7\n0\n0.7821468\n\n\n1\n0\n1\n8\n0\n7\n0\n1.4324613\n\n\n1\n0\n1\n2\n0\n7\n0\n0.7571763\n\n\n1\n0\n1\n5\n0\n7\n0\n0.9492596\n\n\n1\n0\n1\n3\n0\n7\n0\n0.8561836\n\n\n\n\n# Preview the FP NMA results\nkable(head(i$FPNMA$means))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ntime\nintervention_code\nreference_treatment_code\nline\nendpoint\npopulation\nref_trial_code\nV1\n\n\n\n\n0.4615385\n4\n7\n1\n1\n0\n0\n6.0866273\n\n\n0.6923077\n4\n7\n1\n1\n0\n0\n0.7948374\n\n\n0.9230769\n4\n7\n1\n1\n0\n0\n0.6307802\n\n\n1.1538462\n4\n7\n1\n1\n0\n0\n0.6127038\n\n\n1.3846154\n4\n7\n1\n1\n0\n0\n0.6141338\n\n\n1.6153846\n4\n7\n1\n1\n0\n0\n0.6184885\n\n\n\n\n\nIn both tables, you can see that each row has a HR (hr/V1), and that these are for each combination of:\n\nPopulation (population)\nLine (line)\nTreatment (molecule/intervention_code)\nEndpoint (endpoint)\nReference treatment (referencetreatment/reference_treatment_code)\nReference trial (referencetrial/ref_trial_code)\n\nThe PH NMA results are from a Bayesian analysis and so has lots of samples for each HR (10,000). Hence, the filename is PH_NMA_CODA.rds, with CODA referring to “Convergence Diagnosis and Output Analysis”. When you run a Bayesian analysis, CODA samples are samples from the posterior distribution of your model parameters - in this case, the HRs.\n\nmax(i$PHNMA$data$run)\n\n[1] 10000\n\n\nThe FP NMA results are also from a Bayesian analysis, but a mean has been taken of each sample. Hence, the filename FPNMA_means.rds. However, it does have another column time, which is present as FP NMA generates time-varying HR.",
    "crumbs": [
      "Code walkthrough",
      "Input data"
    ]
  },
  {
    "objectID": "pages/input_data.html#individual-patient-data-ipd-from-the-real-world-evidence-rwe",
    "href": "pages/input_data.html#individual-patient-data-ipd-from-the-real-world-evidence-rwe",
    "title": "Input data",
    "section": "Individual patient data (IPD) from the real-world evidence (RWE)",
    "text": "Individual patient data (IPD) from the real-world evidence (RWE)\n\n\n\n\n\n\nIPD_R_input_noACIC.xlsx\n\n\n\n\n\nThis data represents the results from the RWE study by Challapalli et al. 2022, [1] with the patient-level data from that study shared by the owners of the dataset. In the publicly available version, data has been simulated to replaced data considered confidential by either the UK RWE dataholders or involved companies. The workbook has a sheet IPD which contains the patient-level data we want to import.\n\n# Import data from excel\nexcel_path2 &lt;- \"../../1_Data/IPD_R_input_noACIC.xlsx\"\nwb &lt;- f_excel_extract(excel_path2, verbose = FALSE)\n\n# Save to `i` as a data table\n# (`surv` as will use this data in survival analysis, and `pld` as it is\n# patient-level data)\ni$surv$pld &lt;- as.data.table(wb$`_xlnm._FilterDatabase`)\n\n# Preview data table\nkable(head(i$surv$pld))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nID\npopulation\nline\nmolecule\ntrial\nendpoint\ntimew\nevent_censor\nTimeoriginalunits\n\n\n\n\n6477\n0\n1\n1\n0\n0\n205.28572\n1\n205.28572\n\n\n6478\n0\n1\n1\n0\n0\n40.00357\n0\n40.00357\n\n\n6479\n0\n1\n1\n0\n0\n145.42857\n0\n145.42857\n\n\n6480\n0\n1\n1\n0\n0\n108.85714\n1\n108.85714\n\n\n6481\n0\n1\n1\n0\n0\n86.85714\n1\n86.85714\n\n\n6482\n0\n1\n1\n0\n0\n53.42857\n0\n53.42857\n\n\n\n\n\nEach row represents a patient. It states their:\n\nPopulation, line, treatment and trial\nEndpoint (e.g. overall survival (OS), progression-free survival (PFS))\nAt the timepoint given by timew (which is the time in weeks), whether they have experienced the event (event_censor). This can either be:\n\n1 - indicating the event occurred (e.g. patient died)\n0 - meaning their point is censored, so at the point when timing stopped (for whatever reason), the event had not occurred",
    "crumbs": [
      "Code walkthrough",
      "Input data"
    ]
  },
  {
    "objectID": "pages/input_data.html#results-from-the-survival-analysis-on-the-rwe-ipd-data",
    "href": "pages/input_data.html#results-from-the-survival-analysis-on-the-rwe-ipd-data",
    "title": "Input data",
    "section": "Results from the survival analysis on the RWE IPD data",
    "text": "Results from the survival analysis on the RWE IPD data\n\n\n\n\n\n\nsurvival_analysis_no_ipd_CompanyTTDTTPPPS_redacted.rds\n\n\n\n\n\nThis R data file contains the results from a pre-run survival analysis on the patient-level RWE data (i.e. the output of the if statement run if i$dd_run_surv_reg == \"Yes\" in Model_Structure.R). In the publicly available version, time to discontinuation (TTD) and time to progression (TTP) are set equal to PFS in order to protect data considered confidential by the involved companies, and post-progression survival (PPS) is set equal to the UK RWE\nThe R data file is a large nested list from which you can select a:\n\nPopulation (pop_0 to pop_2)\nLine (line_1 to line_5)\nMolecule (mol_0 to mol_12 and mol_990)\nTrial (trial_0 to `trial_2)\nEndpoint (endpoint_0 to endpoint_4)\n\nThere are then results with:\n\nfs_fits\ngof\nst\nplot\n\n\nRDS_path &lt;- \"../../1_Data/survival_analysis_no_ipd_CompanyTTDTTPPPS_redacted.rds\"\ni$surv$reg &lt;- readRDS(RDS_path)\n\nExample with no result from survival analysis:\n\ni$surv$reg$pop_0$line_1$mol_0$trial_0$endpoint_0\n\n$pop\n[1] \"All\"\n\n$line\n[1] \"Previously untreated\"\n\n$mol\n[1] \"Nivolumab monotherapy\"\n\n$tr\n[1] \"CheckMate 9ER\"\n\n$endpoint\n[1] \"OS\"\n\n$fs_fits\nNULL\n\n$gof\nNULL\n\n$st\nNULL\n\n$plot\nNULL\n\n\nExample with a result - PFS on avelumab plus axitinib as a 1L treatment in a favourable risk population based on the real world evidence.\n\nlapply(c(\"pop\", \"line\", \"mol\", \"tr\", \"endpoint\"), function(x) i$surv$reg$pop_2$line_1$mol_4$trial_2$endpoint_1[[x]])\n\n[[1]]\n[1] \"Favourable risk\"\n\n[[2]]\n[1] \"Previously untreated\"\n\n[[3]]\n[1] \"Avelumab plus axitinib\"\n\n[[4]]\n[1] \"Real world evidence\"\n\n[[5]]\n[1] \"PFS\"\n\n\nVarious distributions were fit - for example, exponential…\n\ni$surv$reg$pop_2$line_1$mol_4$trial_2$endpoint_1$fs_fits$exp\n\n$coefs\n[1] -5.016078\n\n$vcov\n           rate\nrate 0.03846153\n\n$fit\n      AIC       BIC    logLik \n 314.8361  316.9792 -156.4180 \n\n\nThe goodness of fit for each distribution is described…\n\nkable(i$surv$reg$pop_2$line_1$mol_4$trial_2$endpoint_1$gof)\n\n\n\n\n\nAIC\nBIC\nlogLik\n\n\n\n\ngengamma\n317.6759\n324.1053\n-155.8380\n\n\nexp\n314.8361\n316.9792\n-156.4180\n\n\nweibull\n316.2418\n320.5281\n-156.1209\n\n\nlnorm\n316.5742\n320.8604\n-156.2871\n\n\ngamma\n316.0581\n320.3443\n-156.0290\n\n\ngompertz\n316.8228\n321.1090\n-156.4114\n\n\nllogis\n315.2343\n319.5206\n-155.6172\n\n\n\n\n\nAnd the extrapolated survival times are provided from survival analysis using each distribution…\n\nkable(head(i$surv$reg$pop_2$line_1$mol_4$trial_2$endpoint_1$st, 10))\n\n\n\n\n\n\n\n\n\n\n\n\n\ngengamma\nexp\nweibull\nlnorm\ngamma\ngompertz\nllogis\n\n\n\n\n1.0000000\n1.0000000\n1.0000000\n1.0000000\n1.0000000\n1.0000000\n1.0000000\n\n\n0.9985777\n0.9933915\n0.9964812\n0.9996291\n0.9972167\n0.9935903\n0.9980669\n\n\n0.9958140\n0.9868266\n0.9922259\n0.9979763\n0.9935048\n0.9872169\n0.9950622\n\n\n0.9922663\n0.9803051\n0.9876526\n0.9950948\n0.9893592\n0.9808795\n0.9914695\n\n\n0.9881616\n0.9738267\n0.9828687\n0.9912317\n0.9849185\n0.9745780\n0.9874457\n\n\n0.9836342\n0.9673911\n0.9779288\n0.9866047\n0.9802557\n0.9683123\n0.9830798\n\n\n0.9787752\n0.9609981\n0.9728668\n0.9813859\n0.9754168\n0.9620820\n0.9784315\n\n\n0.9736504\n0.9546473\n0.9677061\n0.9757088\n0.9704341\n0.9558872\n0.9735446\n\n\n0.9683099\n0.9483384\n0.9624641\n0.9696773\n0.9653318\n0.9497276\n0.9684535\n\n\n0.9627928\n0.9420713\n0.9571540\n0.9633732\n0.9601284\n0.9436030\n0.9631860",
    "crumbs": [
      "Code walkthrough",
      "Input data"
    ]
  },
  {
    "objectID": "pages/walkthrough/code5_model.html",
    "href": "pages/walkthrough/code5_model.html",
    "title": "Economic modelling",
    "section": "",
    "text": "This page runs the economic model.",
    "crumbs": [
      "Code walkthrough",
      "Economic modelling"
    ]
  },
  {
    "objectID": "pages/walkthrough/code5_model.html#final-pre-processing-steps",
    "href": "pages/walkthrough/code5_model.html#final-pre-processing-steps",
    "title": "Economic modelling",
    "section": "Final pre-processing steps",
    "text": "Final pre-processing steps\nA table with some settings is add to p.\n\n# 3.6 PATIENT FLOW ------------------------------------------------------\n# Now that we have all of the disease evidence and modeled outcomes available,\n# we can compute the disease model. In the deterministic case, this will simply \n# be a trace for both the PS and Markov models. \n\ni$R_table_eff_data_settings &lt;- data.table(i$R_table_eff_data_settings)\np$releff$excel_table &lt;- i$R_table_eff_data_settings\n\n\n\n\n\n\n\nView p$releff$excel_table\n\n\n\n\n\n\nkable(head(p$releff$excel_table))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPopulation\nPopulation.name\nTreatment.line\nMolecule\nTreatment.name\nInclude.in.this.analysis.\nEnd.point\nEnd.point.name\nEffectiveness.data.source\nTrial.name.if.effectiveness.source.is.trial\nOrigin.population\nOrigin.line\nOrigin.treatment\nOrigin.trial\nOrigin.endpoint\nCurve.fit..for.survival.analysis.\nHR.to.apply\nHR.95..CI..LCL.\nHR.95..CI..UCL.\nTrial\n\n\n\n\n1\nPoor/intermediate risk\n1\n0\nnivolumab_monotherapy\nNo\n0\nOverall survival\n0\n0\n1\n1\n7\n2\n0\nExponential\n0.000\n0.0\n0.000\nNA\n\n\n1\nPoor/intermediate risk\n1\n1\ncabozantinib_plus_nivolumab\nYes\n0\nOverall survival\nFP_NMA\n0\n1\n1\n7\n2\n0\nExponential\n0.000\n0.0\n0.000\nNA\n\n\n1\nPoor/intermediate risk\n1\n2\nnivolumab_plus_ipilimumab\nYes\n0\nOverall survival\nFP_NMA\n0\n1\n1\n7\n2\n0\nExponential\n0.000\n0.0\n0.000\nNA\n\n\n1\nPoor/intermediate risk\n1\n3\nlenvatinib_plus_pembrolizumab\nYes\n0\nOverall survival\nApply HR to\n0\n1\n1\n1\n2\n0\nNA\n1.134\n0.8\n1.619\nNA\n\n\n1\nPoor/intermediate risk\n1\n4\navelumab_plus_axitinib\nNo\n0\nOverall survival\nPH_NMA\n0\n1\n1\n7\n2\n0\nExponential\n0.000\n0.0\n0.000\nNA\n\n\n1\nPoor/intermediate risk\n1\n5\npazopanib\nYes\n0\nOverall survival\nAssume equal to\n0\n1\n1\n7\n2\n0\nExponential\n0.000\n0.0\n0.000\nNA\n\n\n\n\n\n\n\n\nThe script also confirms that the specified model structure is a valid option (from i$dd_model_struct, and again a bit later from p$basic$structure).\n\n\n\n\n\n\nView default model structure\n\n\n\n\n\n\ni$dd_model_struct\n\n[1] \"State transition\"\n\np$basic$structure\n\n[1] \"State transition\"\n\n\n\n\n\nThe comments in the code provide some description of the modelling, which is a survival analysis using either a state transition (markov) model or partitioned state survival model.\n\nif(!str_trim(i$dd_model_struct) %in% c(\"State transition\", \"Partitioned survival\")) stop(\n  \"The model structure is not one of the available options. These are 'State transition' and 'Partitioned survival'. Either code or the excel file are out of date or wrongly set up\"\n)\n\n# The process of computing patient flow is as follows:\n# \n#   - Create an empty object for housing the patient flow (a list)\n#   - Populate the trace with either disease modelling approach\n#   - Record metadata on the approach, as this determines what the trace looks like\n#   - Compute costs based on time in state\n#   - Compute QALYs based on time in state\n#   - Compute AEs based on time in state\n#     - Costs\n#     - QALYs\n#   - Return the populated pf list\n# \n\n\npf &lt;- list()\nres &lt;- list()\n\n\n# 3.6.1 Run the model -----------------------------------------------------\n\n# Running the model can mean two different structures, a markov model which \n# we refer to as state transition or a partitioned survival approach. These\n# both work using the same parameters object p. There is only one function\n# to compute patient flow, f_pf_computePF. This takes several different arguments\n# but the main one is p, or the parameters object to power the model with. \n# Everything within f_pf_computePF uses objects which are within p, such that\n# a copy of p could be saved as a file and as long as all functions have been\n# defined and packages loaded the model can be run directly from there. \n\n# The only structures allowed are state transition and partitioned survival. error\n# if it is not one of those:\nstopifnot(p$basic$structure %in% c(\"State transition\",\"Partitioned survival\"))\n\nThis code then checks whether the decision problem is “cabozantinib plus nivolumab” - in which case, the first three populations are relevant, as the final three populations can’t receive this treatment.\n\n\n\n\n\n\nView default decision problem\n\n\n\n\n\n\np$basic$decision_problem\n\n[1] \"cabo+nivo\"\n\n\n\n\n\n\n# Check the decision problem. If it's cabo+nivo only the first 3 overall\n# populations are relevant as one cannot get cabo+nivo in pops 4-6\nif(p$basic$decision_problem == \"cabo+nivo\") {\n  p$basic$pops_to_run &lt;- 1:3\n} else {\n  p$basic$pops_to_run &lt;- NULL\n}\n\nThe objects p and i, which contain the parameters used to run the model, can be save as .rds files to make it easier to re-run the model.\n\n# populate the pf object irrespective of model structure or overall populations\n# to include.\n# \n# Note that if you put n_cores as NULL or 1 then the model will run in sequence.\n\n# For QC, you can easily just save i and p as a file so all you need to do is\n# load libraries to repeat the results and QC things:\n\nsaveRDS(p, file.path(s_path,\"standalone scripts/QC/p.rds\"))\nsaveRDS(i, file.path(s_path, \"standalone scripts/QC/i.rds\"))\n# \n# If you run the model using scenario 1 (rather than base case scenario 0)\n# It will be a partitioned survival model. in that case it's a good idea to \n# save a backup of p and i under a different name so that you have an input\n# set for the paritioned survival model to hand at any time.\n# \n# saveRDS(p,\"./2_Scripts/standalone scripts/QC/p_PS.rds\")\n# saveRDS(i,\"./2_Scripts/standalone scripts/QC/i_PS.rds\")\n                          \n# p &lt;- readRDS(\"./2_Scripts/standalone scripts/QC/p.rds\")\n# i &lt;- readRDS(\"./2_Scripts/standalone scripts/QC/i.rds\")",
    "crumbs": [
      "Code walkthrough",
      "Economic modelling"
    ]
  },
  {
    "objectID": "pages/walkthrough/code5_model.html#run-the-model",
    "href": "pages/walkthrough/code5_model.html#run-the-model",
    "title": "Economic modelling",
    "section": "Run the model",
    "text": "Run the model\nThe survival analysis run using f_pf_computePF(). This function can take a while to run. For the purposes of this walkthrough, the code has been modified using if(FALSE){} to prevent the function from running and, instead, a set of pre-run model results are loaded.\n\n\n\n\n\n\nFurther info about pre-run model results\n\n\n\n\n\nThe model result file is very large and, as such, cannot be easily synced with GitHub. Therefore, in order to run this script on a new machine (as described in the walkthrough README), you will need to run Model_Structure.R (or the walkthrough .qmd file) to generate the file.\n\n\n\nThe function f_pf_compute_PF() will use either:\n\nf_pf_computePF_mk() (if state transition model, i.e. Markov model)\nf_pf_computePF_ps() (if partitioned survival model)\n\nThe purpose of this is to model how patients move through different health states/treatments, from which we can find outputs like costs and utilities.\nState transition model. Steps include:\n\nGetting relevant population data and creating sequence_list with the allowed treatment sequences for a given population\nCreating util_gpop_mat - a matrix of health state utility values that account for ageing\nTransition probabilities (TPs) are calculated for each sequence, then used to construct Markov traces (TRACE) (ie. matrix of state vectors across all model cycles)\nThese are used to calculate costs through the treatment sequence (pf_costs) (e.g. cost per cycle cpc, costs on initiation coi, and costs on death cod), QALYs pf_qalys) and adverse events (pf_ae)\n\nPartitioned survival model. Steps include:\n\nGetting relevant population data and creating the utility matrix util_gpop_mat\nUsing f_pf_partSA_state_res(), simulates patient states (e.g. PFS) across time horizon for each treatment sequence, returns the costs (costs) and QALYs (qalys)\n\n\n# Make this NA to run single core:\nif(FALSE){\n  tick &lt;- Sys.time()\n  pf &lt;- f_pf_computePF(\n    p           = p,\n    struct      = p$basic$structure,\n    verbose     = FALSE,\n    plots       = FALSE,\n    just_pop    = p$basic$pops_to_run,\n    just_nlines = NULL,\n    just_seq    = NULL\n  )\n  print(Sys.time() - tick)\n}\n\n# if (is.na(keep_free_cores)) {\n#   plan(sequential)\n# } else {\n#   plan(multisession(workers = max(availableCores()-keep_free_cores,1)))\n# }\n\n# Save result\n# computepf_file = file.path(d_path, \"computepf_example.rds\")\n# saveRDS(pf, file=computepf_file)\n# Load result\ncomputepf_file = file.path(d_path, \"computepf_example.rds\")\npf &lt;- readRDS(computepf_file)",
    "crumbs": [
      "Code walkthrough",
      "Economic modelling"
    ]
  },
  {
    "objectID": "pages/walkthrough/code5_model.html#analyse-the-model-results",
    "href": "pages/walkthrough/code5_model.html#analyse-the-model-results",
    "title": "Economic modelling",
    "section": "Analyse the model results",
    "text": "Analyse the model results\nThe model results are compiled using f_res_compute_results() which will then use either:\n\nf_res_compute_results_mk() for the state transition model\nf_res_compute_results_ps() for the partitioned survival model\n\nThese each in turn utilities various other functions to summarise the model results. There are various functions, depending on the level of detail desired in the plots. This is set to either 4 or 5, depending on whether it is scenario 0.\nThe summary functions include:\n\nf_pf_mk_summary() to get undisc and disc results (undiscounted and discounted)\nf_res_mk_incremental() to get incremental\nf_res_wa_model() to get weighted_model discounted or undiscounted, summarised using f_res_sum_weighted_model()\nf_pf_wa_sr_plots() to get weighted_trace_plots\n\nAnd more! As summarised in code comments below, the outcomes of this from each detail level are:\n\nTop line results by sequence and weighted average results (costs, QALYs, LYs)\nInclude incremental analysis (from f_res_mk_incremental())\nInclude weighted average pairwise comparisons\nInclude incremental analysis by sequence\nInclude trace plots\n\nExcept for the partitioned survival, 4 is breakdown tables and 4 is state residency plots.\n\n# 3.6.2 Compiling model results -------------------------------------------\n\n# Depending on which model structure is used to compute patient flow, the results\n# are processed in different ways. The below function simply routes the pf object\n# to the appropriate function to process the results, and returns an object\n# res containing the results:\n\nScenario_number &lt;- i$R_Scenario_num\n\nif(Scenario_number == 0) {detail_level &lt;- 5} else {detail_level &lt;- 4}\n# Detail level guide:\n\n# State transition\n# 1 is top line results by sequence (costs, QALYs, LYs) and weighted average results\n# 2 is just the top line table and non-dominated weighted average incremental results\n# 3 includes weighted average pairwise comparisons\n# 4 includes incremental analysis by sequence \n# 5 includes trace plots  \n\n# PartSA analysis\n# 1 is top line results for the PartSA analysis (costs, QALYs, LYs)\n# 2 is incremental analysis as well\n# 3 includes breakdown tables as well\n# 4 includes state residency plots\n\nres &lt;- f_res_compute_results(\n  pf              = pf,\n  structure       = p$basic$structure,\n  p               = p,\n  detail_level    = detail_level,\n  vs_mol          = 1,\n  no_active_lines = i$R_max_trt_lines\n)\n\n\n\n\n\n\n\nView res\n\n\n\n\n\nA few examples of results from res are shown below…\n\nkable(head(res$undisc$pop_1$ly$breakdown, 3))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ntrt_n\ntrt\nL1_on\nL1_off\nBSC\nL2_on\nL2_off\nL3_on\nL3_off\nL4_on\nL4_off\n\n\n\n\n1→999\nCabozantinib plus nivolumab→Placebo / BSC\n1.945363\n0.1088617\n0.3625033\nNA\nNA\nNA\nNA\nNA\nNA\n\n\n5→999\nPazopanib→Placebo / BSC\n1.144445\n0.1148029\n0.3673995\nNA\nNA\nNA\nNA\nNA\nNA\n\n\n7→999\nSunitinib→Placebo / BSC\n1.144445\n0.1148029\n0.3673995\nNA\nNA\nNA\nNA\nNA\nNA\n\n\n\n\nkable(head(res$incremental$pop_1$expanded_results, 3))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ntrt_n\ntrt\ncosts\nqalys\nly\nL1\nstr_dom\nextdom\nic\niq\nil\nICER\nr\n\n\n\n\n7→999\nSunitinib→Placebo / BSC\n22826.06\n1.085297\n1.626648\n7|999\nFALSE\nFALSE\n0.000\n0.0000000\n0.000000\n0.00\n1\n\n\n5→999\nPazopanib→Placebo / BSC\n24690.10\n1.085678\n1.626648\n5|999\nFALSE\nTRUE\nNA\nNA\nNA\nNA\n2\n\n\n7→10→999\nSunitinib→Everolimus→Placebo / BSC\n31562.18\n1.399302\n2.169939\n7|10|999\nFALSE\nFALSE\n8736.118\n0.3140051\n0.543291\n27821.58\n3\n\n\n\n\nres$weighted_trace_plots$pop_1$plots$L1_1\n\n\n\n\n\n\n\nres$wa_summarised$pop_1$costs\n\n[1] 268538.83  80398.95 100004.76  77049.92\n\nres$pairwise_vs_mol$pop_1$qalys\n\n[1] 2.253814 1.712196 1.674692 1.684174",
    "crumbs": [
      "Code walkthrough",
      "Economic modelling"
    ]
  },
  {
    "objectID": "pages/walkthrough/code5_model.html#severity-modifier",
    "href": "pages/walkthrough/code5_model.html#severity-modifier",
    "title": "Economic modelling",
    "section": "Severity modifier",
    "text": "Severity modifier\nA severity modifier is implemented for the state transition model (and not for the partitioned survival model). These are used to weight QALYs for conditions with a high degree of severity.\nThe result of this section is res$mk$qaly_shortfall_1_to_3 which is a list of three lists, each containing the QALY adjustments for each population.\n\n# 3.6.3 Calculate severity modifier -----------------------------------\n\n# The severity modifier for the weighted average first-line treatment comparison\n# uses the best available treatment which is not nivo cabo (molecule 1) for the\n# first 3 populations. \n# \n# This is because this is the best (i.e. most discounted QALYs) available 1L trt\n# pathway set.\n#\n# Calculation is only provided for the state transition model\n\n\nif (p$basic$structure == \"State transition\") {\n  population_numbers &lt;- if(sum(p$basic$pops_to_run == 1:3)&gt;0){1:3} else{1:6}\n  res$mk$qaly_shortfall_1_to_3 &lt;- lapply(population_numbers, function(npa_pop) {\n    \n    lu_pop &lt;- p$basic$lookup$pop_map\n    lu_rpop &lt;- p$basic$lookup$ipd$pop\n    \n    # npa_pop is overall population, we need to look up risk population from it:\n    \n    risk_pop_n &lt;- lu_pop[match(npa_pop,lu_pop$Overall.population.number),]$Risk.population.number\n    risk_pop &lt;- lu_rpop[match(risk_pop_n,lu_rpop$Number),]$Description  \n    \n    i$R_table_ptchar &lt;- as.data.table(i$R_table_ptchar)\n    \n    if (i$dd_age_sex_source == \"Mean\") {\n      \n      # So for this risk population, we need the baseline characteristics:\n      bl_chars &lt;- i$R_table_ptchar[Population == risk_pop & Treatment.line == 1,]\n      bl_age  &lt;- bl_chars$Starting.age..years..Mean\n      bl_male &lt;- 1-bl_chars$Starting...female.Mean\n      \n    } else {\n      \n      patient_sex_age_IPD &lt;- as.data.table(i$R_table_patientagesex)\n      patient_sex_age_IPD$Gender &lt;- replace(patient_sex_age_IPD$Gender, patient_sex_age_IPD$Gender==\"M\",\"male\")\n      patient_sex_age_IPD$Gender &lt;- replace(patient_sex_age_IPD$Gender, patient_sex_age_IPD$Gender==\"F\",\"female\")\n      \n      bl_age &lt;- patient_sex_age_IPD[Line ==1]$Age \n      bl_male &lt;- patient_sex_age_IPD[Line ==1]$Gender\n      \n    }\n    \n    pna_txt &lt;- names(res$wa_summarised)[npa_pop]\n    \n    tab &lt;- res$wa_summarised[[pna_txt]][L1 != 1,]\n    \n    met &lt;- tab[which.max(qalys),]\n    \n    q_met &lt;- met$qalys\n    comp_no_met &lt;- met$L1\n    \n    out &lt;-    calc_severity_modifier(\n      age = bl_age,\n      sex = bl_male,\n      .patient_level = if(i$dd_age_sex_source == \"Mean\") {FALSE} else {TRUE},  \n      qalys = q_met,\n      .i = i,\n      .p = p\n    )\n    \n    out &lt;- cbind(out, SOC = comp_no_met)\n    \n    return(out)\n    \n  })\n}\n\n\n\n\n\n\n\nHow is the severity modifier calculated?\n\n\n\n\n\nThere are first a few processing steps before the function to calculate severity, calc_severity_modifier(). Looking at an example of npa_pop=1, we start with getting the look-up for the population and the population mappings.\n\nnpa_pop = 1\n\nlu_pop &lt;- p$basic$lookup$pop_map\nlu_rpop &lt;- p$basic$lookup$ipd$pop\n\nlu_pop\n\n\n\nlu_rpop\n\n\n\n\nThe risk population can then be identified - in this case “0” or “All risk”.\n\n# npa_pop is overall population, we need to look up risk population from it:\n\nrisk_pop_n &lt;- lu_pop[match(npa_pop,lu_pop$Overall.population.number),]$Risk.population.number\nrisk_pop &lt;- lu_rpop[match(risk_pop_n,lu_rpop$Number),]$Description  \n\nrisk_pop_n\n\n[1] 0\n\nrisk_pop\n\n[1] \"All\"\n\n\nThe patient characteristics table from excel is converted into a data table (if not already).\n\ni$R_table_ptchar &lt;- as.data.table(i$R_table_ptchar)\nkable(head(i$R_table_ptchar))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPopulation\nTreatment.line\nStarting.age..years..Mean\nStarting…female.Mean\nStarting…PorI.risk.Mean\nBody.weight..kg..Mean\nPrior.IO…in.12.months.Mean\nStarting.age..years..n\nStarting…female.n\nStarting…PorI.risk.n\nBody.weight..kg..n\nStarting…PIR.n\nPrior.IO…in.12.months.n\nStarting.age..years..SE\nStarting…female.SE\nStarting…PorI.risk.SE\nBody.weight..kg..SE\nPrior.IO…in.12.months.SE\n\n\n\n\nAll\n1\n64.40\n0.2903715\n0.7755725\n83.38000\n0\n1311\n1319\n1310\n114\n1310\n1319\n0.2856284\n0.0124989\n0.0115269\n1.686593\n0\n\n\nPoor / intermediate risk\n1\n64.20\n0.2952756\n1.0000000\n81.26353\n0\n1011\n1016\n0\n114\n0\n1319\n0.3273973\n0.0143112\n0.0000000\n1.686593\n0\n\n\nFavourable risk\n1\n65.40\n0.2653061\n0.0000000\n90.98037\n0\n293\n294\n0\n114\n0\n1319\n0.5596696\n0.0257486\n0.0000000\n1.686593\n0\n\n\nAll\n2\n63.04\n0.2848101\n0.0000000\n83.38000\n0\nNA\nNA\nNA\nNA\nNA\nNA\n0.4186000\n0.0179527\n0.0000000\n1.686593\n0\n\n\nAll\n3\n62.62\n0.2850467\n0.0000000\n83.38000\n0\nNA\nNA\nNA\nNA\nNA\nNA\n0.7288700\n0.0308596\n0.0000000\n1.686593\n0\n\n\nAll\n4\n62.37\n0.2962963\n0.0000000\n83.38000\n0\nNA\nNA\nNA\nNA\nNA\nNA\n1.2498500\n0.0621386\n0.0000000\n1.686593\n0\n\n\n\n\n\nWith our source of IPD (as from i$dd_age_sex_source), this code then created lists with the ages and genders of each person in the IPD.\n\npatient_sex_age_IPD &lt;- as.data.table(i$R_table_patientagesex)\npatient_sex_age_IPD$Gender &lt;- replace(patient_sex_age_IPD$Gender, patient_sex_age_IPD$Gender==\"M\",\"male\")\npatient_sex_age_IPD$Gender &lt;- replace(patient_sex_age_IPD$Gender, patient_sex_age_IPD$Gender==\"F\",\"female\")\n\nbl_age &lt;- patient_sex_age_IPD[Line ==1]$Age \nbl_male &lt;- patient_sex_age_IPD[Line ==1]$Gender\n\nhead(bl_age)\n\n[1] 46.36414 74.09583 55.18070 69.14784 78.15880 79.32854\n\nhead(bl_male)\n\n[1] \"male\"   \"male\"   \"female\" \"male\"   \"male\"   \"male\"  \n\n\nThe name of the population is created based on npa_pop.\n\npna_txt &lt;- names(res$wa_summarised)[npa_pop]\npna_txt\n\n[1] \"pop_1\"\n\n\nThe economic model results for that population are identified for treatments except L1 treatment of molecule 1.\n\ntab &lt;- res$wa_summarised[[pna_txt]][L1 != 1,]\nkable(tab)\n\n\n\n\nL1\ncosts\nqalys\nly\n\n\n\n\n5\n80398.95\n1.712196\n2.836778\n\n\n6\n100004.76\n1.674692\n2.764879\n\n\n7\n77049.92\n1.684174\n2.780869\n\n\n\n\n\nFrom that, the treatment with the maximum QALYs is identified, and the QALYs and treatment were extracted\n\nmet &lt;- tab[which.max(qalys),]\nq_met &lt;- met$qalys\ncomp_no_met &lt;- met$L1\n\nkable(met)\n\n\n\n\nL1\ncosts\nqalys\nly\n\n\n\n\n5\n80398.95\n1.712196\n2.836778\n\n\n\n\n\nThese results were then used in the function calc_severity_modifier(). That function uses get_severity_modifier() to find the appropriate severity modifier according to the discounted QALYs for those with the condition and those without.\nThis was repeated for the three populations, generating three results lists, which have been combined into the table below:\n\n# The three lists of results, combined into a single table\nkable(bind_rows(res$mk$qaly_shortfall_1_to_3))\n\n\n\n\nqaly_soc\nqaly_gpop\nabs_sf\nprop_sf\nmodifier\nSOC\n\n\n\n\n1.712196\n10.38197\n8.669771\n0.8350798\n1\n5\n\n\n2.243521\n10.38197\n8.138445\n0.7839021\n1\n5\n\n\n2.013113\n10.38197\n8.368854\n0.8060952\n1\n3",
    "crumbs": [
      "Code walkthrough",
      "Economic modelling"
    ]
  },
  {
    "objectID": "pages/walkthrough/code5_model.html#save-the-results",
    "href": "pages/walkthrough/code5_model.html#save-the-results",
    "title": "Economic modelling",
    "section": "Save the results",
    "text": "Save the results\nThis code chunks saves the res list as an .rds file, although that has been disabled for the purpose of this walkthrough.\n\n# 3.6.4 Saving the results ------------------------------------------------------\n\n# the results are in list format so should be saved as an R list file (.rds)\n# The naming of the file should reflect the model structure used. The file\n# produced has a time stamp to avoid overwriting previous results files.\n\nif(FALSE){\n  Scenario_name &lt;- i$R_Scenario_name    # Use ST for state transition, PS for Partitioned survival, LP for list price, cPAS for cPAS\n  Scenario_number &lt;- i$R_Scenario_num\n  Run_date &lt;- date()\n  if (p$basic$structure == \"State transition\") {\n    saveRDS(res, file.path(o_path, paste0(\n      \"ST_Scenario \", Scenario_number,\"_\",i$dd_drug_price_options,gsub(\":\",\"_\",Run_date),\".rds\")))\n  } else {\n    saveRDS(res, file.path(o_path, paste0(\n      \"PartSA_Scenario \",Scenario_number,\"_\",i$dd_drug_price_options,gsub(\":\",\"_\",Run_date),\".rds\")))\n  }\n}",
    "crumbs": [
      "Code walkthrough",
      "Economic modelling"
    ]
  },
  {
    "objectID": "pages/walkthrough/code5_model.html#creating-the-report",
    "href": "pages/walkthrough/code5_model.html#creating-the-report",
    "title": "Economic modelling",
    "section": "Creating the report",
    "text": "Creating the report\nThe function f_res_ProduceWordDoc() produces a word document report. Depending on p$basic$structure, will either use f_res_ProduceWordDoc_ST() (st - state transition) or f_res_ProduceWordDoc_PS() (ps - partitioned survival) to produce the report content. This applies results tables specific to the cabo+nivo population to the word document, in the format required by NICE.\nThis report is explored in detail on the Report page.\n\n# 3.6.5 Outputting results to Word ------------------------------------------------------\n\n# Outputting the results to word requires a series of functions to produce component\n# parts to go in the report, and then consolidating them all into the requested output.\n\n# Get the functions to produce the word document output:\n\n# Produce an automatically generated word document with required results tables\n# and automatically name it using the variables that are already inside of \n# i and p (including structure, which is located in p$basic$structure. Note\n# that this comes from i$dd_model_struct, i.e. named range dd_model_struct from excel.\n# please ensure that this is updated for PS model scenarios):\n\nWord_width_inches      &lt;-  29.7*0.3937\n\nRun_date &lt;- date()\nf_res_ProduceWordDoc(\n  p                      = p,\n  res                    = res,\n  Scenario_name          = i$R_Scenario_name,\n  Scenario_number        = i$R_Scenario_num,\n  price_options          = i$dd_drug_price_options,\n  Run_date               = Run_date,\n  word_template_location = file.path(f_path, \"reporting/empty results doc.docx\"),\n  Word_width_inches      = 29.7*0.3937,\n  auto_save              = FALSE,\n  verbose = TRUE\n)\n\n\u001b[0;32mWord output for Base case. (scen #0): \u001b[0m\n\u001b[0;31mWord output for Base case. (scen #0): LY breakdown\u001b[0m\n\u001b[0;33mWord output for Base case. (scen #0): QALY breakdown\u001b[0m\n\u001b[0;34mWord output for Base case. (scen #0): Cost breakdown\u001b[0m\n\u001b[0;35mWord output for Base case. (scen #0): Scenario tables\u001b[0m\n\u001b[0;36mWord output for Base case. (scen #0): Severity modifier\u001b[0m\n\u001b[0;37mWord output for Base case. (scen #0): Pairwise results\u001b[0m\n\u001b[0;40mWord output for Base case. (scen #0): Generating word document from results...\u001b[0m\n$L1_1\n\n\n\n$L1_5\n\n\n\n$L1_7\n\n\n\n$L1_6\n\n\n\n$L1_1\n\n\n\n$L1_5\n\n\n\n$L1_7\n\n\n\n$L1_6\n\n\n\n$L1_8\n\n\n\n$L1_1\n\n\n\n$L1_3\n\n\n\n$L1_2\n\n\n\n$L1_5\n\n\n\n$L1_7\n\n\n\n$L1_6\n\n\nrdocx document with 147 element(s)\n\n* styles:\n                         Normal                       heading 1 \n                    \"paragraph\"                     \"paragraph\" \n                      heading 2                       heading 3 \n                    \"paragraph\"                     \"paragraph\" \n                      heading 4                       heading 5 \n                    \"paragraph\"                     \"paragraph\" \n                      heading 6                       heading 7 \n                    \"paragraph\"                     \"paragraph\" \n                      heading 8                       heading 9 \n                    \"paragraph\"                     \"paragraph\" \n         Default Paragraph Font                    Normal Table \n                    \"character\"                         \"table\" \n                        No List            annotation reference \n                    \"numbering\"                     \"character\" \n                annotation text               Comment Text Char \n                    \"paragraph\"                     \"character\" \n             annotation subject            Comment Subject Char \n                    \"paragraph\"                     \"character\" \n                         Strong                    Normal (Web) \n                    \"character\"                     \"paragraph\" \n                 List Paragraph                      Table Text \n                    \"paragraph\"                     \"paragraph\" \n               Table Text Char1                NICEReport-table \n                    \"character\"                         \"table\" \n                 Heading 3 Char              Numbered heading 1 \n                    \"character\"                     \"paragraph\" \n                Bullet indent 1            Bullet indent 1 Char \n                    \"paragraph\"                     \"character\" \n           Bullet indent 1 last              Numbered heading 2 \n                    \"paragraph\"                     \"paragraph\" \n        Numbered heading 2 Char           Numbered level 3 text \n                    \"character\"                     \"paragraph\" \n                 Heading 1 Char                  Heading 2 Char \n                    \"character\"                     \"character\" \n                        Mention                   footnote text \n                    \"character\"                     \"paragraph\" \n             Footnote Text Char             ACIC-Clear-MainText \n                    \"character\"                     \"character\" \n           ACIC-Clear-TableText                             AIC \n                    \"character\"                     \"character\" \n                      app:head1                       app:head2 \n                    \"paragraph\"                     \"paragraph\" \n                      app:head3                    Balloon Text \n                    \"paragraph\"                     \"paragraph\" \n              Balloon Text Char                       list:bull \n                    \"character\"                     \"paragraph\" \n                 list:bull Char                            blue \n                    \"character\"                     \"paragraph\" \n           Borderless (Relaxed)                   Bullet left 1 \n                        \"table\"                     \"paragraph\" \n             Bullet left 1 Char              Bullet left 1 last \n                    \"character\"                     \"paragraph\" \n        Bullet left 1 last Char                   Bullet left 2 \n                    \"character\"                     \"paragraph\" \n             Bullet left 2 last         Bullet left 2 last Char \n                    \"paragraph\"                     \"character\" \n                  Bullet left 3                Bullet list left \n                    \"paragraph\"                     \"numbering\" \n                        caption                    Caption Char \n                    \"paragraph\"                     \"character\" \n                     centhead12                            cf01 \n                    \"paragraph\"                     \"character\" \n                            CIC             c-mrkdwn__highlight \n                    \"character\"                     \"character\" \n                        Default                    Document Map \n                    \"paragraph\"                     \"paragraph\" \n              Document Map Char            EndNote Bibliography \n                    \"character\"                     \"paragraph\" \n      EndNote Bibliography Char      EndNote Bibliography Title \n                    \"character\"                     \"paragraph\" \nEndNote Bibliography Title Char                             eop \n                    \"character\"                     \"character\" \n                        findhit               FollowedHyperlink \n                    \"character\"                     \"character\" \n                         footer                     Footer Char \n                    \"paragraph\"                     \"character\" \n             footnote reference              Grid Table 1 Light \n                    \"character\"                         \"table\" \n    Grid Table 1 Light Accent 3                    Grid Table 2 \n                        \"table\"                         \"table\" \n                   Grid Table 3                    Grid Table 4 \n                        \"table\"                         \"table\" \n                         header                     Header Char \n                    \"paragraph\"                     \"character\" \n                 Heading 4 Char                  Heading 5 Char \n                    \"character\"                     \"character\" \n                 Heading 6 Char                  Heading 7 Char \n                    \"character\"                     \"character\" \n                 Heading 8 Char                  Heading 9 Char \n                    \"character\"                     \"character\" \n                    Hidden Text                Hidden Text Char \n                    \"paragraph\"                     \"character\" \n                       HTAtable                       Hyperlink \n                        \"table\"                     \"character\" \n                      left head                      lefthead12 \n                    \"paragraph\"                     \"paragraph\" \n                      lh:NonTOC                     lh:NonTOC12 \n                    \"paragraph\"                     \"paragraph\" \n               lh:NonTOC12 Char                     list:indent \n                    \"character\"                     \"paragraph\" \n               list:indent Char                list:indent bull \n                    \"character\"                     \"paragraph\" \n          list:indent bull Char                        list:num \n                    \"character\"                     \"paragraph\" \n                  list:num Char                        Mention1 \n                    \"character\"                     \"character\" \n            NICE figure caption        NICE figure caption Char \n                    \"paragraph\"                     \"character\" \n                    NICE normal                NICE normal Char \n                    \"paragraph\"                     \"character\" \n                    NoNum:Head1                     NoNum:Head2 \n                    \"paragraph\"                     \"paragraph\" \n                    NoNum:Head3                NoNum:Head3 Char \n                    \"paragraph\"                     \"character\" \n                    NoNum:Head4                NoNum:Head4 Char \n                    \"paragraph\"                     \"character\" \n                    NoNum:Head5                   normaltextrun \n                    \"paragraph\"                     \"character\" \n                    page number                       paragraph \n                    \"character\"                     \"paragraph\" \n               Placeholder Text                  Plain Table 21 \n                    \"character\"                         \"table\" \n                    quote:block                     quote:short \n                    \"paragraph\"                     \"character\" \n                       Subtitle                   Subtitle Char \n                    \"paragraph\"                     \"character\" \n                    superscript                      Table text \n                    \"character\"                     \"paragraph\" \n                Table text Char                  Table bullet 1 \n                    \"character\"                     \"paragraph\" \n            Table bullet 1 Char                  Table bullet 2 \n                    \"character\"                     \"paragraph\" \n            Table bullet 2 Char                  Table footnote \n                    \"character\"                     \"paragraph\" \n            Table footnote Char                      Table Grid \n                    \"character\"                         \"table\" \n           table of authorities                table of figures \n                    \"paragraph\"                     \"paragraph\" \n                     table:bull                           Title \n                    \"paragraph\"                     \"paragraph\" \n                     Title Char                           toc 1 \n                    \"character\"                     \"paragraph\" \n                          toc 2                           toc 3 \n                    \"paragraph\"                     \"paragraph\" \n                          toc 4                           toc 5 \n                    \"paragraph\"                     \"paragraph\" \n                          toc 6                           toc 7 \n                    \"paragraph\"                     \"paragraph\" \n                          toc 8                           toc 9 \n                    \"paragraph\"                     \"paragraph\" \n                    TOC Heading                      TOC_Header \n                    \"paragraph\"                     \"paragraph\" \n                       TOC_Page              Unresolved Mention \n                    \"paragraph\"                     \"character\" \n            Unresolved Mention1             Unresolved Mention2 \n                    \"character\"                     \"character\" \n            Unresolved Mention3             Unresolved Mention4 \n                    \"character\"                     \"character\" \n            Unresolved Mention5  List Table 7 Colorful Accent 6 \n                    \"character\"                         \"table\" \n                       Revision                    Style1lh:TOC \n                    \"paragraph\"                     \"paragraph\" \n                         lh:TOC                       msonormal \n                    \"paragraph\"                     \"paragraph\" \n                           xl65                            xl66 \n                    \"paragraph\"                     \"paragraph\" \n                           xl67                            xl68 \n                    \"paragraph\"                     \"paragraph\" \n                           xl69                            xl70 \n                    \"paragraph\"                     \"paragraph\" \n                           xl71                            xl72 \n                    \"paragraph\"                     \"paragraph\" \n                           xl73                            xl74 \n                    \"paragraph\"                     \"paragraph\" \n                           xl75                            xl76 \n                    \"paragraph\"                     \"paragraph\" \n                           xl77                     gnd-iwgdh3b \n                    \"paragraph\"                     \"character\" \n              HTML Preformatted          HTML Preformatted Char \n                    \"paragraph\"                     \"character\" \n\n* Content at cursor location:\n  level num_id text style_name content_type\n1    NA     NA              NA    paragraph",
    "crumbs": [
      "Code walkthrough",
      "Economic modelling"
    ]
  },
  {
    "objectID": "pages/walkthrough/code5_model.html#future-plans",
    "href": "pages/walkthrough/code5_model.html#future-plans",
    "title": "Economic modelling",
    "section": "Future plans",
    "text": "Future plans\nThe final section of code outlines some of the future plans for this model.\n\n# END OF CODE -------------------------------------------------------\n\n\n#### Additional changes were originally planned during Phase 2 of this pilot following use for the initial decision problem including\n# - Addition of Shiny user interface\n# - Genericisation of the code to allow wider use\n# - Programming and analysis of model outputs related specifically to sequencing, this may include value of information analyses\n\n# Unfortunately funding for this has not been confirmed currently. \n# If you are interested in discussing or funding further development please contact the PenTAG team at pentag@exeter.ac.uk",
    "crumbs": [
      "Code walkthrough",
      "Economic modelling"
    ]
  },
  {
    "objectID": "pages/walkthrough/code3_hr.html",
    "href": "pages/walkthrough/code3_hr.html",
    "title": "Apply hazard ratios to reference curves",
    "section": "",
    "text": "On this page, the hazard ratios (HR) from some pre-run network meta-analyses (NMA) are applied to the extrapolated RWE survival curves generated on the previous page.",
    "crumbs": [
      "Code walkthrough",
      "Apply hazard ratios to reference curves"
    ]
  },
  {
    "objectID": "pages/walkthrough/code3_hr.html#import-and-process-results-of-proportional-hazards-nma-ph-nma",
    "href": "pages/walkthrough/code3_hr.html#import-and-process-results-of-proportional-hazards-nma-ph-nma",
    "title": "Apply hazard ratios to reference curves",
    "section": "Import and process results of proportional hazards NMA (PH NMA)",
    "text": "Import and process results of proportional hazards NMA (PH NMA)\n\nImport results\nImport results from the PH NMA, as described in Input data. The code chunk sets new column names for the result table, and creates a duplicate of the Endpoint column called Reference.endpoint.\n\n# 3.3.5 Comparative efficacy propagation (NMA) ---------------------------------------------------------------\n\n# Pull in the data and calculate means by pop line mol endpoint reftrt and reftrial\n\n# First read in RDS file containing the PH NMA coda samples\n\n\n# 3.3.5.1.1 PH NMA data -----------------------------------------------------\n\n# Option to read in PH NMA CODA from local machine, uncomment this and comment out the line below to use\nRDS_path2 &lt;- file.path(d_path, \"PH_NMA_CODA.rds\")\nif (file.exists(RDS_path2)) {\n  i$PHNMA &lt;- readRDS(RDS_path2)\n} else {\n  i$PHNMA &lt;- readRDS(rstudioapi::selectFile(\n    caption = \"Please select 'PH_NMA_CODA.rds'\",\n    label = \"PH_NMA_CODA.rds\",\n    path = \"./1_Data/\",\n    filter = \"R Files (*.rds)\",\n    existing = TRUE\n  ))\n}\n\n\ncolnames(i$PHNMA$data) &lt;- c(\"Run\", \"Population\", \"Line\", \"Molecule\", \"Endpoint\", \"Reference.treatment\", \"Reference.trial\", \"HR\")\ni$PHNMA$data$Reference.endpoint &lt;- i$PHNMA$data$Endpoint\n\n\n\n\n\n\n\nView i$PHNMA$data\n\n\n\n\n\n\nkable(head(i$PHNMA$data))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nRun\nPopulation\nLine\nMolecule\nEndpoint\nReference.treatment\nReference.trial\nHR\nReference.endpoint\n\n\n\n\n1\n0\n1\n4\n0\n7\n0\n0.8958580\n0\n\n\n1\n0\n1\n1\n0\n7\n0\n0.7821468\n0\n\n\n1\n0\n1\n8\n0\n7\n0\n1.4324613\n0\n\n\n1\n0\n1\n2\n0\n7\n0\n0.7571763\n0\n\n\n1\n0\n1\n5\n0\n7\n0\n0.9492596\n0\n\n\n1\n0\n1\n3\n0\n7\n0\n0.8561836\n0\n\n\n\n\n\n\n\n\n\n\nSet 3L to 2L, and TTD and TTP to PFS\nThis sections implements some assumptions where we the relative effectiveness of one group/endpoint is assumed to apply to another.\n2L and 3L: The effectiveness of 3L treatments is assumed to be equal to their effectiveness at 2L, so it simply copies the data the effectiveness data from 2L (i$PHNMA$data[Line==2,]) but replaces the Line with 3 and appends it to the main data table (i$PHNMA$data).\nPFS, TTD and TTP: The time to treatment discontinuation (TTD) and time to progression (TTP) HRs are assumed to be equal to the HR for progression-free survival (PFS). If we refer to the endpoint look-up table, we can see that PFS is endpoint 1, then TTD is 2 and TTP is 3. Hence, in the code below, the PFS results (i$PHNMA$data[Endpoint==1,]) are simply copied, but with the endpoint replaced with 2 or 3, before appending it back to the main data table.\n\n\n\n\n\n\nView endpoint lookup table\n\n\n\n\n\n\ni$lookup$ipd$endpoint\n\n\n\n\n\n\n\n\n# IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!\n# IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!\n# IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!\n\ni$PHNMA$assume3L      &lt;- i$PHNMA$data[Line==2,]\ni$PHNMA$assume3L$Line &lt;- 3\ni$PHNMA$data         &lt;- rbind(i$PHNMA$data,i$PHNMA$assume3L)\n\ni$PHNMA$assumeTTD &lt;- i$PHNMA$data[Endpoint==1,]\ni$PHNMA$assumeTTD$Endpoint &lt;- 2\ni$PHNMA$data &lt;- rbind(i$PHNMA$data,i$PHNMA$assumeTTD)\n\ni$PHNMA$assumeTTP &lt;- i$PHNMA$data[Endpoint==1,]\ni$PHNMA$assumeTTP$Endpoint &lt;- 3\ni$PHNMA$data &lt;- rbind(i$PHNMA$data,i$PHNMA$assumeTTP)\n\n# IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!\n# IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!\n# IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!\n\n\n\n\n\n\n\nView i$PHNMA$data\n\n\n\n\n\nTo view are implemented assumptions we can, for example, look at the results from 2L and 3L, and see that they are the same:\n\nkable(head(i$PHNMA$data[i$PHNMA$data$Line==2,]))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nRun\nPopulation\nLine\nMolecule\nEndpoint\nReference.treatment\nReference.trial\nHR\nReference.endpoint\n\n\n\n\n1\n0\n2\n11\n0\n10\n1\n2.8940210\n0\n\n\n1\n0\n2\n8\n0\n10\n1\n0.6664276\n0\n\n\n1\n0\n2\n9\n0\n10\n1\n0.8515765\n0\n\n\n1\n0\n2\n0\n0\n10\n1\n0.6339945\n0\n\n\n1\n0\n2\n999\n0\n10\n1\n1.4503489\n0\n\n\n1\n0\n2\n12\n0\n10\n1\n2.9477019\n0\n\n\n\n\nkable(head(i$PHNMA$data[i$PHNMA$data$Line==3,]))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nRun\nPopulation\nLine\nMolecule\nEndpoint\nReference.treatment\nReference.trial\nHR\nReference.endpoint\n\n\n\n\n1\n0\n3\n11\n0\n10\n1\n2.8940210\n0\n\n\n1\n0\n3\n8\n0\n10\n1\n0.6664276\n0\n\n\n1\n0\n3\n9\n0\n10\n1\n0.8515765\n0\n\n\n1\n0\n3\n0\n0\n10\n1\n0.6339945\n0\n\n\n1\n0\n3\n999\n0\n10\n1\n1.4503489\n0\n\n\n1\n0\n3\n12\n0\n10\n1\n2.9477019\n0\n\n\n\n\n\n\n\n\n\n\nFind mean HRs\nThe mean HR by population, line, molecule, endpoint, reference treatment and reference trial are calculated.\nThese are then add to p.\n\n# Calculate the mean from the CODA samples for deterministic analysis\n\ni$PHNMA$means &lt;- i$PHNMA$data[,.(HR = mean(HR)),by=list(Population,Line,Molecule,Endpoint,Reference.treatment,Reference.trial)]\n\n\n# 3.3.5.1.2 DETERMINISTIC CODA --------------------------------------------\n\n# for the deterministic analysis we use the means. \np$releff$CODA$PH &lt;- i$PHNMA$means\n\n\n\n\n\n\n\nView i$PHNMA$means\n\n\n\n\n\n\nkable(head(i$PHNMA$means))\n\n\n\n\n\n\n\n\n\n\n\n\n\nPopulation\nLine\nMolecule\nEndpoint\nReference.treatment\nReference.trial\nHR\n\n\n\n\n0\n1\n4\n0\n7\n0\n0.7935352\n\n\n0\n1\n1\n0\n7\n0\n0.7033510\n\n\n0\n1\n8\n0\n7\n0\n0.8178626\n\n\n0\n1\n2\n0\n7\n0\n0.7226217\n\n\n0\n1\n5\n0\n7\n0\n0.9224925\n\n\n0\n1\n3\n0\n7\n0\n0.7946571",
    "crumbs": [
      "Code walkthrough",
      "Apply hazard ratios to reference curves"
    ]
  },
  {
    "objectID": "pages/walkthrough/code3_hr.html#import-and-process-results-of-fractional-polynomial-nma-fp-nma",
    "href": "pages/walkthrough/code3_hr.html#import-and-process-results-of-fractional-polynomial-nma-fp-nma",
    "title": "Apply hazard ratios to reference curves",
    "section": "Import and process results of fractional polynomial NMA (FP NMA)",
    "text": "Import and process results of fractional polynomial NMA (FP NMA)\n\nImport results\nImport results from the FP NMA, as described in Input data. The code chunk sets new column names for the result table, and converts the time from weeks to month (*52 as 52 weeks per year, then /12 to get months).\n\n# 3.3.5.2.1 FP NMA data -----------------------------------------------------\n\n# Load in FP NMA data\ni$FPNMA &lt;- list()\n\n#read in means for deterministic and PSA parameters for probabilistic\n\n# option to read in from local machine, uncomment the below and comment out line 949 to use\nRDS_path3 &lt;- file.path(d_path, \"FPNMA_means.rds\")\nif (file.exists(RDS_path3)) {\n  i$FPNMA$means  &lt;- readRDS(RDS_path3)\n} else {\n  i$FPNMA$means &lt;- readRDS(rstudioapi::selectFile(\n    caption = \"Load in FP NMA CODA (FPNMA_means.rds)\",\n    label = \"FPNMA_means.rds\",\n    path = \"./1_Data/\",\n    filter = \"R Files (*.rds)\",\n    existing = TRUE\n  ))\n}\n\n\n#tidy means column names and timing\ncolnames(i$FPNMA$means)[colnames(i$FPNMA$means) == \"intervention_code\"] &lt;- \"Molecule\"\ncolnames(i$FPNMA$means)[colnames(i$FPNMA$means) == \"reference_treatment_code\"] &lt;- \"Reference.treatment\"\ncolnames(i$FPNMA$means)[colnames(i$FPNMA$means) == \"ref_trial_code\"] &lt;- \"Reference.trial\"\ncolnames(i$FPNMA$means)[colnames(i$FPNMA$means) == \"population\"] &lt;- \"Population\"\ncolnames(i$FPNMA$means)[colnames(i$FPNMA$means) == \"line\"] &lt;- \"Line\"\ncolnames(i$FPNMA$means)[colnames(i$FPNMA$means) == \"endpoint\"] &lt;- \"Endpoint\"\ncolnames(i$FPNMA$means)[colnames(i$FPNMA$means) == \"V1\"] &lt;- \"HR\"\n\ni$FPNMA$means$time &lt;- round(i$FPNMA$means$time * 52 / 12)\n\n\n\n\n\n\n\nView i$FPNMA$means\n\n\n\n\n\n\nkable(head(i$FPNMA$means))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ntime\nMolecule\nReference.treatment\nLine\nEndpoint\nPopulation\nReference.trial\nHR\n\n\n\n\n2\n4\n7\n1\n1\n0\n0\n6.0866273\n\n\n3\n4\n7\n1\n1\n0\n0\n0.7948374\n\n\n4\n4\n7\n1\n1\n0\n0\n0.6307802\n\n\n5\n4\n7\n1\n1\n0\n0\n0.6127038\n\n\n6\n4\n7\n1\n1\n0\n0\n0.6141338\n\n\n7\n4\n7\n1\n1\n0\n0\n0.6184885\n\n\n\n\n\n\n\n\n\n\nSet cabozantinib as reference\n\n# means\n\n# Rebasing to allow use of cabo as reference treatment in 2nd line\n# repeats for means (stored in i which are later transferred to p) \ni$FPNMA$means &lt;- f_rebase_for_cabo_as_ref_in_2L(FPNMAdata = i$FPNMA$means)\n\n# Remove the now redundant objects we made in order to do this\n\n\n\nSet 3L to 2L\nAs implemented for PH NMA, the HRs for 3L are assumed to be the same as at 2L, and this is implemented here using f_3L_rel_effect_same_as_2L().\n\n# IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!\n# IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!\n# IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!\ni$FPNMA$means &lt;- f_3L_rel_effect_same_as_2L(FPNMAdata = i$FPNMA$means) \n\n# IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!\n# IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!\n# IMPORTANT: 3L relative effectiveness is assumed the same as 2L!!!!\n\n\n\nFind unique combinations\nf_gen_destinations() finds unique combinations of population, line, molecule, endpoint, reference treatment and reference trial. A duplicate version of these results is made where the referebce.trial is set to 2 (real-world evidence (RWE)). These are combined and saved as i$FPNMA$destinations.\n\n# Create 1 row for each destination PLMTE, so that we know where to put the\n# fp data without having to iterate much\ni$FPNMA$destinations &lt;- f_gen_destinations(fp_data = i$FPNMA$means)\n\n\n\n\n\n\n\nView i$FPNMA$destinations\n\n\n\n\n\n\nkable(head(i$FPNMA$destinations))\n\n\n\n\n\n\n\n\n\n\n\n\nPopulation\nLine\nMolecule\nEndpoint\nReference.treatment\nReference.trial\n\n\n\n\n0\n1\n4\n1\n7\n0\n\n\n0\n1\n8\n1\n7\n0\n\n\n0\n1\n3\n1\n7\n0\n\n\n0\n1\n1\n1\n7\n0\n\n\n0\n1\n2\n1\n7\n0\n\n\n0\n1\n5\n1\n7\n0\n\n\n\n\n\n\n\n\n\n\nDuplicate results with RWE as reference trial\nf_add_reference_trial_2() creates a duplicate version of i$FPNMA$means where the trial is set to 2 (real-world evidence).\n\n# add in reference.trial 2\ni$FPNMA$means &lt;- f_add_reference_trial_2(fp_data = i$FPNMA$means)\n\n\n\nCopy into p\nCopy items into p, removing molecules with “NA” and limiting time horizon.\n\n# 3.3.5.2.2 DETERMINISTIC CODA --------------------------------------------\n\np$releff$CODA$FP &lt;- i$FPNMA$means\np$releff$fp_dest &lt;- i$FPNMA$destinations[!is.na(Molecule), ]\n\n# limit to time horizon\np$releff$CODA$FP &lt;- p$releff$CODA$FP[time &lt;= p$basic$th, ]\n\n#eliminate NAs in molecule\np$releff$fp_dest &lt;- i$FPNMA$destinations[!is.na(Molecule), ]\n# A note on i vs p ---------------------------------------------------------------\n\n# P is for the parameters for one model scenario. the relative efficacy network is required\n# in order to compute the s(t) for all the different PLMTEs we need to power the model with.\n# Therefore, the samples which are used should go into p not i.\n# \n# However, the full CODA samples are a different matter as particularly for the\n# FPNMA these are large files and there's no need to copy paste this many times.\n# \n# Instead when we get to the point of the releff network, THEN we can be putting \n# it into p. this is because for a particular probabilistic iteration,  \n# scenario and so on we can pull through the right HRs to the right place!\n#",
    "crumbs": [
      "Code walkthrough",
      "Apply hazard ratios to reference curves"
    ]
  },
  {
    "objectID": "pages/walkthrough/code3_hr.html#create-nested-list-with-ph-nma-and-fp-nma-results",
    "href": "pages/walkthrough/code3_hr.html#create-nested-list-with-ph-nma-and-fp-nma-results",
    "title": "Apply hazard ratios to reference curves",
    "section": "Create nested list with PH NMA and FP NMA results",
    "text": "Create nested list with PH NMA and FP NMA results\n\nSet-up empty list\nThis section uses f_NMA_generateNetwork() to create an empty list with the unique values for population &gt; line &gt; molecule &gt; trial &gt; endpoint (PLMTE). For each of these PLMTE, it then has:\n\n$dest - which holds the numbers for the PLMTE\n$orig - empty list of PLMTE plus dist and source\n$hr - set to 1\n$fp - empty list\n\n\n# 3.3.5.3 Empty relative efficacy network ---------------------------------\n\n# Turn this into a list structure using the same naming convention as the rest of the model:\n# \n# \n# For this population, population line molecule trial and endpoint, generate a list\n# of spaces containing information on the relationship between other\n# population line molecule trial and endpoint pairings and this one.\n# \n# For example, we need to be able to do the following:\n# \n# - HR applied to other subgroup for same line mol tr endpoint\n# - HR applied to same subgroup for different line same mol tr endpoint\n# - HR applied to same subgroup same line different mol different tr same endpoint\n# - HR applied to same subgroup same line different mol same tr same endpoint\n# - HR applied to same subgroup same line different mol tr endpoint\n# \n# The best way to cope with all this is to basically list out where\n# the extrapolation is coming from USING THE SAME NAMES AS IN i$surv$reg\n# but with the addition of the selected distribution\n# \n# So, we have a list with dest for destination (i.e. this extrapolation)\n# origin (where it's coming from), and hr (what to apply to it)\n# \n# The next step (a different function) populates orig\n# \n\n\np$releff$network &lt;- f_NMA_generateNetwork(i$id$ipd,i$lookup$ipd)\n\n# To visualize it a bit, the structure looks like tree roots. Like this:\n# 1   Root                                    \n# 2    ¦--pop_0                               \n# 3    ¦   ¦--line_1                          \n# 4    ¦   ¦   ¦--mol_0                       \n# 5    ¦   ¦   ¦   ¦--trial_0                 \n# 6    ¦   ¦   ¦   ¦   ¦--endpoint_0          \n# 7    ¦   ¦   ¦   ¦   ¦   ¦--dest            \n# 8    ¦   ¦   ¦   ¦   ¦   °--orig            \n# 9    ¦   ¦   ¦   ¦   ¦--endpoint_1          \n# 10   ¦   ¦   ¦   ¦   ¦   ¦--dest            \n# 11   ¦   ¦   ¦   ¦   ¦   °--orig            \n# 12   ¦   ¦   ¦   ¦   ¦--endpoint_2          \n# 13   ¦   ¦   ¦   ¦   ¦   ¦--dest            \n# 14   ¦   ¦   ¦   ¦   ¦   °--orig            \n# 15   ¦   ¦   ¦   ¦   ¦--endpoint_3          \n# 16   ¦   ¦   ¦   ¦   ¦   ¦--dest            \n# 17   ¦   ¦   ¦   ¦   ¦   °--orig            \n# 18   ¦   ¦   ¦   ¦   ¦--endpoint_4          \n# 19   ¦   ¦   ¦   ¦   ¦   ¦--dest            \n# 20   ¦   ¦   ¦   ¦   ¦   °--orig            \n# 21   ¦   ¦   ¦   ¦   ¦--endpoint_5          \n# 22   ¦   ¦   ¦   ¦   ¦   ¦--dest            \n# 23   ¦   ¦   ¦   ¦   ¦   °--orig            \n# 24   ¦   ¦   ¦   ¦   ¦--endpoint_6          \n# 25   ¦   ¦   ¦   ¦   ¦   ¦--dest            \n# 26   ¦   ¦   ¦   ¦   ¦   °--orig            \n# 27   ¦   ¦   ¦   ¦   °--endpoint_7          \n# 28   ¦   ¦   ¦   ¦       ¦--dest            \n# 29   ¦   ¦   ¦   ¦       °--orig            \n# 80   ¦   ¦   ¦--mol_1                       \n# 81   ¦   ¦   ¦   ¦--trial_0                 \n# 82   ¦   ¦   ¦   ¦   ¦--endpoint_0          \n# 83   ¦   ¦   ¦   ¦   ¦   ¦--dest            \n# 84   ¦   ¦   ¦   ¦   ¦   °--orig            \n# 85   ¦   ¦   ¦   ¦   ¦--endpoint_1          \n# 86   ¦   ¦   ¦   ¦   ¦   ¦--dest            \n# 87   ¦   ¦   ¦   ¦   ¦   °--orig            \n# 88   ¦   ¦   ¦   ¦   ¦--endpoint_2          \n# 89   ¦   ¦   ¦   ¦   ¦   ¦--dest            \n# 90   ¦   ¦   ¦   ¦   ¦   °--orig            \n# 91   ¦   ¦   ¦   ¦   ¦--endpoint_3          \n# 92   ¦   ¦   ¦   ¦   ¦   ¦--dest            \n# 93   ¦   ¦   ¦   ¦   ¦   °--orig            \n# 94   ¦   ¦   ¦   ¦   ¦--endpoint_4          \n# 95   ¦   ¦   ¦   ¦   ¦   ¦--dest            \n# 96   ¦   ¦   ¦   ¦   ¦   °--orig            \n# 97   ¦   ¦   ¦   ¦   ¦--endpoint_5          \n# 98   ¦   ¦   ¦   ¦   ¦   ¦--dest            \n# 99   ¦   ¦   ¦   ¦   ¦   °--orig            \n# 100  ¦   ¦   ¦   ¦   °--... 2 nodes w/ 4 sub\n# 101  ¦   ¦   ¦   °--... 2 nodes w/ 54 sub   \n# 102  ¦   ¦   °--... 12 nodes w/ 956 sub     \n# 103  ¦   °--... 5 nodes w/ 6288 sub         \n# 104  °--... 3 nodes w/ 25463 sub             \n\n# A function (or functions) is (are) required to do several things, IN THIS ORDER:\n# \n#  1. Put the HRs from the PH NMA in the destinations, using the CODA sample identifiers to set the origin.\n#  2. Put the time-varying HRs from the FP NMA in the destinations, using the identifiers to set the origins\n#  3. Use the table R_table_eff_data_settings from Excel to apply any superseding & any assumption/ad-hoc stuff (HRs, assume equal to and so on)\n#  4. Use the final network object to propagate relative efficacy throughout the network, producing a set of extrapolations with RE applied.\n# \n\n\n\n\n\n\n\nView the empty p$releff$network\n\n\n\n\n\nSee example of PMTE 0 and L1:\n\np$releff$network$pop_0$line_1$mol_0$trial_0$endpoint_0\n\n$dest\n$dest$pop\n[1] \"pop_0\"\n\n$dest$line\n[1] \"line_1\"\n\n$dest$mol\n[1] \"mol_0\"\n\n$dest$trial\n[1] \"trial_0\"\n\n$dest$endpoint\n[1] \"endpoint_0\"\n\n\n$orig\n$orig$pop\nNULL\n\n$orig$line\nNULL\n\n$orig$mol\nNULL\n\n$orig$trial\nNULL\n\n$orig$endpoint\nNULL\n\n$orig$dist\nNULL\n\n$orig$source\nNULL\n\n\n$hr\n[1] 1\n\n$fp\nlist()\n\n\n\n\n\n\n\nCreate numeric trial column in i$R_table_eff_data_settings\nThis generates a column Trial in the table i$R_table_eff_data_settings if it doesn’t already exist. Whilst this isn’t used in making the empty nested list, it will be later used byf_NMA_AddAssumptionsToNetwork() and f_releff_PropNetwork().\nThe new Trial column is a numeric version of the column i$R_table_eff_data_settings$Trial.name.if.effectiveness.source.is.trial. The conversion between the categorical and numeric versions is done using the look-up i$lookup$ipd$trial.\n\n# Generate DESTINATION trial number column if it doesn't already exist:\nif(!\"Trial\" %in% colnames(i$R_table_eff_data_settings)) {\n  i$R_table_eff_data_settings$Trial &lt;- i$lookup$ipd$trial$Number[match(i$R_table_eff_data_settings$Trial.name.if.effectiveness.source.is.trial,i$lookup$ipd$trial$Description)]\n}\n\n\n\n\n\n\n\nView the new column\n\n\n\n\n\nFiltering to the unique trial columns, we can see that this has either set Trial to 0 or 2.\n\nkable(unique(i$R_table_eff_data_settings %&gt;% select(Trial.name.if.effectiveness.source.is.trial, Trial)))\n\n\n\n\n\nTrial.name.if.effectiveness.source.is.trial\nTrial\n\n\n\n\n1\n0\nNA\n\n\n8\nReal world evidence\n2\n\n\n\n\n\n\n\n\n\n\nAdd NMA HRs\nThese functions add the HRs from the PH NMA (p$releff$CODA$PH) and FP NMA (p$releff$CODA$FP) to the nested list.\n\n# 3.3.5.4 Linking inputs from PH and FP NMAs --------------------------------------------\n\n\n# Use the information we have from the PHNMA CODA sample to populate the corresponding\n# places within p$releff$network\n# \np$releff$network &lt;- f_NMA_linkPHNMA(\n  network       = p$releff$network,\n  hr_table      = p$releff$CODA$PH\n)\n\n# All treatments included in the network:\n# unique(c(unique(p$releff$means$Molecule),unique(p$releff$means$Reference.treatment),unique(i$R_table_eff_data_settings$Origin.treatment),unique(i$R_table_eff_data_settings$Treatment)))\n\n# Link in the fractional polynomial point estimate time-varying hazard ratios\np$releff$network &lt;- f_NMA_linkFPNMA(\n  network       = p$releff$network,\n  destinations  = p$releff$fp_dest,\n  hr_table      = p$releff$CODA$FP,\n  time_horizon  = p$basic$th\n)\n\n# See e.g.\n# p$releff$network$pop_0$line_1$mol_1$trial_0$endpoint_0\n# \n# To see that the time-varying hazard has been passed along :)\n\n\n# Remember that we only need to apply this one to the stuff that is NOT direct \n# survival analysis applied to the data. HOWEVER, we need those rows in the table\n# as well as we need the \"origin\" distributional selections to fill in our output!\n\n\n\n\n\n\n\nView the updated p$releff$network\n\n\n\n\n\nSee example:\n\n# PH NMA HR\np$releff$network$pop_0$line_1$mol_4$trial_0$endpoint_0$hr\n\n[1] 0.7935352\n\n# Time-varying FP NMA HRs\nhead(p$releff$network$pop_0$line_1$mol_4$trial_0$endpoint_0$fp$HR, 20)\n\n [1] 0.9321210 0.7399991 0.7015206 0.6987356 0.7068145 0.7182071 0.7301949\n [8] 0.7417350 0.7524420 0.7622070 0.7710399 0.7790003 0.7861653 0.7926152\n[15] 0.7984263 0.8036691 0.8084066 0.8126947 0.8165829 0.8201147",
    "crumbs": [
      "Code walkthrough",
      "Apply hazard ratios to reference curves"
    ]
  },
  {
    "objectID": "pages/walkthrough/code3_hr.html#add-more-assumption-based-hrs",
    "href": "pages/walkthrough/code3_hr.html#add-more-assumption-based-hrs",
    "title": "Apply hazard ratios to reference curves",
    "section": "Add more “assumption-based” HRs",
    "text": "Add more “assumption-based” HRs\nThe column i$R_table_eff_data_settings$Effectiveness.data.source sets some of the sources of HRs.\n\n\n\n\n\n\nView i$R_table_eff_data_settings$Effectiveness.data.source\n\n\n\n\n\n\ntable(i$R_table_eff_data_settings$Effectiveness.data.source)\n\n\n                      0             Apply HR to         Assume equal to \n                    247                      49                      44 \n                 FP_NMA                  PH_NMA Trial survival analysis \n                     22                      39                      19 \n\n\n\n\n\nIf the setting dd_use_PHnma_for_FPnma was set to “Yes” in the excel spreadsheet, then it will replace “FP_NMA” with “PH_NMA” in this list - thereby, forcing the model to use the PH NMA HRs instead of including some from FP NMA.\nBy default, this is currently set to “No”.\n\n# 3.3.5.5 Assumptions from Excel ------------------------------------------\n\n# Apply the setting dd_use_PHnma_for_FPnma from excel. This supersedes what's selected\n# in efficacy settings, changing all FP NMA entries to PH NMA to force the model to use\n# the PH NMA CODA sample over and above the FP NMA!\n\nif (i$dd_use_PHnma_for_FPnma == \"Yes\") {\n  i$which_fpnma &lt;- which(i$R_table_eff_data_settings$Effectiveness.data.source == \"FP_NMA\")\n  i$R_table_eff_data_settings$Effectiveness.data.source[i$which_fpnma] &lt;- \"PH_NMA\"\n}\n\n# QC point: to test whether all entries to Effectiveness.data.source are in the\n# lookup list, compare these two:\n# \n# table(i$R_table_eff_data_settings$Effectiveness.data.source)\n# \n# i$List_eff_datasources\n# \n# i.e.,\n# \n# setdiff(names(table(i$R_table_eff_data_settings$Effectiveness.data.source)),i$List_eff_datasources)\n# \n# \"0\" is fine as that's empty cells, but there should be nothing else.\n# \n\n# setdiff(names(table(i$R_table_eff_data_settings$Effectiveness.data.source)),i$List_eff_datasources)\n\nThe function f_NMA_AddAssumptionsToNetwork() adds the “assumption-based” HRs according to i$R_table_eff_data_settings$Effectiveness.data.source. There are five categories within this:\n\nTrial - Trial survival analysis - for these entries, they are a reference curve, so the function checks the origin and destination match, and then add some extra information from excel (e.g. dist, source, setting fp to empty list)\nFP NMA or PH NMA - FP_NMA, PH_NMA - as I’ve understood it, this populates the hazard ratio for a given comparison using the FP/PH NMA HR from the same comparison in a different trial - so, even though the HR data has come from a different context (different trial), we are saying it is still applicable to this treatment comparison.\nET flag - Assume equal to - the treatment and reference treatment are considered to be equally effective, so the HR is set to 1\nAHR flag - Apply HR to - these entries have a HR provided in the Excel spreadsheet under a column HR.to.apply\n\n\np$releff$network &lt;- f_NMA_AddAssumptionsToNetwork(\n  network            = p$releff$network,\n  phnma_table        = p$releff$CODA$PH,\n  fpnma_table        = p$releff$CODA$FP,\n  fpnma_destinations = p$releff$fp_dest,\n  excel_table        = data.table(i$R_table_eff_data_settings),\n  trial_flag         = i$List_eff_datasources[1],\n  fpnma_flag         = i$List_eff_datasources[3],\n  phnma_flag         = i$List_eff_datasources[2],\n  et_flag            = i$List_eff_datasources[4],\n  ahr_flag           = i$List_eff_datasources[5],\n  verbose            = qc_mode\n)\n\n\n# Example to see all the HRs for population 0 in some nice tables \n# \n# f_releff_extract_all_HRs(p$releff$network)\n# \n# assign to an object to browse through it",
    "crumbs": [
      "Code walkthrough",
      "Apply hazard ratios to reference curves"
    ]
  },
  {
    "objectID": "pages/walkthrough/code3_hr.html#apply-hrs-to-the-extrapolated-rwe-survival-times",
    "href": "pages/walkthrough/code3_hr.html#apply-hrs-to-the-extrapolated-rwe-survival-times",
    "title": "Apply hazard ratios to reference curves",
    "section": "Apply HRs to the extrapolated RWE survival times",
    "text": "Apply HRs to the extrapolated RWE survival times\nThe function f_surv_getExtrapolations() creates a nested list with survival times st for each PLMTE, as copied from i$surv$reg (the RWE survival analysis).\n\n# 3.3.5.6 Propagating the network -----------------------------------------\n\n# Now that we have collected together all of the survival extrapolations for all\n# of the data we have, and all of the HRs, whether by assumption or derived\n# via NMA, plus all of the underlying distributional selections, we can proceed\n# to \"proliferate\" the evidence network, starting from the extrapolations we have already\n# and working \"outwards\" from that point, arriving at ONLY the extrapolation for each\n# possibility (rather than all distributions). From there, we can \"cherry-pick\"\n# those population line molecule trial endpoint distribution HR application choices\n# to \"build-up\" a given treatment pathway.\n\n\n# These are still \"raw\" extraps, so should be in i as they're not used for \n# computation of pf. \n\ni$surv$extraps &lt;- f_surv_getExtrapolations(regs = i$surv$reg)\n\nThe function f_releff_PropNetwork() then applies the HR in p$releff$network to the survival times, saving the resulting nested list as p$surv$st.\n\n# propagate the extrapolation and comparative efficacy data/assumptions:\n# \n# Because this is for a particular iteration of the model, it should go into object p\n# which is the input set for running one model.\n# \n# \np$surv$st &lt;- f_releff_PropNetwork(\n  network = p$releff$network,\n  extraps = i$surv$extraps,\n  dos     = 10,\n  verbose = qc_mode,\n  dist_lookups = p$basic$lookup$dist,\n  excel_table = data.table(i$R_table_eff_data_settings)\n)\n\n# active trial depends on excel settings so it's hard to anticipate. 2 for all\n# lines if rwe and \n\n# # pop 0 first line nivo mono trial 0\n# f_qc_surv_gethead(p$surv$st,p = 0,l = 1,m = 1,t = 2,len = 3)\n# \n# # pop 0 line 2 nivo mono trial 1\n# f_qc_surv_gethead(p$surv$st,p = 0,l = 2,m = 0,t = 2,len = 3)\n# \n# # follow pazo through the lines - so close! only OS in 4L but the others are all working\n# # (just show me the first couple of rows from each for brevity). mol 5 selected\n# # because it runs through all treatment lines\n# f_qc_surv_gethead(p$surv$st,p = 0,l = 1,m = 5,t = 0,len = 3)\n# f_qc_surv_gethead(p$surv$st,p = 0,l = 2,m = 5,t = 1,len = 3)\n# f_qc_surv_gethead(p$surv$st,p = 0,l = 3,m = 5,t = 1,len = 3)\n# f_qc_surv_gethead(p$surv$st,p = 0,l = 4,m = 5,t = 1,len = 3)\n# \n# # Risk pop 1 first line nivo cabo from trial and then rwe:\n# f_qc_surv_gethead(p$surv$st,1,1,1,2)\n\n\n\n\n\n\n\nView p$surv$st\n\n\n\n\n\nThis list is similar to p$releff$network but with the addition of survivals, as demonstrated below:\n\nhead(p$surv$st$pop_0$line_3$mol_0$trial_2$endpoint_2$st, 20)\n\n [1] 1.0000000 0.9921156 0.9782498 0.9609062 0.9410968 0.9194740 0.8965183\n [8] 0.8726074 0.8480469 0.8230890 0.7979435 0.7727850 0.7477591 0.7229864\n[15] 0.6985662 0.6745796 0.6510916 0.6281539 0.6058063 0.5840786",
    "crumbs": [
      "Code walkthrough",
      "Apply hazard ratios to reference curves"
    ]
  },
  {
    "objectID": "pages/walkthrough/code3_hr.html#apply-modifications-to-the-survival-times",
    "href": "pages/walkthrough/code3_hr.html#apply-modifications-to-the-survival-times",
    "title": "Apply hazard ratios to reference curves",
    "section": "Apply modifications to the survival times",
    "text": "Apply modifications to the survival times\n\nPrior adjuvant treatments\nBy default, this is not run as i$dd_adjforprioradjuvant is set to “No”.\nHowever, if “Yes”, it would adjust the survival times again for endpoint 0 (overall survival, OS) by applying another hazard ratio that is associated with prior adjuvant treatment.\nAn adjuvant treatment is an additional treatment given alongside the primary treatment.\n\n# 3.3.6 Extrapolation modifications ---------------------------------------\n\n# This subsection focuses on applying the required modifications to the \"raw\" extrapolations\n# now that we have propagated comparative efficacy. We need to first apply any adjustments for treatment effect waning \n# and then check the following:\n# \n#  - mortality never falls below that of the general population\n#  - The extrapolations which are NOT censored for death do not cross (in abs or hazard) OS\n\n# During technical engagement functionality will be added here to adjust for the impact of prior adjuvant treatment as part of scenario analysis\n\nif(i$dd_adjforprioradjuvant == \"Yes\") {\n  p$surv$st &lt;- f_surv_adjuvant_HR(\n    st              = p$surv$st,\n    adjuvant_impact = i$R_table_prior_IO_impact_eff,\n    demo_table      = p$demo$table,\n    lookup          = p$basic$lookup,\n    verbose         = TRUE)\n}\n\n\n\nEffect waning\nTreatment effect waning is the loss of a treatment’s benefits over time. It is only applied to some PLMTEs, as specified by i$R_table_TE_waning_settings$apply.waning.\nThis is implemented using the function f_surv_twaning_apply(), which reduces the effect to match the reference treatment once it reaches a certain cycle.\n\n# Curve crossing should be fixed on the treatment sequence level, NOT the original PLMT level\n# through E. This is because doing it that way round could lead to implausible\n# extrapolations. For instance, if the PFS from somewhere else was being injected\n# in (e.g. if trial 0 for OS and trial 1 from a different PLMT for PFS via equivalence\n# assumption), it may be the case that the assumed equal PFS crosses OS.\n# \n# Therefore, curve crossing fixes should be performed on the individual treatment\n# pathways.\n# \n# In conclusion, this section ONLY adjusts for gpop mortality, and curve crossing\n# adjustment is performed AFTER f_seq_extrapCollector is used to pull through\n# the correct extrapolations to the correct DESTINATION locations. \n# \n# The function is ONLY applied to OS lines.\n# \n# Because we have pulled through the metatadata to our PLMTEs s(t) objects, \n# we can use the \"dest\" element to decide which row of Excel range R_table_ptchar\n# to apply in the general population mortality\n# \n\n# Firstly, treatment effect waning. This is done on unadjusted curves and is \n# not included in the model base-case.\n#\n# Make the information on patient characteristics from Excel into a data table\n\ni$R_table_ptchar &lt;- data.table(i$R_table_ptchar)\n\n\n\n\n\n# BEFORE adjusting for general population, we must apply treatment effect waning.\n#        Evidence has suggested that this predominantly affects 1L treatments,\n#        and the table \"R_table_TE_waning_settings\" has been populated to capture\n#        waning. This provides information on the \"destination\" and the nature\n#        of the treatment effect waning. The \"destination\" information is then\n#        used to link to the efficacy settings table \"R_table_eff_data_settings\"\n#        in excel. This table contains the corresponding information on the \"origin\".\n#        In the case of 1L treatments, this is the reference curve\n\n##### Treatment effect waning application is defined in the main Excel workbook for input\n##### For each treatment and outcome:\n##### apply: yes / no\n##### method: either absolute survival or hazards\n##### when TE waning starts (years)\n##### when TE waning is fully implemented (years)\n##### linear graduation is used between the start and end time\n\n# Note this function produces a warning which details when there is a danger of TE waning in the usual fashion (setting hazards the same)\n# being implemented producing counterintuitive results. In this case we use the higher of the hazards to prevent this problem\n\nif (sum(i$R_table_TE_waning_settings$apply.waning == \"Yes\") &gt; 0) {\n  p$surv$st &lt;- f_surv_twaning_apply(\n    st_list     = p$surv$st,\n    tab_waning  = data.table(i$R_table_TE_waning_settings),\n    tab_eff_set = data.table(i$R_table_eff_data_settings),\n    verbose     = qc_mode\n  )\n}\n\nWarning in treatment_effect_waning_with_absolute(surv_active = plmte$st, :\nHazard rate in the active treatment is more than the hazard rate in the\nreference treatment in 1890 cycles, the first of which is 198 . Using the\nhigher of the two hazards where they cross!\n\n\n\n\nGeneral population mortality\nIn this section, the survival curves are calculated for the general population, and these are then used to adjust the treatment survival curves.\n\nGenerate the general population survival curves\nThe survival curves are for overall survival. They are calculated for each population and each line of therapy. They can be created using one of two functions:\n\nf_surv_GenOSLines_det() - calculates curves based on characteristics provided in a table\nf_surv_GenOSLines_ipd() - calculates curves based on individual patient data\n\nThe default option is to use patient-level data (i$dd_age_sex_source == \"PLD\").\n\n# Generate all the gpop lines we can generate:\np$surv$gpop &lt;- if (i$dd_age_sex_source == \"Mean\") f_surv_GenOSLines_det(\n  R_table_ptchar         = i$R_table_ptchar,\n  R_table_mort_lifeTable = i$R_table_mort_lifeTable,\n  t_yr                   = p$basic$t_yr,\n  lookups                = i$lookup\n) else f_surv_GenOSLines_ipd(\n  R_table_patientagesex  = i$R_table_patientagesex,\n  R_table_mort_lifeTable = i$R_table_mort_lifeTable,\n  t_yr                   = p$basic$t_yr,\n  lookups                = i$lookup\n)\n\n\n\n\n\n\n\nView p$surv$gpop\n\n\n\n\n\nAs an example, the overall survival times for population 0 line 1 from the general population are:\n\nhead(p$surv$gpop$pop_0$line_1$os, 10)\n\n [1] 1.0000000 0.9996541 0.9993084 0.9989626 0.9986170 0.9982715 0.9979260\n [8] 0.9975807 0.9972355 0.9968905\n\n\n\n\n\n\n\nCompare curves generated by means v.s. patient-level data\nIf running the script in qc_mode, this code chunk will compare the general population survival curves produced based on average characteristics in a table to those produced from person-level data.\n\n# During QC model we produce a comparison between mean-based and IPD based general population OS lines:\nif (qc_mode) {\n  i$gpop &lt;- list(\n    means = f_surv_GenOSLines_det(\n      R_table_ptchar         = i$R_table_ptchar,\n      R_table_mort_lifeTable = i$R_table_mort_lifeTable,\n      t_yr                   = p$basic$t_yr,\n      lookups                = i$lookup\n    ),\n    ipd = f_surv_GenOSLines_ipd(\n      R_table_patientagesex  = i$R_table_patientagesex,\n      R_table_mort_lifeTable = i$R_table_mort_lifeTable,\n      t_yr                   = p$basic$t_yr,\n      lookups                = i$lookup\n    )\n  ) \n  \n  # Compare all risk population first-line across the 2 methods\n  \n  i$gpop$plotdat &lt;- data.table(\n    t = rep(p$basic$t_yr,2),\n    os = c(i$gpop$means$pop_0$line_1$os,i$gpop$ipd$pop_0$line_1$os),\n    method = c(rep(\"Means\",p$basic$th+1),rep(\"Patient data\",p$basic$th+1))\n  )\n  \n  i$gpop$comp_plot &lt;- ggplot(i$gpop$plotdat, aes(x = t, y = os, colour = method)) + \n    geom_line() + \n    theme_classic() +\n    theme(legend.position = \"bottom\", legend.title=element_blank()) + \n    labs(title = NULL, x = \"Time (years)\", y = \"% Survival\") + \n    scale_x_continuous(expand = expansion(mult = c(0,0.05))) + \n    scale_y_continuous(labels = scales::percent)\n  \n  if(qc_mode) {\n    ggsave(\n      filename = file.path(\"./4_Output/\",\"gpop_1L_method_comparison.png\"),\n      plot = i$gpop$comp_plot,\n      device = \"png\",\n      units = \"cm\",\n      width = 15\n    )\n  }\n}\n\n\n\nAdjust treatment curves based on general population\nThe function f_surv_gpopadjust() adjusts the survival curves based on the general population survival curves. This is to ensure that the advanced renal cell carcinoma (aRCC) patients are not projected to live longer than the general population.\n\n# adjust all OS lines in p$surv$st for gpop mortality\np$surv$st &lt;- f_surv_gpopadjust(st      = p$surv$st,\n                               gpop    = p$surv$gpop,\n                               method  = \"hazardmax\",\n                               verbose = qc_mode)\n\n\n\n\nCurve overlap\nA known limitation of partitioned survival analysis (which was used to extrapolate the RWE) is that it can produce curves where PFS lies above OS (which is impossible in real-life). Hence, in cases where this occurs, it was adjusted so that PFS &lt;= OS (and also, TTD &lt;= OS, and PFS &lt;= TTP). This was implemented using the functions f_surv_PFSxOS(), f_surv_TTDxOS(), and f_surv_PFSxTTP().\n\n# Adjust PFS and TTD for OS - PFS and TTD cannot exceed OS\np$surv$st &lt;- f_surv_PFSxOS(p$surv$st, if(i$dd_adj_cross_curves == \"Use hazards\"){\"hazardmax\"} else{\"abs\"})\n\np$surv$st &lt;- f_surv_TTDxOS(p$surv$st, if(i$dd_adj_cross_curves == \"Use hazards\"){\"hazardmax\"} else{\"abs\"})\n\n# Adjust TTP, PFS cannot go above TTP, this is done on absolute survival rather than allowing flexibility to look at hazards\np$surv$st &lt;- f_surv_PFSxTTP(st = p$surv$st,method =  \"abs\")\n\n# The below should produce a string of positive or 0s\n# p$surv$st$pop_0$line_1$mol_7$trial_2$endpoint_3$st - p$surv$st$pop_0$line_1$mol_7$trial_2$endpoint_1$st\n\n\n\nSet 5L to 4L\nHere, the survival times for 5L (ie. best supportive care, BSC) are set to those from 4L.\n\n# Last assumption - 5L =4L. this moves over BSC when it comes after 4 active treatments.\n\np$surv$st &lt;- lapply(p$surv$st, function(popu) {\n  popu$line_5 &lt;- popu$line_4\n  return(popu)\n})",
    "crumbs": [
      "Code walkthrough",
      "Apply hazard ratios to reference curves"
    ]
  },
  {
    "objectID": "pages/walkthrough/code3_hr.html#view-the-generated-curves",
    "href": "pages/walkthrough/code3_hr.html#view-the-generated-curves",
    "title": "Apply hazard ratios to reference curves",
    "section": "View the generated curves",
    "text": "View the generated curves\nIf running with qc_mode, this would plot survival extrapolations and hazard curves for each PLMTE.\n\n# 3.3.7 Visual QC of final curves ---------------------------------------\n\n# Here's an example of how to run the QC plots. These serve as a useful check\n# later on too, because it reveals where some PLMTEs have not been populated.\n\n# f_qc_surv_ExtrapPlot(\n#   st   = p$surv$st,\n#   popu = \"pop_0\",\n#   li   = \"line_1\",\n#   mo   = \"mol_1\",\n#   tr   = \"trial_2\",\n#   t_yr = p$basic$t_yr,\n#   th = p$basic$th\n# )\n# \n# f_qc_surv_EstHazPlot(\n#   st   = p$surv$st,\n#   gpop = p$surv$gpop,\n#   popu = \"pop_0\",\n#   li   = \"line_1\",\n#   mo   = \"mol_1\",\n#   tr   = \"trial_2\",\n#   t_yr = p$basic$t_yr,\n#   th   = p$basic$th\n# )\n\n\n# Here is a QC method for visually having a look at the extrapolated survival\n# after all relative efficacy has been applied. This creates a LOT of graphs. You can look through them by pressing the arrow on the plots window\nif (qc_mode) {\n  i$excel_destinations &lt;- data.table(i$R_table_eff_data_settings)[Include.in.this.analysis.==\"Yes\",list(Population,Treatment.line,Molecule,Origin.trial,End.point)]\n  i$surv$ExtrapSenseCheck &lt;- Reduce(\n    x = 1:nrow(i$excel_destinations),\n    init = f_NMA_generateNetwork(i$id$ipd,i$lookup$ipd),\n    accumulate = FALSE,\n    f = function(prev, dest_row) {\n      dat &lt;- as.list(i$excel_destinations[dest_row,])\n      \n      d &lt;- list(\n        pop = paste0(\"pop_\",dat$Population),\n        line = paste0(\"line_\",dat$Treatment.line),\n        mol = paste0(\"mol_\",dat$Molecule),\n        trial = paste0(\"trial_\",dat$Origin.trial),\n        endpoint = paste0(\"endpoint_\",dat$End.point)\n      )\n      \n      cat(paste0(\n        \"Drawing plots: \",\n        \" row \", dest_row, \" i$surv$ExtrapSenseCheck$\",\n        d$pop, \"$\",\n        d$line, \"$\",\n        d$mol, \"$\",\n        d$trial, \"$plots\",\n        \"\\n\"\n      ))\n      \n      p_extrap &lt;- f_qc_surv_ExtrapPlot(\n        st   = p$surv$st,\n        popu = d$pop,\n        li   = d$line,\n        mo   = d$mol,\n        tr   = d$trial,\n        t_yr = p$basic$t_yr,\n        th = p$basic$th\n      )\n      \n      p_haz &lt;- f_qc_surv_EstHazPlot(\n        st   = p$surv$st,\n        gpop = p$surv$gpop,\n        popu = d$pop,\n        li   = d$line,\n        mo   = d$mol,\n        tr   = d$trial,\n        t_yr = p$basic$t_yr,\n        th   = p$basic$th\n      )\n      \n      plmt &lt;- prev[[d$pop]][[d$line]][[d$mol]][[d$trial]]\n      plmt$plots &lt;- list(\n        p_extrap = p_extrap,\n        p_haz = p_haz\n      )\n      \n      # Save 2 plots for each PLM available. Takes a while to run.\n      if (qc_mode) {\n        ggsave(\n          filename = file.path(\"./4_Output\",paste0(\"p_extrap_\",paste(d[1:4],collapse=\"_\"),\".png\")),\n          plot     = plmt$plots$p_extrap,\n          device = \"png\",\n          units = \"cm\",\n          width = 15\n        )\n        ggsave(\n          filename = file.path(\"./4_Output\",paste0(\"p_tp_\",paste(d[1:4],collapse=\"_\"),\".png\")),\n          plot     = plmt$plots$p_haz,\n          device = \"png\",\n          units = \"cm\",\n          width = 15\n        )\n      }\n      \n      prev[[d$pop]][[d$line]][[d$mol]][[d$trial]] &lt;- plmt\n      \n      return(prev)\n      \n    }\n  )\n}\n\n\n\n\n\n\n\nView some example plots\n\n\n\n\n\nAlthough qc_mode is set to FALSE, we can still use the functions to view an example of a survival and hazard curves.\n\nf_qc_surv_ExtrapPlot(\n  st   = p$surv$st,\n  popu = \"pop_0\",\n  li   = \"line_1\",\n  mo   = \"mol_1\",\n  tr   = \"trial_2\",\n  t_yr = p$basic$t_yr,\n  th = p$basic$th\n)\n\n\n\n\n\n\n\nf_qc_surv_EstHazPlot(\n  st   = p$surv$st,\n  gpop = p$surv$gpop,\n  popu = \"pop_0\",\n  li   = \"line_1\",\n  mo   = \"mol_1\",\n  tr   = \"trial_2\",\n  t_yr = p$basic$t_yr,\n  th   = p$basic$th\n)",
    "crumbs": [
      "Code walkthrough",
      "Apply hazard ratios to reference curves"
    ]
  },
  {
    "objectID": "pages/walkthrough/code1_setup.html",
    "href": "pages/walkthrough/code1_setup.html",
    "title": "Set-up",
    "section": "",
    "text": "This page contains some of the basic set-up steps like loading the functions and lots of the model inputs, as well as establishing the possible treatment sequences.",
    "crumbs": [
      "Code walkthrough",
      "Set-up"
    ]
  },
  {
    "objectID": "pages/walkthrough/code1_setup.html#load-required-packages",
    "href": "pages/walkthrough/code1_setup.html#load-required-packages",
    "title": "Set-up",
    "section": "Load required packages",
    "text": "Load required packages\n\n#### 1. Installation ###########\n#### This code has been created using R version 4.3.1\n#### All packages used by this model are provided here\n\n#### Comment out the below section which installs the relevant packages after the first run of the model\n# install.packages(\"shiny\", quiet = TRUE)   ### the quiet argument is used to avoid warnings appearing in the console (useful for later conversion to web app)\n# install.packages(\"gtools\", quiet = TRUE)\n# install.packages(\"openxlsx\", quiet = TRUE)\n# install.packages(\"flexsurv\", quiet = TRUE)\n# install.packages(\"tidyverse\", quiet = TRUE)\n# install.packages(\"data.table\", quiet = TRUE)\n# install.packages(\"heemod\", quiet = TRUE)\n# install.packages(\"logOfGamma\", quiet = TRUE)\n# install.packages(\"ggplot2\", quiet = TRUE)\n# install.packages(\"survminer\", quiet = TRUE)\n# install.packages(\"officer\", quiet = TRUE)\n# install.packages(\"officedown\", quiet = TRUE)\n# install.packages(\"magrittr\", quiet = TRUE)\n# install.packages(\"Hmisc\", quiet = TRUE)\n# install.packages(\"future.apply\", quiet = TRUE)\n# install.packages(\"crosstable\", quiet = TRUE)\n# install.packages(\"flextable\", quiet = TRUE)\n# install.packages(\"stringr\", quiet = TRUE)\n# install.packages(\"BCEA\", quiet = TRUE)\n# install.packages(\"collapse\", quiet = TRUE)\n# install.packages(\"scales\", quiet = TRUE)\n# install.packages(\"Matrix\", quiet = TRUE)\n# install.packages(\"dplyr\", quiet = TRUE)\n# install.packages(\"progressr\", quiet = TRUE)\n# install.packages(\"microbenchmark\", quiet = TRUE)\n\n### Loading libraries \n\n#### This section needs to be run every time and calls each package from the library \nlibrary(shiny, quiet = TRUE)   \nlibrary(gtools, quiet = TRUE)\nlibrary(openxlsx, quiet = TRUE)\nlibrary(flexsurv, quiet = TRUE)\nlibrary(tidyverse, quiet = TRUE)\nlibrary(data.table, quiet = TRUE)\nlibrary(heemod, quiet = TRUE)\nlibrary(logOfGamma, quiet = TRUE)\nlibrary(ggplot2, quiet = TRUE)\nlibrary(survminer, quiet = TRUE)\nlibrary(officer, quiet = TRUE)\nlibrary(officedown, quiet = TRUE)\nlibrary(magrittr, quiet = TRUE)\nlibrary(Hmisc, quiet = TRUE)\nlibrary(future.apply, quiet = TRUE)\nlibrary(crosstable, quiet = TRUE)\nlibrary(flextable, quiet = TRUE)\nlibrary(stringr, quiet = TRUE)\nlibrary(BCEA, quiet = TRUE)\nlibrary(collapse, quiet = TRUE)\nlibrary(scales, quiet = TRUE)\nlibrary(Matrix, quiet = TRUE)\nlibrary(dplyr, quiet = TRUE)\nlibrary(progressr, quiet = TRUE)\nlibrary(microbenchmark, quiet = TRUE)\nlibrary(knitr, quiet = TRUE)",
    "crumbs": [
      "Code walkthrough",
      "Set-up"
    ]
  },
  {
    "objectID": "pages/walkthrough/code1_setup.html#set-file-paths",
    "href": "pages/walkthrough/code1_setup.html#set-file-paths",
    "title": "Set-up",
    "section": "Set file paths",
    "text": "Set file paths\n\n# Set path to folders\nd_path = \"../../../1_Data\"\ns_path = \"../../../2_Scripts\"\nf_path = \"../../../3_Functions\"\no_path = \"../../../4_Output\"",
    "crumbs": [
      "Code walkthrough",
      "Set-up"
    ]
  },
  {
    "objectID": "pages/walkthrough/code1_setup.html#define-some-of-the-model-settings",
    "href": "pages/walkthrough/code1_setup.html#define-some-of-the-model-settings",
    "title": "Set-up",
    "section": "Define some of the model settings",
    "text": "Define some of the model settings\nThe majority of this code block is dedicated to setting the model to run sequentially or in parallel. If running the base case using Model_Structure.R as provided (e.g. with pre-run survival analysis), you may find that the quickest option is to run the model sequentially. This is already set up by default, with keep_free_cores &lt;- NA. For reference, the run time for this on an Intel Core i7-12700H with 32GB RAM running Ubuntu 22.04.4 Linux was 40 minutes.\n\n# Multi-core processing:\n# \n# Instructions.\n# \n# This model is highly RAM intensive. You need a lot of RAM on your computer\n# to run this model due to the large amount of very large matrix multiplications\n# (up to approximately 15,000 discrete health states in the model). Therefore,\n# in order to efficiently run the model, it is a balancing act between RAM\n# usage and CPU usage. \n# \n# Some rough guidance is:\n# \n# - If you have 8GB of RAM on your computer, you can run this model with 2 cores only\n#   but it may even be faster to run in series if you have other things open on your\n#   computer at the same time. Therefore, please set keep_free_cores to NA and run\n#   the model in series. This is because when the RAM on your computer runs out\n#   your computer will use the hard-disk instead which is extremely slow.\n# - If you have 16GB of RAM on your computer, parallel should be a lot faster.\n#   On my laptop (I7 8th gen, 16GB RAM, running Linux for low RAM usage) I can\n#   run with 5 cores whilst using about 12GB of RAM running this model. \n# - if you have 24GB or 32GB of RAM, you should be able to run the model with 8\n#   and up to around 14 cores before running out of RAM whilst running the model.\n# - if you are using a HPC, you should be able to run this model with many cores\n#   due to the typically large amount of RAM available per core in a HPC\n# \n# \n# IF YOU DO NOT WANT MULTICORE SET keep_free_cores TO NA\n# \n# \nkeep_free_cores &lt;- NA\nif (any(is.na(keep_free_cores), keep_free_cores&lt;0)) {\n  plan(sequential)\n} else {\n  plan(multisession(workers = max(availableCores()-keep_free_cores,1)))\n}\n\nThe three settings in this code block:\n\nprogressr::handlers(\"progress\") - one of the settings for how progress is reported whilst code is running\ncrosstable::options(crosstable_units=\"cm\") - the crosstable package generates descriptive statistics with function crosstable(), and this sets the unit for it, although it should be noted that this appears to be legacy code as it doesn’t appear that crosstable() is used anywhere in the repository\nqc_mode - the input for verbose in f_NMA_AddAssumptionsToNetwork() which, if true, will mean that extra outputs are printed to the console\n\n\n# Other generic settings for the progress bar and units for table widths\nhandlers(\"progress\")\noptions(crosstable_units=\"cm\")\n\n#### 2. Loading functions ###########\n\n\n# This variable is used throughout the model to define whether to provide additional outputs useful for QC or not\n# The model will take longer to run when this is set to TRUE\nqc_mode &lt;- FALSE",
    "crumbs": [
      "Code walkthrough",
      "Set-up"
    ]
  },
  {
    "objectID": "pages/walkthrough/code1_setup.html#import-model-functions",
    "href": "pages/walkthrough/code1_setup.html#import-model-functions",
    "title": "Set-up",
    "section": "Import model functions",
    "text": "Import model functions\nThe functions for the analysis in Model_Structure.R are stored in the 3_Functions/ folder. Here, they are imported into our environment.\n\n# 2.1. Excel data extraction functions -----------------------------------------\n\n#### These functions are used to extract parameters from the Excel input workbook for use in R\n#### During Phase 2 a Shiny front-end will be added to the model which will allow an alternative mechanism to upload these types of inputs\n\nsource(file.path(f_path, \"excel/extract.R\"))\n\n# 2.2. Treatment sequencing functions ----------------------------------------\n\n#### Function: filter to active treatments and lines\n##### Takes as an input the defined sequences, evaluation type and line to start the evaluation from \n##### Other input is % receiving each subs therapy at each line dependent on previous treatments received \n##### Reweights so that the % receiving each treatment sums to 100% within each arm / line being studied\n##### Outputs a matrix that has the % receiving each possible combination\n\nsource(file.path(f_path, \"sequencing/sequences.R\"))\n\n# 2.3. Survival analysis functions ---------------------------------------------\n\n# Function: conduct survival analysis\n##### by treatment, line, population and outcome fitted survival curves using Flexsurvreg (exp, Weibull, lognormal, loglog, Gompertz, gen gamma)\n##### calculation of and adjustment for general population\n##### adjustment for treatment effect waning\n\nsource(file.path(f_path, \"survival/Survival_functions.R\"))\nsource(file.path(f_path, \"survival/other_cause_mortality.R\"))\nsource(file.path(f_path, \"survival/treatment_effect_waning.R\"))\n\n# 2.4 Misc functions ----------------------------------------------------------\n\n### these functions enable smoother data cleaning and manipulation\n\nsource(file.path(f_path, \"misc/other.R\"))\nsource(file.path(f_path, \"misc/shift_and_pad.R\"))\nsource(file.path(f_path, \"misc/cleaning.R\"))\n\n# 2.4.1 Functions imposing list structures -----------------------------------\n\nsource(file.path(f_path, \"misc/nesting.R\"))\nsource(file.path(f_path, \"misc/discounting.R\"))\nsource(file.path(f_path, \"misc/qdirichlet.R\"))\nsource(file.path(f_path, \"misc/plotting.R\"))\nsource(file.path(f_path, \"misc/structure.R\"))\n\n# 2.4.2 Functions calculating HRs from FPNMA coefficients and other FPNMA manipulation ------\n\nsource(file.path(f_path, \"misc/fpnma_fns.R\"))\n\n\n# 2.5 Utility functions -------------------------------------------------------\n\nsource(file.path(f_path, \"utility/age_related.R\"))\nsource(file.path(f_path, \"costs_and_QALYs/utility_processing.R\"))\n\n# 2.6 AE functions --------------------------------------------------------\n\nsource(file.path(f_path, \"adverse_events/AE_steps.R\"))\n\n# 2.7 Cost calculation functions --------------------------------------------\n\nsource(file.path(f_path, \"costs_and_QALYs/cost_processing.R\"))\n\n\n# 2.8 State transition modelling functions --------------------------------\n\nsource(file.path(f_path, \"markov/markov.R\"))\n\n# 2.9 Patient flow functions ----------------------------------------------\n\nsource(file.path(f_path, \"patient_flow/overarching.R\"))\nsource(file.path(f_path, \"patient_flow/partitioned_survival.R\"))\nsource(file.path(f_path, \"patient_flow/markov.R\"))\nsource(file.path(f_path, \"patient_flow/drug_costs.R\"))\nsource(file.path(f_path, \"patient_flow/hcru_costs.R\"))\nsource(file.path(f_path, \"patient_flow/qalys.R\"))\nsource(file.path(f_path, \"patient_flow/ae.R\"))\n\n\n\n# 2.10 Results processing functions ---------------------------------------\n\nsource(file.path(f_path, \"results/incremental_analysis.R\"))\nsource(file.path(f_path, \"results/model_averaging.R\"))\nsource(file.path(f_path, \"results/partitioned_survival.R\"))\nsource(file.path(f_path, \"misc/severity_modifier.R\"))\nsource(file.path(f_path, \"results/results_tables.R\"))\nsource(file.path(f_path, \"psa/psa functions.R\"))\n\n\n\n# 2.11 Office software outputs --------------------------------------------\n\nsource(file.path(f_path, \"reporting/word_document_output.R\"))",
    "crumbs": [
      "Code walkthrough",
      "Set-up"
    ]
  },
  {
    "objectID": "pages/walkthrough/code1_setup.html#get-some-of-the-model-inputs",
    "href": "pages/walkthrough/code1_setup.html#get-some-of-the-model-inputs",
    "title": "Set-up",
    "section": "Get some of the model inputs",
    "text": "Get some of the model inputs\n\nIntroductory comments\nThis section of the code is mostly comments that describe:\n\nThe structure of i which contains model inputs\nThat survival analysis will be conducted using state transition (markov) models and partitioned survival analysis (partSA)\nThe five input files, which are detailed within the documentation on the page Input data\n\nThere is a line of code to define User_types, but this appears to be legacy as it is not used anywhere.\n\n# 3. Model inputs structure --------------------------------------------------\n\n# Model inputs should be in a list called i. This list then contains all of the\n# inputs for the model, NOT the parameters used to calculate the model. In effect,\n# this is a place to store all model information BEFORE it gets boiled down to\n# what's needed to run 1 model.\n# \n# using i allows subsetting by categorisation, which makes things a lot easier\n# to find and avoids all long variable names\n# \n# the structure of i should be by category. There are the following \n# categories:\n# \n# dd - dropdown inputs taken from Excel\n# i - parameter inputs taken from Excel\n# r_ tables taken from Excel\n# List, id and lookup - lists defined and used within the code\n# basic - basic inputs (time horizon, cycle length, discount rates, so on so forth)\n# surv  - survival analysis inputs including raw data\n# sequences and seq - inputs and outputs related to the possible sequences of treatments\n# cost  - drug and hcru costs. All costs are here to keep things together (dosing is not cost)\n# util and QALYs  - utility and QALY inputs\n# misc  - misc inputs e.g. graph labelling\n# \n\n#### 3.1 Loading input parameters ###########\n\n# This model allows two possible structures to be analysed: state transition with a user definable number of lines\n# with health states based on time to discontinuation (drug costs) and progression status (quality of life and movement \n# between lines) and PartSA with 3 health states (pre-progression, post-progression and death)\n\n# During Phase 1 of this pilot we use the model to evaluate the decision problem for a single therapy \n# (cabo+nivo, defined as molecule 1) starting at 1st line\n# During Phase 2 we will adapt this code to evaluate the cost-effectiveness of sequences starting at a user-defined line\n\n# Inputs to this model need to be downloaded from NICEdocs \n\nUser_types &lt;- c(\"Submitting company\", \"NICE\", \"EAG\", \"Committee\", \"NHSE\", \"Clinical expert\", \"Patient expert\", \"Non-intervention stakeholder\", \"Public\")\n\n# The submitting company are able to see their own CIC and AIC data (marked up blue / yellow in reporting but not anything else: green marking\n# green marked data has been either be replaced with 0 [PAS discounts, RWE IPD] or dummy data)\n# NICE users will be able to see everything\n# Other users will not be able to see any marked data, this is replaced with dummy data\n\n# The way raw data is fed into the model currently works as follows\n# Define the path to where the data file lives using the select file functionality\n\n# The model then processes the file the user selected\n\n# There are a number of files which contain raw or intermediate inputs:\n# 1. The Excel user interface - this contains information from company data and the UK RWE\n# 2. The proportional hazards NMA CODA RDS file - this contains information from company data\n# 3. The fractional polynomials NMA RDS file - this contains information from company data \n# 4. Either the raw data file containing the pseudo-IPD for all trials for survival analysis (RWE and company data included); or\n# 5. The RDS output from the survival analysis using both RWE and company data\n\n# You will need to manually select the inputs file relevant to your user type, this is not stored on Github as access to CIC information differs by user type\n\n\n\nGet inputs from excel workbook and save as list i\nImport the file at excel_path using f_excel_extract(), and then tidy i$R_table_param using f_excel_cleanParams().\nIf the file doesn’t exist, assuming the user is in RStudio, a dialog box will appear with the system files, and the user should then select a file from their directory. The dialog will open in 1_Data/, show only .xlsm files, and the accept/ok button has the text ID6184_RCC_model inputs....xlsm.\n\n# The first part of this code pulls all of the named ranges from the excel workbook, expand the parameters table\n\n#Option to define Excel path on local machine - comment in this and comment out the code below to select file\nexcel_path &lt;- file.path(d_path, \"ID6184_RCC_model inputs FAD version [UK RWE unredacted, ACIC redacted, cPAS redacted].xlsm\")\n#i &lt;- f_excel_extract(excel_path, verbose = TRUE)\n\nif (file.exists(excel_path)) {\n  i &lt;- f_excel_extract(excel_path, verbose = FALSE)\n} else {\n  i &lt;- f_excel_extract(rstudioapi::selectFile(\n    caption = \"Select the Excel inputs file (ID6184_RCC_model inputs....xlsm)\",\n    label = \"ID6184_RCC_model inputs....xlsm\",\n    path = \"./1_Data/\",\n    filter = \"Excel Files (*.xlsm)\",\n    existing = TRUE\n  ), verbose = FALSE)\n}\n\ni &lt;- c(i,f_excel_cleanParams(i$R_table_param))\n\n\n\n\n\n\n\nWhat does f_excel_extract() do?\n\n\n\n\n\nThis function uses openxlsx::getNamedRegions() to find named regions in the workbook. These are all stored in a sheet called named ranges. As illustrated in Input data, these consist of two columns:\n\nA name for the region (e.g. List_pop1_allowed)\nThe region, which consists of the: sheet, column/s and row/s (e.g. =Lists!$BA$11:$BA$22)\n\n\nThe function f_excel_extract() extracts each of these, saving them into a nested list called i. Each element in the list is a row from the named ranges sheet - for example:\n\ni$List_pop1_allowed\n\n [1] \"avelumab_plus_axitinib\"      \"axitinib\"                   \n [3] \"cabozantinib\"                \"everolimus\"                 \n [5] \"lenvatinib_plus_everolimus\"  \"cabozantinib_plus_nivolumab\"\n [7] \"nivolumab_monotherapy\"       \"pazopanib\"                  \n [9] \"sunitinib\"                   \"tivozanib\"                  \n\n\nThe exception is the first element which is a copy of the named ranges sheet:\n\nkable(head(i[[1]]))\n\n\n\n\n\n\n\n\nName\nCell.Range\n\n\n\n\napply_waning_to\n=Lists!$Y\\(10:\\)Y\\(11      |\n|bc_settings_rng        |=Lists!\\)B\\(99:\\)B\\(174     |\n|cabo_nivo_outcome_from |=Lists!\\)W\\(10            |\n|cabo_nivo_outcomes     |=Lists!\\)X\\(10:\\)X\\(12      |\n|count_bc_settings      |=Lists!\\)B\\(97            |\n|dd_2ndline_NMA         |='Model settings'!\\)G$40\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWhat does f_excel_cleanParams() do?\n\n\n\n\n\nThis function is applied to i$R_table_param which is the full table from the sheet All parameters.\n\nkable(head(i$R_table_param))\n\n\n\n\n\n\n\n\n\nParameter.description\nParameter.name\nMean.current.value\n\n\n\n\nInclude cabo nivo? (1=yes, 0=no)\ncabo_nivo_include\n1\n\n\nInclude pem len? (1=yes, 0=no)\npem_len_include\n1\n\n\nInclude panzopanib? (1=yes, 0=no)\npazopanib_include\n1\n\n\nInclude tivozanib? (1=yes, 0=no)\ntivozanib_include\n1\n\n\nInclude sunitinib? (1=yes, 0=no)\nsunitinib_include\n1\n\n\nInclude cabo monotherapy? (1=yes, 0=no)\ncabo_include\n1\n\n\n\n\n\nThe function f_excel_cleanParams():\n\nConverts each row of the table into a list, with value from Parameter.name used as the list name\nAdds Mean which is simply Mean.current.value converted to numeric\n\nThese lists were then concatenated with i, so we can access them from i as follows:\n\ni$cabo_nivo_include\n\n$Parameter.description\n[1] \"Include cabo nivo? (1=yes, 0=no)\"\n\n$Parameter.name\n[1] \"cabo_nivo_include\"\n\n$Mean.current.value\n[1] \"1\"\n\n$Mean\n[1] 1\n\n\n\n\n\n\n\nManually add some extra inputs to i\n\n# Set which decision problem to look at, initially functionality has been geared towards the decision problem for cabozantinib plus nivolumab\ni$decision_problem &lt;- \"cabo+nivo\"\n\n# We then create a place for identifiers. Adding in an object to i full of lookup tables makes automated translation\n# possible even when one doesn't know the number of items ex ante, or how they combine.\n# \n# If the lookup table is correct one can translate id numbers to text strings which are\n# consistent throughout the entire model. This is extremely useful as the model can\n# be expanded to any number of treatments and potentially even any number of lines \n# (up to a reasonable maximum)\n\ni$id     &lt;- list(ipd = list())\ni$lookup &lt;- list(ipd = list())\n\n# Add distribution names to i\n# This model only includes standard parametric distributions as more complex distributions were not deemed to be required for the included treatments\n\ni$distnames &lt;- \n  c(\n    gengamma      = \"gengamma\",\n    exp           = \"exp\",\n    weibull       = \"weibull\",\n    lnorm         = \"lnorm\",\n    gamma         = \"gamma\",\n    gompertz      = \"gompertz\",\n    llogis        = \"llogis\"\n  )\n\n\n\nUse i to make another list p\nThe list p is based on i, either copying over parameters or using them to calculate new parameters. The list is first created by f_misc_param_generate_p(). A few extra additions are then made to p in this code block, such as to set a maximum of 4 treatment lines before best supportive care.\n\n# The next step is to then \"tidy up\" i into another object, p. p doesn't necessarily\n# have to house everything, only things that will change in PSA\n\np &lt;- f_misc_param_generate_p(i)\n\n# Set seed for PSA - note this is done in the script to run the PSA, not here!\n# set.seed(1475)\n\n# Max lines within the R model\np$basic$R_maxlines &lt;- 4\n\n# Pass this into p so that p can be used to exclusively compute the model:\np$basic$decision_problem &lt;- i$decision_problem\n\n\n\n\n\n\n\nWhat does f_misc_param_generate_p() do?\n\n\n\n\n\nThis function consists of relatively simple calculations using parameters from i to generate p. For the full overview of these calculations, check out the code for the function. To give an example though, the function code includes:\np &lt;- list(\n    basic = list(\n      th   = ceiling(i$ui_time_horizon * 365.25 / 7), \n      th_y = i$ui_time_horizon, \n      ...\n    )\n    ...\n)\nIn this example, we can see that is makes a copy of i$ui_time_horizon which has time horizon of model in years (40 years) (p$basic$th_y). It also converts the time horizon into weeks (p$basic$th).\n\ni$ui_time_horizon\n\n[1] 40\n\np$basic$th\n\n[1] 2088\n\np$basic$th_y\n\n[1] 40",
    "crumbs": [
      "Code walkthrough",
      "Set-up"
    ]
  },
  {
    "objectID": "pages/walkthrough/code1_setup.html#treatment-sequences",
    "href": "pages/walkthrough/code1_setup.html#treatment-sequences",
    "title": "Set-up",
    "section": "Treatment sequences",
    "text": "Treatment sequences\n\nFind all possible sequences\nThe first step in determining the possible treatment sequences is to determine all possible combinations and orders of treatment, saving this as i$sequences.\n\n#### 3.2 Define sequences  ###########\n\n#### This code produces a list of possible sequences per population based upon the rules defined for RCC\n#### and the user input number of lines\n\n\n# Add drug names to comparators vector extracted from inputs list.\n\ni$sequences &lt;- f_generate_sequences(\n  comparators = i$List_comparators, \n  maxlines    = p$basic$R_maxlines\n)\n\n\n\n\n\n\n\nWhat does f_generate_sequences() do?\n\n\n\n\n\nThe input to this function is a list of all the possible treatments (14 options), and the maximum number of treatment lines (4).\n\ni$List_comparators\n\n [1] \"nivolumab_monotherapy\"         \"cabozantinib_plus_nivolumab\"  \n [3] \"nivolumab_plus_ipilimumab\"     \"lenvatinib_plus_pembrolizumab\"\n [5] \"avelumab_plus_axitinib\"        \"pazopanib\"                    \n [7] \"tivozanib\"                     \"sunitinib\"                    \n [9] \"cabozantinib\"                  \"lenvatinib_plus_everolimus\"   \n[11] \"everolimus\"                    \"axitinib\"                     \n[13] \"sorafenib\"                     \"placebo_BSC\"                  \n\n\nThe function f_generate_sequences() outputs a table saved as i$sequences. This contains every possible order and combination of treatments.\n\nkable(head(i$sequences, 3))\n\n\n\n\n\n\n\n\n\n\n\nV1\nV2\nV3\nV4\nV5\n\n\n\n\navelumab_plus_axitinib\naxitinib\ncabozantinib\ncabozantinib_plus_nivolumab\nBSC\n\n\navelumab_plus_axitinib\naxitinib\ncabozantinib\neverolimus\nBSC\n\n\navelumab_plus_axitinib\naxitinib\ncabozantinib\nlenvatinib_plus_everolimus\nBSC\n\n\n\n\ndim(i$sequences)\n\n[1] 26404     5\n\n\nThese varied from a single treatment to up to four subsequent treatments, but always ended with best supportive case (BSC).\n\nkable(head(i$sequences[i$sequences$V3==\"\",], 3))\n\n\n\n\nV1\nV2\nV3\nV4\nV5\n\n\n\n\navelumab_plus_axitinib\nBSC\n\n\n\n\n\naxitinib\nBSC\n\n\n\n\n\ncabozantinib\nBSC\n\n\n\n\n\n\n\n\n\n\n\n\n\nFilter to valid sequences\nThe table of all possible treatment sequences is then filtered down to valid sequences (for example, removing drugs if not allowed for a given population, or after another particular drug).\n\n\n# restrict the pathways to those that are possible and permitted.\ni$sequences &lt;- as.data.frame(i$sequences)\n\npopulations &lt;- i$i_nr_populations\n\nseqs &lt;- NULL\ninvisible(\n for (population in 1:populations) {\n  cat(\"Applying sequence restrictions to population\", population,\"\\n\")\n  \n  s &lt;- f_path_tx_restrict(\n    sequences                = i$sequences,\n    allowed                  = f_get_allowed_lists(i, population), #overall list of allowed drugs in this popn\n    L1                       = f_get_L1_lists(i, population), # 1L drugs allowed in this popn\n    L2                       = f_get_L2_lists(i, population), # 2L drugs allowed in this popn\n    L3                       = f_get_L3_lists(i, population), # 3L drugs allowed in this popn\n    L4                       = f_get_L4_lists(i, population), # 4L drugs allowed in this popn\n    only_after               = f_get_only_after_lists(i, population), #list of restrictions where tx can be only after the listed txs\n    not_immediate_after      = f_get_not_immediate_after_lists(i, population), #list of restrictions where tx can be only immediately before the listed txs\n    one_in_list              = f_get_one_in_list_lists(i, population), #list of restrictions where only one of the tx in each list is allowed \n    only_after_one           = f_get_only_after_one_lists(i, population), #list of restrictions where only one of the listed treatments is allowed prior to current therapy \n    L2_only_after            = f_get_2L_only_after_lists(i, population), #list of 2L+ restrictions: if drug is used 2L, 3L or 4L, can only be after drug x\n    L2_only_immediate_after  = f_get_2L_only_immediate_after_lists(i, population), #list of 2L+ restrictions: if drug is used 2L, 3L or 4L, can only be immediately after drug x\n    L2_only_one              = f_get_2L_only_one_lists(i, population) #list of 2L+ drugs where only one of them allowed in a given sequence\n  )\n  s &lt;- cbind(rep(paste0(\"pop\", population),nrow(s)), s)\n  colnames(s) &lt;- paste0('V', seq_len(ncol(s))) # rbind no longer likes un-named columns so added this\n  seqs &lt;- rbind(seqs, s)\n} \n)\nrownames(seqs) &lt;- NULL\n\ni$sequences &lt;- seqs\n\n#### Uncomment this code to view the sequences and write the sequences defined to csv\n\n# i$sequences\n# write.csv(seqs, \"4_Output/sequences.csv\", row.names = F)\nrm(s, seqs, populations)\n\n# define number of cycles and a vector of the cycles \n\n\n\n\n\n\n\nAbout the populations being looped through\n\n\n\n\n\nThis code chunk restricted to valid sequences by population. In this analysis, there are four populations defined by time since an immuno-oncology (IO) treatment, and International Metastatic Renal Cell Carcinoma Database Consortium (IMDC) risk status. They are:\n\npop1 &gt;12m since IO, favourable risk\npop2 &gt;12m since IO, intermediate/poor risk\npop3 &lt;12m since IO, favourable risk\npop4 &lt;12m since IO, intermediate/poor risk\n\nEach risk group has to be broken down by time since IO as there are five treatments that cannot be used within 12 months of an adjuvant IO treatment (4.3.5.6 in Assessment Report [1]). An adjuvant treatment is one given alongside the primary treatment.\n\n\n\n\n\n\n\n\n\nWhat criteria are there for valid treatments?\n\n\n\n\n\n\nBy population and line\nFor each population, there are a list of valid treatments at each line of therapy (first-line through to fourth). For example, valid first-line treatments for population 1 are:\n\n# Pop1 1L treatments\nf_get_L1_lists(i, 1)\n\n[1] \"avelumab_plus_axitinib\"      \"cabozantinib_plus_nivolumab\"\n[3] \"pazopanib\"                   \"sunitinib\"                  \n[5] \"tivozanib\"                  \n\n\n\n\nOnly after\nThere are some treatments that can only come after other treatments. For example, for population 1:\n\nAxitinib can only be administered after a tyrosine kinase inhibitor (TKI) or cytokine treatment\nEverolimus can only be administered after a vascular endothelial growth factor (VEGF) treatment\nAt 2L 3L or 4L, cabozantinib can only be administered after one of the listed treatments\n\n\nf_get_only_after_lists(i, 1)\n\n$axitinib\n[1] \"avelumab_plus_axitinib\"        \"cabozantinib\"                 \n[3] \"lenvatinib_plus_everolimus\"    \"cabozantinib_plus_nivolumab\"  \n[5] \"pazopanib\"                     \"lenvatinib_plus_pembrolizumab\"\n[7] \"sunitinib\"                     \"tivozanib\"                    \n\n$everolimus\n[1] \"avelumab_plus_axitinib\"        \"axitinib\"                     \n[3] \"cabozantinib\"                  \"lenvatinib_plus_everolimus\"   \n[5] \"cabozantinib_plus_nivolumab\"   \"pazopanib\"                    \n[7] \"lenvatinib_plus_pembrolizumab\" \"sunitinib\"                    \n[9] \"tivozanib\"                    \n\nf_get_2L_only_after_lists(i, 1)\n\n$cabozantinib\n[1] \"avelumab_plus_axitinib\"        \"axitinib\"                     \n[3] \"lenvatinib_plus_everolimus\"    \"cabozantinib_plus_nivolumab\"  \n[5] \"pazopanib\"                     \"lenvatinib_plus_pembrolizumab\"\n[7] \"sunitinib\"                     \"tivozanib\"                    \n\n\n\n\nNot immediately after\nSome treatments cannot come immediately after another treatment. For example, for population 1:\n\nLenvatinib plus everolimus must not come immediately after nivolumab plus ipilimumab\nAt 2L 3L or 4L, pazopanib and sunitinib and tivozanib must not come immediately after their respective listed treatments\n\n\nf_get_not_immediate_after_lists(i, 1)\n\n$lenvatinib_plus_everolimus\n[1] \"nivolumab_plus_ipilimumab\"\n\nf_get_2L_only_immediate_after_lists(i, 1)\n\n$pazopanib\n[1] \"avelumab_plus_axitinib\"        \"lenvatinib_plus_pembrolizumab\"\n[3] \"cabozantinib_plus_nivolumab\"   \"nivolumab_plus_ipilimumab\"    \n\n$sunitinib\n[1] \"avelumab_plus_axitinib\"        \"lenvatinib_plus_pembrolizumab\"\n[3] \"cabozantinib_plus_nivolumab\"   \"nivolumab_plus_ipilimumab\"    \n\n$tivozanib\n[1] \"avelumab_plus_axitinib\"        \"lenvatinib_plus_pembrolizumab\"\n[3] \"cabozantinib_plus_nivolumab\"   \"nivolumab_plus_ipilimumab\"    \n\n\n\n\nOnly one from list\nSome treatments are not allowed if another has already been given at any point prior.\nFor example, for population 1 there are five lists of treatments where only one treatment from each list is allowed.\nThere are no restrictions like this for population 1 specific to just 2L 3L or 4L treatments (hence, empty list).\n\nf_get_one_in_list_lists(i, 1)\n\n$axitinib\n[1] \"avelumab_plus_axitinib\" \"axitinib\"              \n\n$cabozantinib\n[1] \"cabozantinib\"                \"cabozantinib_plus_nivolumab\"\n\n$everolimus\n[1] \"lenvatinib_plus_everolimus\" \"everolimus\"                \n\n$io\n[1] \"avelumab_plus_axitinib\"        \"nivolumab_plus_ipilimumab\"    \n[3] \"cabozantinib_plus_nivolumab\"   \"nivolumab_monotherapy\"        \n[5] \"lenvatinib_plus_pembrolizumab\"\n\n$nivolumab\n[1] \"nivolumab_plus_ipilimumab\"   \"cabozantinib_plus_nivolumab\"\n[3] \"nivolumab_monotherapy\"      \n\n$TKIs\n[1] \"sunitinib\" \"pazopanib\" \"tivozanib\"\n\nf_get_2L_only_one_lists(i, 1)\n\nnamed list()\n\n\n\n\nOnly one allowed before\nIn other cases, a treatment is not allowed if more than one of a particular category of treatment has been given. For example, for population 1:\n\nOf the listed treatments, only one is allowed before lenvatinib plus everolimus\n\n\nf_get_only_after_one_lists(i, 1)\n\n$lenvatinib_plus_everolimus\n[1] \"avelumab_plus_axitinib\"        \"axitinib\"                     \n[3] \"cabozantinib\"                  \"cabozantinib_plus_nivolumab\"  \n[5] \"pazopanib\"                     \"lenvatinib_plus_pembrolizumab\"\n[7] \"sunitinib\"                     \"tivozanib\"                    \n\n\n\n\n\n\n\n\n\n\n\n\nWhat does f_path_tx_restrict() do?\n\n\n\n\n\nThe function f_path_tx_restrict() is defined in sequences.R (there is also a function of the same name in rccFunctions.R but this is not sourced).\nIts purpose is to restrict the table of all possible sequences to just the valid sequences for each population, restricting it from 26404 rows with possible treatment sequences to just 744.\n\ndim(i$sequences)\n\n[1] 26404     5\n\n\nThe inputs to this function are lists defining valid treatments by different criteria (e.g. line of therapy, subsequent treatments), as detailed in the note above.\nWithin f_path_tx_restrict(), there are then several other functions which take these lists and use them to remove invalid sequences from the table.\nFor example, the allowed treatments identified using f_get_allowed_lists() are input to f_path_tx_restrict() as allowed. The function f_path_allowed() then uses that list to remove invalid drugs for a given population:\ns &lt;- f_path_allowed(s, allowed[[1]])\nLooking at an excerpt of the code for f_path_allowed(), we can see that is adds “BSC” and no treatment (““) as valid options, and then only keeps rows if their treatments are in (%in%) the list of valid treatments.\nrule &lt;- c(rule, \"BSC\", \"\")\n\nfor (n in 1:ncol(perms)) {\n  perms &lt;- perms[perms[,n] %in% rule,]\n}\n\n\n\n\n\n\n\n\n\nView the sequence restrictions applied\n\n\n\n\n\n\n\nApplying sequence restrictions to population 1 \nDropping drugs not allowed for this population.\napplying rule: avelumab_plus_axitinib axitinib cabozantinib everolimus lenvatinib_plus_everolimus cabozantinib_plus_nivolumab nivolumab_monotherapy pazopanib sunitinib tivozanib are only allowed treatments.\nPermutations before applying rule: 26404 \nPermutations after applying rule : 5860 \napplying rule: drug line restrictions.\nPermutations before applying rule: 5860 \nPermutations after applying rule : 628 \n[1] \"axitinib\"\napplying rule. axitinib is only allowed after avelumab_plus_axitinib cabozantinib lenvatinib_plus_everolimus cabozantinib_plus_nivolumab pazopanib lenvatinib_plus_pembrolizumab sunitinib tivozanib \nPermutations before applying rule: 628 \nPermutations after applying rule : 628 \n[1] \"everolimus\"\napplying rule. everolimus is only allowed after avelumab_plus_axitinib axitinib cabozantinib lenvatinib_plus_everolimus cabozantinib_plus_nivolumab pazopanib lenvatinib_plus_pembrolizumab sunitinib tivozanib \nPermutations before applying rule: 628 \nPermutations after applying rule : 628 \n[1] \"lenvatinib_plus_everolimus\"\napplying rule. lenvatinib_plus_everolimus is not allowed immediately after nivolumab_plus_ipilimumab \nPermutations before applying rule: 628 \nPermutations after applying rule : 628 \n[1] \"axitinib\"\napplying rule axitinib : avelumab_plus_axitinib axitinib cannot be in one permutation\nPermutations before applying rule: 628 \nPermutations after applying rule : 559 \n[1] \"cabozantinib\"\napplying rule cabozantinib : cabozantinib cabozantinib_plus_nivolumab cannot be in one permutation\nPermutations before applying rule: 559 \nPermutations after applying rule : 520 \n[1] \"everolimus\"\napplying rule everolimus : lenvatinib_plus_everolimus everolimus cannot be in one permutation\nPermutations before applying rule: 520 \nPermutations after applying rule : 452 \n[1] \"io\"\napplying rule io : avelumab_plus_axitinib nivolumab_plus_ipilimumab cabozantinib_plus_nivolumab nivolumab_monotherapy lenvatinib_plus_pembrolizumab cannot be in one permutation\nPermutations before applying rule: 452 \nPermutations after applying rule : 400 \n[1] \"nivolumab\"\napplying rule nivolumab : nivolumab_plus_ipilimumab cabozantinib_plus_nivolumab nivolumab_monotherapy cannot be in one permutation\nPermutations before applying rule: 400 \nPermutations after applying rule : 400 \n[1] \"TKIs\"\napplying rule TKIs : sunitinib pazopanib tivozanib cannot be in one permutation\nPermutations before applying rule: 400 \nPermutations after applying rule : 202 \n[1] \"lenvatinib_plus_everolimus\"\napplying rule: lenvatinib_plus_everolimus can only be after ONE of avelumab_plus_axitinib axitinib cabozantinib cabozantinib_plus_nivolumab pazopanib lenvatinib_plus_pembrolizumab sunitinib tivozanib \nPermutations before applying rule: 202 \nPermutations after applying rule : 182 \n[1] \"cabozantinib\"\napplying rule: cabozantinib as 2L+ only allowed after avelumab_plus_axitinib axitinib lenvatinib_plus_everolimus cabozantinib_plus_nivolumab pazopanib lenvatinib_plus_pembrolizumab sunitinib tivozanib \nPermutations before applying rule: 182 \nPermutations after applying rule : 182 \n[1] \"pazopanib\"\napplying rule: pazopanib as 2L+ only allowed immediately after avelumab_plus_axitinib lenvatinib_plus_pembrolizumab cabozantinib_plus_nivolumab nivolumab_plus_ipilimumab \nPermutations before applying rule: 182 \nPermutations after applying rule : 172 \n[1] \"sunitinib\"\napplying rule: sunitinib as 2L+ only allowed immediately after avelumab_plus_axitinib lenvatinib_plus_pembrolizumab cabozantinib_plus_nivolumab nivolumab_plus_ipilimumab \nPermutations before applying rule: 172 \nPermutations after applying rule : 162 \n[1] \"tivozanib\"\napplying rule: tivozanib as 2L+ only allowed immediately after avelumab_plus_axitinib lenvatinib_plus_pembrolizumab cabozantinib_plus_nivolumab nivolumab_plus_ipilimumab \nPermutations before applying rule: 162 \nPermutations after applying rule : 152 \nApplying sequence restrictions to population 2 \nDropping drugs not allowed for this population.\napplying rule: avelumab_plus_axitinib axitinib cabozantinib everolimus nivolumab_plus_ipilimumab lenvatinib_plus_everolimus cabozantinib_plus_nivolumab nivolumab_monotherapy pazopanib lenvatinib_plus_pembrolizumab sunitinib tivozanib are only allowed treatments.\nPermutations before applying rule: 26404 \nPermutations after applying rule : 13344 \napplying rule: drug line restrictions.\nPermutations before applying rule: 13344 \nPermutations after applying rule : 1036 \n[1] \"axitinib\"\napplying rule. axitinib is only allowed after avelumab_plus_axitinib cabozantinib lenvatinib_plus_everolimus cabozantinib_plus_nivolumab pazopanib lenvatinib_plus_pembrolizumab sunitinib tivozanib \nPermutations before applying rule: 1036 \nPermutations after applying rule : 1017 \n[1] \"everolimus\"\napplying rule. everolimus is only allowed after avelumab_plus_axitinib axitinib cabozantinib lenvatinib_plus_everolimus cabozantinib_plus_nivolumab pazopanib lenvatinib_plus_pembrolizumab sunitinib tivozanib \nPermutations before applying rule: 1017 \nPermutations after applying rule : 1004 \n[1] \"lenvatinib_plus_everolimus\"\napplying rule. lenvatinib_plus_everolimus is not allowed immediately after nivolumab_plus_ipilimumab \nPermutations before applying rule: 1004 \nPermutations after applying rule : 984 \n[1] \"axitinib\"\napplying rule axitinib : avelumab_plus_axitinib axitinib cannot be in one permutation\nPermutations before applying rule: 984 \nPermutations after applying rule : 915 \n[1] \"cabozantinib\"\napplying rule cabozantinib : cabozantinib cabozantinib_plus_nivolumab cannot be in one permutation\nPermutations before applying rule: 915 \nPermutations after applying rule : 876 \n[1] \"everolimus\"\napplying rule everolimus : lenvatinib_plus_everolimus everolimus cannot be in one permutation\nPermutations before applying rule: 876 \nPermutations after applying rule : 773 \n[1] \"io\"\napplying rule io : avelumab_plus_axitinib nivolumab_plus_ipilimumab cabozantinib_plus_nivolumab nivolumab_monotherapy lenvatinib_plus_pembrolizumab cannot be in one permutation\nPermutations before applying rule: 773 \nPermutations after applying rule : 657 \n[1] \"lenvatinib_plus_everolimus\"\napplying rule lenvatinib_plus_everolimus : lenvatinib_plus_everolimus lenvatinib_plus_pembrolizumab cannot be in one permutation\nPermutations before applying rule: 657 \nPermutations after applying rule : 638 \n[1] \"nivolumab\"\napplying rule nivolumab : nivolumab_plus_ipilimumab cabozantinib_plus_nivolumab nivolumab_monotherapy cannot be in one permutation\nPermutations before applying rule: 638 \nPermutations after applying rule : 638 \n[1] \"TKIs\"\napplying rule TKIs : sunitinib pazopanib tivozanib cannot be in one permutation\nPermutations before applying rule: 638 \nPermutations after applying rule : 386 \n[1] \"lenvatinib_plus_everolimus\"\napplying rule: lenvatinib_plus_everolimus can only be after ONE of avelumab_plus_axitinib axitinib cabozantinib cabozantinib_plus_nivolumab pazopanib lenvatinib_plus_pembrolizumab sunitinib tivozanib \nPermutations before applying rule: 386 \nPermutations after applying rule : 359 \n[1] \"cabozantinib\"\napplying rule: cabozantinib as 2L+ only allowed after avelumab_plus_axitinib axitinib nivolumab_plus_ipilimumab lenvatinib_plus_everolimus cabozantinib_plus_nivolumab pazopanib lenvatinib_plus_pembrolizumab sunitinib tivozanib \nPermutations before applying rule: 359 \nPermutations after applying rule : 359 \n[1] \"pazopanib\"\napplying rule: pazopanib as 2L+ only allowed immediately after avelumab_plus_axitinib lenvatinib_plus_pembrolizumab cabozantinib_plus_nivolumab nivolumab_plus_ipilimumab \nPermutations before applying rule: 359 \nPermutations after applying rule : 339 \n[1] \"sunitinib\"\napplying rule: sunitinib as 2L+ only allowed immediately after avelumab_plus_axitinib lenvatinib_plus_pembrolizumab cabozantinib_plus_nivolumab nivolumab_plus_ipilimumab \nPermutations before applying rule: 339 \nPermutations after applying rule : 319 \n[1] \"tivozanib\"\napplying rule: tivozanib as 2L+ only allowed immediately after avelumab_plus_axitinib lenvatinib_plus_pembrolizumab cabozantinib_plus_nivolumab nivolumab_plus_ipilimumab \nPermutations before applying rule: 319 \nPermutations after applying rule : 299 \nApplying sequence restrictions to population 3 \nDropping drugs not allowed for this population.\napplying rule: axitinib cabozantinib everolimus lenvatinib_plus_everolimus nivolumab_monotherapy pazopanib sunitinib tivozanib are only allowed treatments.\nPermutations before applying rule: 26404 \nPermutations after applying rule : 2080 \napplying rule: drug line restrictions.\nPermutations before applying rule: 2080 \nPermutations after applying rule : 330 \n[1] \"axitinib\"\napplying rule. axitinib is only allowed after avelumab_plus_axitinib cabozantinib lenvatinib_plus_everolimus cabozantinib_plus_nivolumab pazopanib lenvatinib_plus_pembrolizumab sunitinib tivozanib \nPermutations before applying rule: 330 \nPermutations after applying rule : 330 \n[1] \"everolimus\"\napplying rule. everolimus is only allowed after avelumab_plus_axitinib axitinib cabozantinib lenvatinib_plus_everolimus cabozantinib_plus_nivolumab pazopanib lenvatinib_plus_pembrolizumab sunitinib tivozanib \nPermutations before applying rule: 330 \nPermutations after applying rule : 330 \n[1] \"lenvatinib_plus_everolimus\"\napplying rule. lenvatinib_plus_everolimus is not allowed immediately after nivolumab_plus_ipilimumab \nPermutations before applying rule: 330 \nPermutations after applying rule : 330 \n[1] \"axitinib\"\napplying rule axitinib : avelumab_plus_axitinib axitinib cannot be in one permutation\nPermutations before applying rule: 330 \nPermutations after applying rule : 330 \n[1] \"everolimus\"\napplying rule everolimus : lenvatinib_plus_everolimus everolimus cannot be in one permutation\nPermutations before applying rule: 330 \nPermutations after applying rule : 288 \n[1] \"lenvatinib_plus_everolimus\"\napplying rule lenvatinib_plus_everolimus : lenvatinib_plus_everolimus lenvatinib_plus_pembrolizumab cannot be in one permutation\nPermutations before applying rule: 288 \nPermutations after applying rule : 288 \n[1] \"TKIs\"\napplying rule TKIs : sunitinib pazopanib tivozanib cannot be in one permutation\nPermutations before applying rule: 288 \nPermutations after applying rule : 120 \n[1] \"lenvatinib_plus_everolimus\"\napplying rule: lenvatinib_plus_everolimus can only be after ONE of axitinib cabozantinib pazopanib lenvatinib_plus_pembrolizumab sunitinib tivozanib \nPermutations before applying rule: 120 \nPermutations after applying rule : 111 \n[1] \"cabozantinib\"\napplying rule: cabozantinib as 2L+ only allowed after avelumab_plus_axitinib axitinib lenvatinib_plus_everolimus cabozantinib_plus_nivolumab pazopanib lenvatinib_plus_pembrolizumab sunitinib tivozanib \nPermutations before applying rule: 111 \nPermutations after applying rule : 111 \n[1] \"pazopanib\"\napplying rule: pazopanib as 2L+ only allowed immediately after avelumab_plus_axitinib lenvatinib_plus_pembrolizumab cabozantinib_plus_nivolumab nivolumab_plus_ipilimumab \nPermutations before applying rule: 111 \nPermutations after applying rule : 111 \n[1] \"sunitinib\"\napplying rule: sunitinib as 2L+ only allowed immediately after avelumab_plus_axitinib lenvatinib_plus_pembrolizumab cabozantinib_plus_nivolumab nivolumab_plus_ipilimumab \nPermutations before applying rule: 111 \nPermutations after applying rule : 111 \n[1] \"tivozanib\"\napplying rule: tivozanib as 2L+ only allowed immediately after avelumab_plus_axitinib lenvatinib_plus_pembrolizumab cabozantinib_plus_nivolumab nivolumab_plus_ipilimumab \nPermutations before applying rule: 111 \nPermutations after applying rule : 111 \nApplying sequence restrictions to population 4 \nDropping drugs not allowed for this population.\napplying rule: axitinib cabozantinib everolimus lenvatinib_plus_everolimus nivolumab_monotherapy pazopanib sunitinib tivozanib are only allowed treatments.\nPermutations before applying rule: 26404 \nPermutations after applying rule : 2080 \napplying rule: drug line restrictions.\nPermutations before applying rule: 2080 \nPermutations after applying rule : 440 \n[1] \"axitinib\"\napplying rule. axitinib is only allowed after avelumab_plus_axitinib cabozantinib lenvatinib_plus_everolimus cabozantinib_plus_nivolumab pazopanib lenvatinib_plus_pembrolizumab sunitinib tivozanib \nPermutations before applying rule: 440 \nPermutations after applying rule : 440 \n[1] \"everolimus\"\napplying rule. everolimus is only allowed after avelumab_plus_axitinib axitinib cabozantinib lenvatinib_plus_everolimus cabozantinib_plus_nivolumab pazopanib lenvatinib_plus_pembrolizumab sunitinib tivozanib \nPermutations before applying rule: 440 \nPermutations after applying rule : 440 \n[1] \"lenvatinib_plus_everolimus\"\napplying rule. lenvatinib_plus_everolimus is not allowed immediately after nivolumab_plus_ipilimumab \nPermutations before applying rule: 440 \nPermutations after applying rule : 440 \n[1] \"axitinib\"\napplying rule axitinib : avelumab_plus_axitinib axitinib cannot be in one permutation\nPermutations before applying rule: 440 \nPermutations after applying rule : 440 \n[1] \"everolimus\"\napplying rule everolimus : lenvatinib_plus_everolimus everolimus cannot be in one permutation\nPermutations before applying rule: 440 \nPermutations after applying rule : 384 \n[1] \"lenvatinib_plus_everolimus\"\napplying rule lenvatinib_plus_everolimus : lenvatinib_plus_everolimus lenvatinib_plus_pembrolizumab cannot be in one permutation\nPermutations before applying rule: 384 \nPermutations after applying rule : 384 \n[1] \"TKIs\"\napplying rule TKIs : sunitinib pazopanib tivozanib cannot be in one permutation\nPermutations before applying rule: 384 \nPermutations after applying rule : 198 \n[1] \"lenvatinib_plus_everolimus\"\napplying rule: lenvatinib_plus_everolimus can only be after ONE of axitinib cabozantinib pazopanib lenvatinib_plus_pembrolizumab sunitinib tivozanib \nPermutations before applying rule: 198 \nPermutations after applying rule : 182 \n[1] \"cabozantinib\"\napplying rule: cabozantinib as 2L+ only allowed after avelumab_plus_axitinib axitinib lenvatinib_plus_everolimus cabozantinib_plus_nivolumab pazopanib lenvatinib_plus_pembrolizumab sunitinib tivozanib \nPermutations before applying rule: 182 \nPermutations after applying rule : 182 \n[1] \"pazopanib\"\napplying rule: pazopanib as 2L+ only allowed immediately after avelumab_plus_axitinib lenvatinib_plus_pembrolizumab cabozantinib_plus_nivolumab nivolumab_plus_ipilimumab \nPermutations before applying rule: 182 \nPermutations after applying rule : 182 \n[1] \"sunitinib\"\napplying rule: sunitinib as 2L+ only allowed immediately after avelumab_plus_axitinib lenvatinib_plus_pembrolizumab cabozantinib_plus_nivolumab nivolumab_plus_ipilimumab \nPermutations before applying rule: 182 \nPermutations after applying rule : 182 \n[1] \"tivozanib\"\napplying rule: tivozanib as 2L+ only allowed immediately after avelumab_plus_axitinib lenvatinib_plus_pembrolizumab cabozantinib_plus_nivolumab nivolumab_plus_ipilimumab \nPermutations before applying rule: 182 \nPermutations after applying rule : 182",
    "crumbs": [
      "Code walkthrough",
      "Set-up"
    ]
  },
  {
    "objectID": "pages/changelog.html",
    "href": "pages/changelog.html",
    "title": "CHANGELOG",
    "section": "",
    "text": "All notable changes to this project will be documented in this file.\nThe format is based on Keep a Changelog, and this project adheres to Semantic Versioning. Dates formatted as YYYY-MM-DD as per ISO standard.\n\n\nProduced pilot shiny web application to find valid treatment sequences.\n\n\n\nShiny web application (in shinyapp/), which is also hosted on shinyapps.io\n\n\n\n\n\nAdd required packages for app to the renv\nAdd description of app to the main README file\n\n\n\n\n\nDetailed model documentation via a quarto site hosted with GitHub pages.\n\n\n\nQuarto site with detailed documentation for the model including:\n\nAcronyms\nContext on the associated NICE appraisals, articles and reports\nA detailed summary of the analysis\nA plain english summary of the analysis\nInstallation instructions\nA step-by-step walkthrough of the code in Model_Structure.R\nDescriptions of the probabilistic analysis and scenario analysis\nDetails about the license, citation instructions and the changelog\n\n\n\n\n\n\nAdd folder input to f_res_ProduceWordDoc() to allow specification of the output folder to save the word document too (as previously hard coded ./4_Output)\nAdd information about quarto website and run time to README.md\nMoved images from img/ to docs/images/\n\n\n\n\n\nRemoved unused template README and citation files from 1_Data/ 3_Functions/ and 4_Output/. The paragraph that had been entered into the template README in the data folder was moved onto the probabilistic analysis page in the quarto documentation\n\n\n\n\n\nEmbellished README\n\n\n\nAdd files produced by model run to .gitignore\n\n\n\n\n\nExtended README.md to include banner image with logos, extra badges, table of contents, all the information from ID6184 Using the R decision model.. (e.g. installation guide with images, overview of input files, future versions)\n\n\n\n\n\nImplemented the essential components of the STARS framework (exc. open science archive).\n\n\n\nCITATION.cff and GitHub action to check validity (cff_validation.yaml)\n\n\n\n\n\nExtended README.md to include some instructions for installing and running the model, more detailed repositoriy overview, citation information, ORCID IDs, acknowledgements, license and funding information\n\n\n\n\n\nFormatting of copyright statement in LICENSE\n\n\n\n\n\n🌱 First release. EOM-RCC model as shared by the PenTAG team, with minor changes that enabled us to run the model.\n\n\n\nCode from the original repository - https://github.com/nice-digital/NICE-model-repo\nR environment for dependency management (renv)\n\n\n\n\n\nSet model to run sequentially (in 2_Scripts/Model_Structure.R)",
    "crumbs": [
      "Changelog"
    ]
  },
  {
    "objectID": "pages/changelog.html#v1.3.0---2024-09-27",
    "href": "pages/changelog.html#v1.3.0---2024-09-27",
    "title": "CHANGELOG",
    "section": "",
    "text": "Produced pilot shiny web application to find valid treatment sequences.\n\n\n\nShiny web application (in shinyapp/), which is also hosted on shinyapps.io\n\n\n\n\n\nAdd required packages for app to the renv\nAdd description of app to the main README file",
    "crumbs": [
      "Changelog"
    ]
  },
  {
    "objectID": "pages/changelog.html#v1.2.0---2024-09-23",
    "href": "pages/changelog.html#v1.2.0---2024-09-23",
    "title": "CHANGELOG",
    "section": "",
    "text": "Detailed model documentation via a quarto site hosted with GitHub pages.\n\n\n\nQuarto site with detailed documentation for the model including:\n\nAcronyms\nContext on the associated NICE appraisals, articles and reports\nA detailed summary of the analysis\nA plain english summary of the analysis\nInstallation instructions\nA step-by-step walkthrough of the code in Model_Structure.R\nDescriptions of the probabilistic analysis and scenario analysis\nDetails about the license, citation instructions and the changelog\n\n\n\n\n\n\nAdd folder input to f_res_ProduceWordDoc() to allow specification of the output folder to save the word document too (as previously hard coded ./4_Output)\nAdd information about quarto website and run time to README.md\nMoved images from img/ to docs/images/\n\n\n\n\n\nRemoved unused template README and citation files from 1_Data/ 3_Functions/ and 4_Output/. The paragraph that had been entered into the template README in the data folder was moved onto the probabilistic analysis page in the quarto documentation",
    "crumbs": [
      "Changelog"
    ]
  },
  {
    "objectID": "pages/changelog.html#v1.1.1---2024-08-20",
    "href": "pages/changelog.html#v1.1.1---2024-08-20",
    "title": "CHANGELOG",
    "section": "",
    "text": "Embellished README\n\n\n\nAdd files produced by model run to .gitignore\n\n\n\n\n\nExtended README.md to include banner image with logos, extra badges, table of contents, all the information from ID6184 Using the R decision model.. (e.g. installation guide with images, overview of input files, future versions)",
    "crumbs": [
      "Changelog"
    ]
  },
  {
    "objectID": "pages/changelog.html#v1.1.0---2024-08-16",
    "href": "pages/changelog.html#v1.1.0---2024-08-16",
    "title": "CHANGELOG",
    "section": "",
    "text": "Implemented the essential components of the STARS framework (exc. open science archive).\n\n\n\nCITATION.cff and GitHub action to check validity (cff_validation.yaml)\n\n\n\n\n\nExtended README.md to include some instructions for installing and running the model, more detailed repositoriy overview, citation information, ORCID IDs, acknowledgements, license and funding information\n\n\n\n\n\nFormatting of copyright statement in LICENSE",
    "crumbs": [
      "Changelog"
    ]
  },
  {
    "objectID": "pages/changelog.html#v1.0.0---2024-08-16",
    "href": "pages/changelog.html#v1.0.0---2024-08-16",
    "title": "CHANGELOG",
    "section": "",
    "text": "🌱 First release. EOM-RCC model as shared by the PenTAG team, with minor changes that enabled us to run the model.\n\n\n\nCode from the original repository - https://github.com/nice-digital/NICE-model-repo\nR environment for dependency management (renv)\n\n\n\n\n\nSet model to run sequentially (in 2_Scripts/Model_Structure.R)",
    "crumbs": [
      "Changelog"
    ]
  },
  {
    "objectID": "pages/report.html",
    "href": "pages/report.html",
    "title": "Report",
    "section": "",
    "text": "This page shares an example of the output report produced by this model and walks through each section.",
    "crumbs": [
      "Code walkthrough",
      "Report"
    ]
  },
  {
    "objectID": "pages/report.html#view-full-report",
    "href": "pages/report.html#view-full-report",
    "title": "Report",
    "section": "View full report",
    "text": "View full report\nThe model produces a .docx report, which has been converted to a PDF and displayed below.",
    "crumbs": [
      "Code walkthrough",
      "Report"
    ]
  },
  {
    "objectID": "pages/report.html#walkthrough-of-report-sections",
    "href": "pages/report.html#walkthrough-of-report-sections",
    "title": "Report",
    "section": "Walkthrough of report sections",
    "text": "Walkthrough of report sections\n\nTable 1\nFor each 1L treatment in each risk population, the associated costs and impact on quality of life are described. These are:\n\nCosts\nLife-years gained (LYG)\nQuality-adjusted life-years (QALYs)\nIncremental cots, LYG and QALYs - all from comparison against the reference treatment (sunitinib)\nIncremental cost-effectiveness ratio (calculated from incremental costs and QALYs), either from comparison against the treatment under investigation (cabozantinib plus nivolumab) or the reference treatment (sunitinib)\n\nThe treatments are ordered by cost (ascending). These are results from the base case (i.e. not the scenario analysis).\n\n\n\nTable 1: Base-case results (ordered in increasing costs)\n\n\n\n\nTable 2\nAs mentioned on the detailed summary page, a “severity modifier” refers to applying weights to QALYs for conditions that are more severe.\n“Severity is measured in terms of absolute and proportional shortfall”. Absolute and proportional shortfall “both measure the difference between the number of QALYs patients would be expected to experience over the remainder of their lives under current care compared to the general population of the same age and sex”. [1]\nHence, this table presents the severity (described in terms of absolute and proportional shortfall) by different risk groups and choices of current care, and therefore the proposed modifier, depending on severity.\n\n\n\nTable 2: Application of the severity modifier to the base case\n\n\n\n\nTable 3 to 5\nThese tables present the life years (LY) gained by health state, with results for each line of treatment (on or off), plus best supportive care (BSC) and death. They compare two treatment strategies marked X and Y.\n\nTable 3 is for the all risk group and compares cabozantinib plus nivolumab against pazopanib\nTable 4 is for the favourable risk group and also compares against pazopanib\nTable 5 is for the intermediate/poor risk group and the comparator is lenvatinib plus pembrolizumab.\n\n\n\n\nTable 3: Summary of LY gain by health state (all risk, cabo+nivo vs next best non- dominated comparator: Pazopanib)\n\n\n\n\nTables 6 to 8\nThese tables present the QALYs gained by health state. They likewise compare two treatment strategies, with tables for each of the risk groups, with comparators as in Tables 3 to 5.\n\n\n\nTable 6: Summary of QALY gain by health state (all risk, cabo+nivo vs next best non-dominated comparator: Pazopanib)\n\n\n\n\nTable 9\nTable 9 describes the costs and medical resource use for each risk population according to each 1L therapy received. It describes the:\n\nCosts and resource use for the 1L treatment\nCosts and resource use for the subsequent treatments\nCosts for end of life care\n\nCosts for the 1L and subsequent treatment and broken down into drug costs, administration costs and adverse event costs.\n\n\n\nTable 9: Summary of costs by health state\n\n\n\n\nTables 10 to 12\nTables 10 to 12 breakdown the costs and medical resource use, focusing on cabozantinib plus nivolumab against a reference treatment. It provides the costs and incremental costs.\nThere are tables for each risk group, with comparators as in Tables 3 to 5.\n\n\n\nTable 10 : Summary of predicted resource use by category of cost (all risk, cabo+nivo vs next best non-dominated comparator: Pazopanib)\n\n\n\n\nFigures 1 to 15\nMarkov traces are provided according to each of the 1L treatments in each risk population. These describe the proportion of patients simulated to be in each health state over time.\n\n\n\nFigure 1: Markov trace: All risk, Cabozantinib plus nivolumab. Abbreviations: L1, 1st line; L2, 2nd line; L3, 3rd line; L4, 4th line; L5, 5th line.\n\n\n\n\nFigures 16 to 18\nFigures 16 to 18 are the cost-effectiveness acceptability frontier (CEAF) for each of the risk populations. These are constructed by identifying the treatment with the lowest ICER, and then ruling out treatments that were less effective yet with a higher ICER (i.e. “dominated” treatments), and continuing until no treatments remain. What remains are the “non-dominated” treatments.\n\n\n\nFigure 16: Cost-effectiveness acceptability frontier – all risk\n\n\n\n\nTables 13 to 16\nThese tables would present the results of a scenario analysis if run but, in this example, only the base case was run. Hence, Tables 13 to 15 just have a single row with base case results, whilst Table 16 just presents base case results as in Table 1.\n\n\n\nTable 13: Scenario analysis - all risk\n\n\n\n\n\nTable 16: Scenario analysis pairwise comparison table",
    "crumbs": [
      "Code walkthrough",
      "Report"
    ]
  },
  {
    "objectID": "pages/report.html#viewing-the-report",
    "href": "pages/report.html#viewing-the-report",
    "title": "Report",
    "section": "Viewing the report",
    "text": "Viewing the report\nThe output report will be in .docx format, so this is best viewed within Microsoft Word. If viewed in LibreOffice, you may find the tables are misformatted (going outside the page margins so not visible). If viewed in Google Docs, you may find the figures are not visible/fail to correctly load.",
    "crumbs": [
      "Code walkthrough",
      "Report"
    ]
  },
  {
    "objectID": "pages/probabilistic.html",
    "href": "pages/probabilistic.html",
    "title": "Probabilistic analysis",
    "section": "",
    "text": "So far, this documentation has described Model_Structure.R, which is a deterministic analysis. However, a probabilistic sensitivity analysis (PSA) is run using probabilistic_model.R - and, as described in the NICE documentation related to this model [1] [2], the base case analysis for the technology appraisal was probabilistic (as recommended in the NICE manual [3]).",
    "crumbs": [
      "Probabilistic analysis"
    ]
  },
  {
    "objectID": "pages/probabilistic.html#what-is-the-difference-between-deterministic-and-probabilistic-analysis",
    "href": "pages/probabilistic.html#what-is-the-difference-between-deterministic-and-probabilistic-analysis",
    "title": "Probabilistic analysis",
    "section": "What is the difference between deterministic and probabilistic analysis?",
    "text": "What is the difference between deterministic and probabilistic analysis?\nIn a deterministic analysis, the model inputs are fixed values, with the output being the same given the same inputs.\nIn a probabilistic analysis, the model inputs are random values (repeatedly drawn from distributions). This incorporates uncertainty into the model, reflecting the variability and uncertainty in real-world scenarios.\nIn other words, as described in probabilistic_model.R:\n\n“The primary difference with the probabilistic model is that the survival analysis (along with several of the other input parameters) are drawn probabilistically repeatedly and those randomly drawn numbers are fed through the SAME functions that have been used in Model_structure.R to ensure consistency.\nThis is analogous to generating values in an excel model and passing it throughthe same calculation chain as the deterministic model via the patient flow sheet.”",
    "crumbs": [
      "Probabilistic analysis"
    ]
  },
  {
    "objectID": "pages/probabilistic.html#how-can-you-run-the-probabilistic-analysis",
    "href": "pages/probabilistic.html#how-can-you-run-the-probabilistic-analysis",
    "title": "Probabilistic analysis",
    "section": "How can you run the probabilistic analysis?",
    "text": "How can you run the probabilistic analysis?\nTo run the probabilistic analysis, use the file probabilistic_model.R.\nThis script uses 2_Scripts/standalone scripts/QC/p.rds and 2_Scripts/standalone scripts/QC/i.rds. These are each output by Model_Structure.R, just before it runs the economic model by calling f_pf_computePF().\nIt first replaces many of the values in p with probabilistic versions. The list p is generated repeatedly, with the same structure each time, but with random numbers used as inputs.\nThen, in a section titled “PSA trace process”, it runs through a similar process as in Model_Structure.R with similar functions - e.g.\n\nf_NMA_linkPHNMA()\nf_NMA_linkFPNMA()\nf_NMA_AddAssumptionsToNetwork()\nf_releff_PropNetwork()\nf_surv_twaning_apply()\nf_surv_gpopadjust()\nf_surv_PFSxOS(), f_surv_TTDxOS(), f_surv_PFSxTTP()\n\nThere are also some additional functions, such as f_psa_collapse_st_lambda2lplus(), which is used to help reduce the size of the st object. Alternative functions are then used for patient flow and analysis, such as:\n\nf_psa_pf_computePF_mkLambda()\nf_pf_mk_summary()\nf_psa_computeWAModelRes()\n\nPatient flow in calculated in the same way as in the deterministic analysis, just instead using lambda approximation to simplify the computation of the Markov trace, removing all tunnel states from the model and removing the need for sparse matrix multiplications.\nThere is then a follow-up script process PSA output.R which runs some analysis on the outputs of the probabilistic analysis.",
    "crumbs": [
      "Probabilistic analysis"
    ]
  },
  {
    "objectID": "pages/probabilistic.html#note-about-run-time",
    "href": "pages/probabilistic.html#note-about-run-time",
    "title": "Probabilistic analysis",
    "section": "Note about run time",
    "text": "Note about run time\nAs described in probabilistic_model.R, the probabilistic analysis is very computationally intensive. For example, to run the model for the “all risk” population for the 4 active treatment lines, computing only the Markov trace, it would take approximately 37.5 hours and require 24GB RAM running on 8 cores.\nThere are therefore three options for generating probabilistic results:\n\n“Use a supercomputer or high-performance computing cluster (HPC). This would reduce runtime to a few hours but requires outsourcing of the computations. There are many options available including commercial (Microsoft Azure, Amazon AWS), academic (Exeter university, Sheffield university, UEA, others) to satisfy this. This would produce the most accurate results and would ensure the use of identical code for determinstic and iterative analyses.”\nCalculate “approximate time in state using exponentional approximation for the current decision problem. In this specific case, there are no stopping rules or complicated cost dynamics in any 2L+ state. Consequently, the tunnels are not actually required in this specific simple case. We therefore define a non-tunnel trace calculator which operates with vastly reduced computation”.\nForego a probabilistic analysis - although preference is to avoid this option.\n\nThe provided script probabilistic_model.R implements option 2 and was run by the PenTAG team on the University of Exeter HPC.",
    "crumbs": [
      "Probabilistic analysis"
    ]
  },
  {
    "objectID": "pages/probabilistic.html#note-about-utility-values-in-probablistic-model",
    "href": "pages/probabilistic.html#note-about-utility-values-in-probablistic-model",
    "title": "Probabilistic analysis",
    "section": "Note about utility values in probablistic model",
    "text": "Note about utility values in probablistic model\nIt was not possible to adjust utilities values in the probablistic models, as the interactions between age and sex would need to be accounted for, but Ara and Brazier et al. 2011 [4] do not report the variance-covariance matrix that would have described how the variations correlate with each other. Varying age and sex separately could lead to spurious results or inference due to non-linear interactions between the parameters (some of which are transformed).",
    "crumbs": [
      "Probabilistic analysis"
    ]
  },
  {
    "objectID": "pages/model_overview.html",
    "href": "pages/model_overview.html",
    "title": "Detailed summary",
    "section": "",
    "text": "This repository contains code to support appraisal of the cost-effectiveness of treatments in advanced renal cell carcinoma. It is currently applied to an appraisal of cabozantinib and nivolumab. This application and an overview of the analysis and modelling steps performed are described below.",
    "crumbs": [
      "Model overview",
      "Detailed summary"
    ]
  },
  {
    "objectID": "pages/model_overview.html#background",
    "href": "pages/model_overview.html#background",
    "title": "Detailed summary",
    "section": "Background",
    "text": "Background\n\nRenal cell carnioma stages and risk groups\nRenal cell carcinoma (RCC) is a type of kidney cancer. It is the most common type, accounting for over 80% of cases. The treatment strategy depends on RCC’s location and stage. The stages of RCC can be defined as:\n\n\n\n\n\n\n\n\nStage 1 and 2\nStage 3\nStage 4\n\n\n\n\nCancer is only in the kidney\nCancer may have spread to nearby lymph nodes\nCancer has metastasised, meaning it has spread to other areas of the body; Also known as advanced RCC (aRCC)\n\n\n\nPeople with aRCC who have not yet received systemic treatments (therapies that target cancer cells throughout the body) are classified as either being favourable-risk RCC or intermediate- and poor-risk RCC. These categories are defined in the International Metastatic Renal Cell Carcinoma Database Consortium (IMDC) criteria. They are established based on time from diagnosis, the patient’s ability to perform daily tasks, and some laboratory measurements. In the UK, most RCC patients are classified as intermediate or poor risk. Risk status is associated with clinical outcomes (for example, mortality rates). It is used to help guide decisions on which treatments to use.\nFor more information, see section 2.2 “Epidemiology” and 2.3.1 “Risk Status” in the Assessment Report. [1]\n\n\nFocus of the appraisal\nThe analysis in this repository is related to the NICE appraisal TA964 [2] which assesses the clinical- and cost-effectiveness of cabozantinib with nivolumab as a first-line therapy for patients with aRCC.\nThis treatment is a combination of:\n\nCabozantinib - oral, 40mg daily\nNivolumab - intravenous, 240mg every 2 weeks or 480mg every 4 weeks\n\nIt is a first-line (1L) systemic therapy, meaning it is for previously untreated patients. They may then have up to 3 more treatments (referred to as second-line (2L), third-line (3L) and fourth-line (4L) therapies), or at any point, may instead transition to receiving best-supportive care (BSC).\nThe appraisal compares this treatment against other 1L treatments. When modelling this, it includes a simulation of the subsequent treatments that people might receive after each.\nFor more information, see section 3.2 “Interventions” and 3.3 “The RCC treatment pathway” in the Assessment Report. [1]",
    "crumbs": [
      "Model overview",
      "Detailed summary"
    ]
  },
  {
    "objectID": "pages/model_overview.html#summary-diagram",
    "href": "pages/model_overview.html#summary-diagram",
    "title": "Detailed summary",
    "section": "Summary diagram",
    "text": "Summary diagram\n\n\n\nOverview of analysis performed for this appraisal.",
    "crumbs": [
      "Model overview",
      "Detailed summary"
    ]
  },
  {
    "objectID": "pages/model_overview.html#stage-1.-estimating-the-relative-efficacy-of-each-treatment",
    "href": "pages/model_overview.html#stage-1.-estimating-the-relative-efficacy-of-each-treatment",
    "title": "Detailed summary",
    "section": "Stage 1. Estimating the relative efficacy of each treatment",
    "text": "Stage 1. Estimating the relative efficacy of each treatment\n\n\n\nExcerpt from overview diagram for Stage 1\n\n\n\nIdentification of randomised controlled trials\nA systematic review was conducted to identified randomised controlled trials (RCTs) of patients with aRCC who received any of the treatments under comparison - namely: cabozantinib plus nivolumab; pazopanib; tivozanib; sunitinib; cabozantinib; nivolumab plus ipilimumab; pembrolizumab and lenvatinib; axitinib; lenvatinib plus everolimus; everolimus; nivolumab; avelumab plus axitinib\nThe studies had to report at least one of the outcomes of interest:\n\nOverall survival (OS) - “time from randomisation to death” [3]\nProgression-free survival (PFS) - “time from randomisation until first evidence of disease progression or death” [3]\nTime to next treatment (TTNT) - “time from initiating treatment to initiating the next line of therapy” [3]\nTime on treatment - similar to TTNT, but excluding time off treatment between lines of therapy\nResponse rates (also known as objective response rate) - the proportion of people with partial response (decrease in tumour size) or complete response (disappearance of all signs of cancer) [4]\nDuration of response - “time from randomisation to disease progression or death in patients who achieve complete or partial response” [3]\nAdverse events (AEs) of treatment - “undesired effect” of treatment [4]\nHealth-related quality of life (HRQoL) - “the impact a medical condition and/or treatment has on a patient’s functioning and well-being” [5]\n\nThe review identified 24 RCTs to include (plus an additional 6, but these were ongoing). All 24 studies recorded OS, PFS, response rate and adverse events, whilst other outcomes were more sparsely recorded.\nFor more information, see section “3.1.1 Identification of systematic literature reviews and randomised controlled trials” and “Table 11 Outcomes reported by RCTs included in the review” in the Assessment Report [1] and section 1.8 “Literature review approach” in the Pathway Model Report. [6]\n\n\nNetwork meta-analysis\nThe identified trials do not all include the same treatments, with each comparing different therapies head-to-head. To illustrate this, below are 1L network diagrams for PFS and OS, as based on Figures 16 and 17 in the Assessment Report. [1] These show which treatments were directly compared head-to-head: each circle represents a treatment, and each line represents a clinical trial.\n\n\n\n1L network diagrams for PFS and OS, as adapted from the Assessment Report. Abbreviations: ave, avelumab; axi, axitinib; cabo, cabozantinib; ipi, ipilimumab; lenv, lenvatinib; nivo, nivolumab; pazo, pazopanib; pem, pembrolizumab; sora, sorafenib; suni, sunitinib; tivo, tivozanib.\n\n\nFor our economic model, we need to understand the clinical effectiveness of each treatment for each outcome, relative to the other treatments. This is measured using hazard ratios (HR), which are “a measure of how often a particular event happens in one group compared to how often it happens in another group, over time”. [4]\nIn order to estimate the comparative effectiveness of interventions that may not have been compared head-to-head in a randomised trial, network meta-analyses (NMA) were performed. Two types of NMA were used:\n\nProportional hazards NMA (PH NMA) which returns a single hazard ratio for each comparison, as it “assumes the relative effects of each treatment… remain constant over time”\nFractional polynomial NMA (FP NMA) which returns a list of time-varying hazard ratios for each comparison, as it “allows the relative effects to change over time” [6]\n\nFor each RCT, requests were made to the company that owned each trial’s data, asking for grouped survival data (in time intervals of 1 or 4 weeks), for used in the NMAs. If this was not received, then the published curves were digitised to estimate the grouped survival data.\nNMA were performed for:\n\nOS and PFS in the all-risk group, favourable-risk and intermediate- and poor-risk subgroups\nSafety for the all-risk group\n\nPH NMA and FP NMA were both conducted, but the chosen models used were:\n\nFP NMA for 1L efficacy - as the “flexible time-varying hazard ratios… provided a better, more plausible fit to observed short-term data” [6] and as the proportional hazards was violated for some 1L treatments. However, PH NMA was used for pembrolizumab plus lenvatinib, as FP NMA produced implausible results.\nPH NMA was used for 2L and 3L efficacy due to the “sparsity of the available network and extreme results within the fitted models” [1]\n4L efficacy was based on 3L outcomes, applying the hazard ratio for the difference between pooled 3L and 4L outcomes\n\nFor more information, see section 1.16 “Relative effectiveness” in the Pathway Model Report [6] and 4.3.5.2 “Calculation of relative treatment effectiveness” in the Assessment Report. [1]",
    "crumbs": [
      "Model overview",
      "Detailed summary"
    ]
  },
  {
    "objectID": "pages/model_overview.html#stage-2.-extrapolating-survival-curves-from-real-world-evidence",
    "href": "pages/model_overview.html#stage-2.-extrapolating-survival-curves-from-real-world-evidence",
    "title": "Detailed summary",
    "section": "Stage 2. Extrapolating survival curves from real-world evidence",
    "text": "Stage 2. Extrapolating survival curves from real-world evidence\n\n\n\nExcerpt from overview diagram for Stage 2\n\n\n\nIdentification of RWE\nA targeted search was conducted to identify RWE (i.e. observational studies describing outcomes in practice, outside of a trial setting). The search was for studies that included patients with aRCC and described at least one of:\n\nTreatment pathways\nNatural history of disease\nPatient characteristics\n\nOf the 12 real-world datasets identified, only one was considered to be robust and relevant to the UK. This was Challapalli et al. 2022. [7] The owners of this dataset provided access to patient-level data.\nFor more information, see section 1.12 “Real-world evidence” in the Pathway Model Report [6] and 3.1.2 “Identification of real-world evidence” in the Assessment Report. [1]\n\n\nExtrapolation of RWE\nThe OS, PFS, time to discontinuation (TTD), time to progression (TTP) and post-progression survival (PPS) survival curves from Challapalli et al. 2022 [7] were extrapolated so that they covered the time horizon of the economic model, which was 40 years. Extrapolation was conducted using survival analysis (with a partitioned survival model).\nFor more information, see section 4.3.5.1 “Extrapolation of survival curves” in the Assessment Report [1] and section 1.13 “Baseline risk” in the Pathway Model Report. [6]",
    "crumbs": [
      "Model overview",
      "Detailed summary"
    ]
  },
  {
    "objectID": "pages/model_overview.html#stage-3.-applying-nma-hazard-ratios-to-rwe-reference-curves",
    "href": "pages/model_overview.html#stage-3.-applying-nma-hazard-ratios-to-rwe-reference-curves",
    "title": "Detailed summary",
    "section": "Stage 3. Applying NMA hazard ratios to RWE reference curves",
    "text": "Stage 3. Applying NMA hazard ratios to RWE reference curves\n\n\n\nExcerpt from overview diagram for Stage 3 and 4\n\n\n\nReference curves\nFor 1L, the reference treatment used was sunitinib as it:\n\nIt is used in UK practice for all risk groups\nIt was the most common 1L treatment in the RWE\nWas the comparator for the most of the RCTs (see the network diagram above)\n\nFor 2L and 3L, the reference treatment used was cabozantinib as:\n\nIt was the most common 2L and 3L treatment in the RWE\n“Data were mature compared to other treatments” [1]\n\nThe reference treatment was based on RWE as per recommendations from the NICE manual and other recent appraisals.\nFor more information, see section 4.3.5 “Treatment effectiveness and extrapolation” in the Assessment Report [1] and sections 1.13 “Baseline risk” and 1.14 “Appropriateness” in the Pathway Model Report. [6]\n\n\nApplying the hazard ratios to the reference curves\nThe effectiveness of 1L sunitinib and 2L cabozantinib is provided by the RWE reference curves. For all other treatments, the effectiveness is calculated by applying the NMA HRs to the reference curves.\nThe source of the HRs for each treatment, line and outcome were as follows:\n\nPFS and OS from the NMA - FP NMA for 1L (with exception of pembrolizumab plus lenvatinib) and PH NMA for 2L and 3L\nAssume 1L pazopanib and tivozanib effectiveness are the same as sunitinib (as not available in NMA)\nAssume 2L/3L sunitinib and pazopanib effectiveness are the same as tizovanib (as not available in NMA)\nAssume 1L TTD and TTP are the same as PFS\nAssume 2L/3L TTP is the same as PFS, but for TTD apply a hazard ratio to the PFS, as calculated from the 1L treatments\nCalculate 4L outcomes by applying hazard ratio on 3L outcomes\n\nIn the code, the nested list containing the HRs and survival times for each treatment is referred to as a relative efficacy network, and when the hazard ratios are applied to the reference curve, this was described as propagating the network.\nFor more information, see section 4.3.5.2 “Calculation of relative treatment effectiveness” in the Assessment Report [1] and section 1.16 “Relative effectiveness” in the Pathway Model Report. [6]",
    "crumbs": [
      "Model overview",
      "Detailed summary"
    ]
  },
  {
    "objectID": "pages/model_overview.html#stage-4.-modifications-to-the-extrapolations",
    "href": "pages/model_overview.html#stage-4.-modifications-to-the-extrapolations",
    "title": "Detailed summary",
    "section": "Stage 4. Modifications to the extrapolations",
    "text": "Stage 4. Modifications to the extrapolations\n\nTreatment effect waning\nTreatment effect waning is when the hazard/survival for a treatment converges to the hazard/survival of the comparator. This was implemented at 5 years for 1L combination therapies that included an immuno-oncology (IO) treatment and tyrosine kinase inhibitor (TKI) (for example, axitinib and avelumab). It was set at 5 years as that is when people stop having that therapy in clinical practice.\nFor more information, see section 1.22 “Treatment effect waning” in the Pathway Model Report [6] and 4.3.5.3 “Treatment effectiveness waning” in the Assessment Report. [1]\n\n\nGeneral population mortality\nIf aRCC patients were projected to live longer than the general population, this was corrected (hence, ensuring the aRCC OS never exceeds the general population). General population mortality was based on an age and sex matched-profile (against the 1L all risk population) using data from the Office for National Statistics (ONS).\nFor more information, see section 4.3.5.4 “Accounting for general population mortality” in the Assessment Report. [1]\n\n\nOverlapping curves\nA known limitation of partitioned survival analysis (which was used to extrapolate the RWE) is that it can produce curves where PFS lies above OS (which is impossible in real-life). Hence, in cases where this occurs, it was adjusted so that PFS &lt;= OS (and also, PFS &lt;= TTP).\nFor more information, see section 4.3.5.5 “Adjustment for curves crossing” in the Assessment Report. [1]",
    "crumbs": [
      "Model overview",
      "Detailed summary"
    ]
  },
  {
    "objectID": "pages/model_overview.html#stage-5.-preparation-of-other-data-for-the-economic-models",
    "href": "pages/model_overview.html#stage-5.-preparation-of-other-data-for-the-economic-models",
    "title": "Detailed summary",
    "section": "Stage 5. Preparation of other data for the economic models",
    "text": "Stage 5. Preparation of other data for the economic models\n\n\n\nExcerpt from overview diagram for Stage 5, 6 and 7\n\n\n\nAdverse events\nAs for the effectiveness outcomes from the NMA, the hazard ratios for grade 3+ adverse events calculated in the NMA were applied to reference curves. For all grade adverse events, hazard ratios from an NMA in a cochrane review were used. The reference curves (i.e. the baseline adverse event risk in the model) were:\n\n1L - sunitib from Checkmate 9ER RCT\n2L and 3L - everolimus from CheckMate 025 RCT\n\nThis is with the exception of cabozantinib plus nivolumab, whose rates were based directly on Checkmate 9ER RCT data.\nFor more information, see section 1.24 “Adverse events” in the Pathway Model Report [6] and 4.3.6 “Adverse events” in the Assessment Report. [1]\n\n\nUtility values\nFor each line of treatment, there was a:\n\nUtility value for patients who were progression free\nUtility value for patients with progressed disease\nUtility value for BSC\n\nThe values were sourced from prior NICE technology appraisals - TA645 for 1L and then adjustment to that based on TA498 for 2L to 4L. These were identified through a systematic search for published cost-effectiveness studies.\nUtility values were adjusted for age and sex using Ara and Brazier et al. 2010 [8] / 2011 [9] and the Health Survey England (HSE) 2014 dataset.\nFor more information, see sections 1.25 “Health-related quality of life” and 1.26 “Source of utility values” in the Pathway Model Report [6] and sections 4.1 “Published cost-effectiveness studies” and 4.3.7 “Utility values” in the Assessment Report. [1]\n\n\nResource use and costs\nSimilar to the utility values, resource use was based on prior NICE technology appraisals, whilst costs were based on NHS reference costs and costs from the Personal Social Services Research Unit. These include estimates of resource use and costs for:\n\nDisease management/health state (i.e. consultant and specialist nurse visits, CT scans, blood tests, pain medication)\nEnd of life (i.e. GP appointments, district nursing care, social care, hospital care)\nDrug and administration (i.e. costs of each drug)\nAdverse events (e.g. Grade 1/2 events like diarrehoea or fatigue, and Grade 3+ events like anaemia, hypertension and nausea)\nSubsequent treatment (i.e. radiotherapy, surgery)\n\nFor more information, see section 4.3.8 “Resource use and costs” in the Assessment Report [1] and sections 1.27 “Resource use” and 1.28 “Relative dose intensity” in the Pathway Model Report. [6]\n\n\nTreatment sequences\nA list of possible treatment sequences was defined based on rules which were established based on clinical advice and routine commissioning rules. These rules are listed in section 4.3.5.6 “Calculation of final outcomes by first line treatment” in the Assessment Report. [1] Some examples include:\n\nNivolumab plus ipilimumab 1L is only available to intermediate/poor risk patients\nSome therapies can’t be used if an immuno-oncology treatment was used in the past year\nLenvatinib plus everolimus can only be used after a prior anti-vascular endothelial growth factor (anti-VEGF) treatment\n\n\n\nProportion of people receiving each treatment in practice\nThe proportion of people receiving each treatment in the model is based on the observed practices in the RWE.\nFor more information, see section 4.3.1.8 “EAG model structure” in the Assessment Report [1] and section 1.23 “Sequencing subsequent treatments” in the Pathway Model Report. [6]",
    "crumbs": [
      "Model overview",
      "Detailed summary"
    ]
  },
  {
    "objectID": "pages/model_overview.html#stage-6.-economic-models",
    "href": "pages/model_overview.html#stage-6.-economic-models",
    "title": "Detailed summary",
    "section": "Stage 6. Economic models",
    "text": "Stage 6. Economic models\n\nModel diagram\nThe economic model is designed to model up to four lines of treatment before best supportive care. A diagram of the model is provided below. There are ten possible health states:\n\nFirst line (1L) off or on treatment\nSecond line (2L) off or on treatment\nThird line (3L) off or on treatment\nFourth line (4L) off or on treatment\nBest supportive case (BSC)\nDeath\n\nTransition between lines of treatment can be defined by either progression-free survival (PFS) or time to next treatment (TTNT).\n\n\n\n\nStructure of the model and transition between health states\n\n\nFor more information, see section 4.3.1.8 “EAG model structure” in the Assessment Report [1] and 1.6 “Economic model structure” in the Pathway Model Report. [6]\n\n\nMethodology\nTwo modelling approaches were explored, with the creation of:\n\nA state transition model (i.e. a Markov model)\nA partitioned survival model (i.e. partitioned surival analysis)\n\nThe models aimed to estimate the costs and benefits of cabolizumab plus nivolumab, compared against other 1L treatments, whilst also incorporating information on the subsequent treatment pathways. People in the models started on 1L treatment. The models ran with weekly cycles over a 40 year time horizon. Costs and outcomes were discounted at a rate of 3.5% per year.\nThe committee preferred the state transition model as it allowed multiple treatment lines to be modelled in as much detail as possible (with a state transition model being more flexible and able to explore more uncertainties and alternative assumptions).\nFor more information, see section 1.6 “Economic model structure” in the Pathway Model Report [6] and 4.3 “EAG economic analysis” in the Assessment Report. [1]",
    "crumbs": [
      "Model overview",
      "Detailed summary"
    ]
  },
  {
    "objectID": "pages/model_overview.html#stage-7.-processing-model-results",
    "href": "pages/model_overview.html#stage-7.-processing-model-results",
    "title": "Detailed summary",
    "section": "Stage 7. Processing model results",
    "text": "Stage 7. Processing model results\nThe models simulate how a cohort of patients would transition between health states over the time horizon, depending on which treatments they received. It returns the proportion of patients over time in each health state. We then apply:\n\nCosts\nUtilities, with quality-adjusted life years (QALYs) calculated from multiplying the years in a health state by the utility score\n\nAn incremental cost-effectiveness ratio (ICER) can be calculated from the difference in costs divided by the difference in QALYs, and these can be compared between treatments.\n\nSeverity modifier\nA greater weight can be given to QALYs if the treatment is for a condition with a high degree of severity, and this is referred to as a severity modifier. It was implemented for the state transition model, meaning that the results included absolute and proportional shortfall estimates of QALYs. Three methods were explored for calculating the severity modifier.\nFor more information, see section 1.29 “Severity” in the Pathway Model Report [6] and 4.3.9 “Severity” in the Assessment Report. [1]",
    "crumbs": [
      "Model overview",
      "Detailed summary"
    ]
  },
  {
    "objectID": "pages/citation.html",
    "href": "pages/citation.html",
    "title": "Citation",
    "section": "",
    "text": "If you re-use this model please appropriately credit PenTAG for the work and refer to it as the Exeter Oncology Model: RCC edition. You can use the following citation:\n\nLee D., Muthukumar M., Lovell A., Farmer C., Burns D., Matthews J., Coelho H., O’Toole B., Trigg L., Snowsill T., Barnish M., Nikoglou T., Brand A., Ahmad Z., Abdelsabour A., Robinson S., Wilson E., Melendez-Torres G. Exeter Oncology Model: RCC edition URL: https://github.com/nice-digital/NICE-model-repo",
    "crumbs": [
      "Citation"
    ]
  },
  {
    "objectID": "pages/citation.html#how-to-cite-this-model",
    "href": "pages/citation.html#how-to-cite-this-model",
    "title": "Citation",
    "section": "",
    "text": "If you re-use this model please appropriately credit PenTAG for the work and refer to it as the Exeter Oncology Model: RCC edition. You can use the following citation:\n\nLee D., Muthukumar M., Lovell A., Farmer C., Burns D., Matthews J., Coelho H., O’Toole B., Trigg L., Snowsill T., Barnish M., Nikoglou T., Brand A., Ahmad Z., Abdelsabour A., Robinson S., Wilson E., Melendez-Torres G. Exeter Oncology Model: RCC edition URL: https://github.com/nice-digital/NICE-model-repo",
    "crumbs": [
      "Citation"
    ]
  },
  {
    "objectID": "pages/citation.html#acknowledgements",
    "href": "pages/citation.html#acknowledgements",
    "title": "Citation",
    "section": "Acknowledgements",
    "text": "Acknowledgements\n\nThis modified repository was developed by Amy Heather . Changes from the original repository can be viewed in the changelog.\nThese modifications were made to improve the clarity and open science credentials of the EOM:RCC model, as part of the project STARS.",
    "crumbs": [
      "Citation"
    ]
  },
  {
    "objectID": "pages/acronyms.html",
    "href": "pages/acronyms.html",
    "title": "Acryonyms",
    "section": "",
    "text": "Acronym\nMeaning\n\n\n\n\n1L\nFirst line\n\n\n2L\nSecond line\n\n\n3L\nThird line\n\n\n4L\nFourth line\n\n\nAbs\nAbsolute\n\n\nACIC\nAcademic and commercial in confidence\n\n\nADaM\nAnalysis Data Model\n\n\nAE\nAdverse event\n\n\nASCO\nAmerican Society Of Clinical Oncology\n\n\naRCC\nAdvanced renal cell carcinoma\n\n\nAUC\nArea under the curve\n\n\nBSC\nBest supportive care\n\n\ncabo\ncabozantinib\n\n\nCIC\nCommercial in confidence\n\n\nCDF\nCancer Drugs Fund\n\n\nCE\nCost effectiveness\n\n\nCEA\nCost effectiveness analysis\n\n\nCODA\nConvergence diagnosis and output analysis\n\n\ncPAS\nConfident patient access scheme\n\n\nDSU\nDecision support unit\n\n\nEAG\nExternal assessment group\n\n\nEOL\nEnd of life\n\n\nEOM-RCC\nExeter Oncology Model: Renal Cell Carcinoma edition\n\n\nERG\nEvidence Review Group\n\n\nevero\nEverolimus\n\n\nFAD\nFinal appraisal document\n\n\nfav\nFavourable\n\n\nFP\nFractional polynomial\n\n\nFP NMA\nFractional polynomial network meta-analysis\n\n\nGen\ngeneral\n\n\nHFS\nHand-foot syndrome\n\n\nHPC\nHigh-performance computing\n\n\nHR\nHazard ratio\n\n\nHRQL\nHealth-related quality of life\n\n\nHTA\nHealth technology assessment\n\n\nICER\nIncremental Cost-Effectiveness Ratio\n\n\nint\nIntermediate\n\n\nIMDC\nInternational Metastatic Renal Cell Carcinoma Database Consortium\n\n\nIO\nImmuno-oncology\n\n\nIPD\nIndividual patient data\n\n\nipi\nIpilimumab\n\n\nIV\nIntravenous\n\n\nKM\nKaplan-Meier\n\n\nlenv\nLenvatinib\n\n\nLY\nLife year(s)\n\n\nLYG\nLife year(s) gained\n\n\nMRC\nMedical Research Council\n\n\nMRU\nMedical Resource Use\n\n\nMTA\nMultiple technology appraisal\n\n\nNHS\nNational Health Service\n\n\nNHSE\nNational Health ServiceEngland\n\n\nNICE\nNational Institute for Health and Care Excellence\n\n\nNIHR\nNational Institute for Health and Care Research\n\n\nnivo\nNivolumab\n\n\nNMA\nNetwork meta-analysis\n\n\nONS\nOffice for National Statistics\n\n\nOS\nOverall survival\n\n\nPartSA\nPartitioned-survival analysis\n\n\nPAS\nPatient access scheme\n\n\nPATT\nProportionate approach to technology appraisals\n\n\npazo\npazopanib\n\n\nPD\nProgressed disease\n\n\npem\nPembrolizumab\n\n\nPenTAG\nPeninsula Technology Assessment Group\n\n\nPFS\nProgression-free survival\n\n\nPH\nProportional hazards\n\n\nPH NMA\nProportional hazards network meta-analysis\n\n\nPLD\nPatient-level data\n\n\nPLMT\nPopulation + Line + Molecule + Trial\n\n\nPLMTE\nPopulation + Line + Molecule + Trial + Endpoint\n\n\npop\nPopulation\n\n\nPPS\nPost-progression survival\n\n\nprop\nProportional\n\n\nPSA\nProbablistic sensitivity analysis\n\n\nPSM\nProgressed state membership\n\n\nQALY\nQuality-adjusted life year(s)\n\n\nQC\nQuality check\n\n\nRCC\nRenal cell carcinoma\n\n\nRDI\nRelative dosing intensity\n\n\nRE\nRelative efficacy\n\n\nROC\nRenal Oncology Collaborative\n\n\nRWE\nReal-world evidence\n\n\nSF\nShortfall\n\n\nSOC\nStandard of care\n\n\nst\nSurvival at time t\n\n\nSTA\nSingle technology appraisal\n\n\nsuni\nSunitinib\n\n\nTA\nTechnology appraisal\n\n\ntivo\nTivozanib\n\n\nTKI\nTyrosine Kinase Inhibitor\n\n\nTP matrices\nTreatment pathway matrices\n\n\nTSD\nTechnical Support Document\n\n\nTTD\nTime to discontinuation\n\n\nTOT\nTime on treatment\n\n\nTTNT\nTime to next treatment\n\n\nTTP\nTime to progression\n\n\nTuotA\nTime unit of the analysis\n\n\nUK\nUnited Kingdom\n\n\nVEGF\nVascular endothelial growth factor\n\n\nvs\nVersus\n\n\nWTP\nWillingness to pay",
    "crumbs": [
      "Acryonyms"
    ]
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exeter Oncology Model: Renal Cell Carcinoma edition",
    "section": "",
    "text": "This website was created by Amy Heather . It shares model documentation to support understanding of how the model works, and how you can use it. Please use the sidebar to navigate through the site pages.\nThe Exeter Oncology Model: Renal Cell Carcinoma edition (EOM-RCC) is a platform cost-effectiveness model encompassing each decision node in the disease area for advanced renal cell carcinoma. It has been constructed as part of the National Institute for Health and Care Excellence (NICE) Pathways Pilot appraisal (ID6186, GID-TA11186) [1] and the appraisal of cabozantinib plus nivolumab (TA964) [2] (formerly ID6184, whilst in development). The development of this model is described in Lee et al. 2024. [3]\nIf you are interested in discussing or funding further development of this model, please contact the PenTAG team at pentag@exeter.ac.uk.",
    "crumbs": [
      "Home"
    ]
  },
  {
    "objectID": "index.html#model-documentation",
    "href": "index.html#model-documentation",
    "title": "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exeter Oncology Model: Renal Cell Carcinoma edition",
    "section": "",
    "text": "This website was created by Amy Heather . It shares model documentation to support understanding of how the model works, and how you can use it. Please use the sidebar to navigate through the site pages.\nThe Exeter Oncology Model: Renal Cell Carcinoma edition (EOM-RCC) is a platform cost-effectiveness model encompassing each decision node in the disease area for advanced renal cell carcinoma. It has been constructed as part of the National Institute for Health and Care Excellence (NICE) Pathways Pilot appraisal (ID6186, GID-TA11186) [1] and the appraisal of cabozantinib plus nivolumab (TA964) [2] (formerly ID6184, whilst in development). The development of this model is described in Lee et al. 2024. [3]\nIf you are interested in discussing or funding further development of this model, please contact the PenTAG team at pentag@exeter.ac.uk.",
    "crumbs": [
      "Home"
    ]
  },
  {
    "objectID": "index.html#additional-links",
    "href": "index.html#additional-links",
    "title": "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exeter Oncology Model: Renal Cell Carcinoma edition",
    "section": "Additional links",
    "text": "Additional links\nOther resources related to this model include:\n\nWeb application: The ambition for EOM:RCC is to create a shiny interface that allows users to interact and run the full economic model from a web application. A pilot example web app has been created which allows users to run one part of the analysis: creating a table of possible treatment sequences.\nGitHub repository: All code for the model, documentation and app are contained in this repository. The README.md file (which is displayed when you open the repository on GitHub) provides key information about the model and repository.",
    "crumbs": [
      "Home"
    ]
  },
  {
    "objectID": "pages/appraisals.html",
    "href": "pages/appraisals.html",
    "title": "NICE appraisals",
    "section": "",
    "text": "This model was developed by the Peninsula Technology Assessment Group (PenTAG) at the University of Exeter. This was in collaboration with the National Institute for Health and Care Excellence (NICE) as part of two appraisals, described below.",
    "crumbs": [
      "Context",
      "NICE appraisals"
    ]
  },
  {
    "objectID": "pages/appraisals.html#renal-cell-carcinoma-pathways-pilot-id6186-gid-ta11186",
    "href": "pages/appraisals.html#renal-cell-carcinoma-pathways-pilot-id6186-gid-ta11186",
    "title": "NICE appraisals",
    "section": "Renal cell carcinoma Pathways Pilot (ID6186, GID-TA11186)",
    "text": "Renal cell carcinoma Pathways Pilot (ID6186, GID-TA11186)\nIn 2022, NICE announced a programme aimed at taking a “proportionate approach to technology appraisals” (PATT). In the first phase of the programme, they “simplified, removed, or reconfigured parts of the appraisals process”. This was to enable the production of rapid guidance for simpler low-risk decisions by allowing “light-touch, faster evaluations” for those topics. In the second phase of the programme, they have been exploring several other ways of working, one of which being to take a “pathways approach to technology appraisals.” [1]\nThe pathways approach involves the production of a reusable platform/reference model for each disease area. The rationale for this that many NICE appraisals are in only a few disease areas, with almost half of health technology assessments within ten disease areas. Hence, developing a single reference model for each disease area should help “reduce repetition and improve consistency in decision making”. [2]\nIn their analysis plan, Lee et al. 2023 [3] emphasise the importance of these models being open-source so they can be reused and maintained without restriction. They give the example of the Innovation and Value Initiative (IVI) Open-Source Value project which started in 2018 and has since produced three disease models which are freely shared on their GitHub. [3] Each of these models are developed in R, with the first two being R packages with hosted documentation and supporting web applications (created with a commercial organisation, https://clarityviz.com/):\n\nNon-small cell lung cancer - GitHub, documentation, basic web app, advanced web app (note: these web apps are not working currently)\nRheumatoid arthritis - GitHub, documentation, model interface (advanced app), value tool (basic app)\nMajor depressive disorder - GitHub\n\nThe NICE pilot of the pathways approach was in renal cell carcinoma (ID6186, GID-TA11186). [4] This pilot was the Exeter Oncology Model: Renal Cell Carcinoma edition (EOM:RCC), as described and presented in this repository. In 2024, Lee et al. published an article describing their experience of developing this model (see publication page). [2] A final report from NICE on the pilot will be released in 2024/25. [1]",
    "crumbs": [
      "Context",
      "NICE appraisals"
    ]
  },
  {
    "objectID": "pages/appraisals.html#cabozantinib-with-nivolumab-for-untreated-advanced-renal-cell-carcinoma-ta964-formerly-id6184",
    "href": "pages/appraisals.html#cabozantinib-with-nivolumab-for-untreated-advanced-renal-cell-carcinoma-ta964-formerly-id6184",
    "title": "NICE appraisals",
    "section": "Cabozantinib with nivolumab for untreated advanced renal cell carcinoma (TA964, formerly ID6184)",
    "text": "Cabozantinib with nivolumab for untreated advanced renal cell carcinoma (TA964, formerly ID6184)\nThe technology appraisal guidance for cabozantinib with nivolumab for untreated advanced renal cell carcinoma was published on 10 April 2024. When developing this guidance, the evaluation comittee considered:\n\nEvidence submitted by Ipsen\nA revise of Ipsen’s submission by the external assessment group (EAG)\nThe EAG’s economic model (EOM:RCC)\nResponses from stakeholders\n\nThe main source of evidence for clinical effectiveness was the results of “CheckMate 9ER, a single-blind randomised controlled trial comparing cabozantinib plus nivolumab with sunitinib”. The economic model was the EOM:RCC, and the preferred assumptions for this model from the committee and from the company are outlined in the appraisal guidance. [5] The model itself is then further described in a pathway model report. [6]",
    "crumbs": [
      "Context",
      "NICE appraisals"
    ]
  },
  {
    "objectID": "pages/installation.html",
    "href": "pages/installation.html",
    "title": "Installation",
    "section": "",
    "text": "To install and run this model, you will need to have the following on your machine:",
    "crumbs": [
      "Installation"
    ]
  },
  {
    "objectID": "pages/installation.html#installing-the-model",
    "href": "pages/installation.html#installing-the-model",
    "title": "Installation",
    "section": "Installing the model",
    "text": "Installing the model\nThere are a few options for installing this model.\n\nAccessing the code via Git (version control)\nTo access the model using Git the easiest method is to create a new project in RStudio which links to the NICE github website. Simply click New Project in the right hand of your RStudio screen:\n\nThen select Version Control:\n\nThen choose Git:\n\nPaste in the URL of the NICE repository (https://github.com/nice-digital/NICE-model-repo) in the repository URL and decide where you want the project to be saved on your computer using the Browse functionality. All of your team can access the code then in the same way.\nIf there is more than one branch of code available as the model is updated you can select what branch of the code to look at on the top right of your screen.\n\n\n\nAccessing the code by downloading the model\nIf you do not wish to access the model via Git you can instead download the code and run the model on your local machine either using RStudio or R.\nTo do this click the Code button and then Download ZIP:\n\nExtract the zip file to wherever on your machine you want to store the model. We would suggest saving it somewhere other than the Downloads/ folder. Open RStudio and press File then New Project:\n\nClick Existing Directory:\n\nClick on the folder where you have saved the model. Make sure you click fully through until you can see the sub folders. Then press Open and then Create Project.",
    "crumbs": [
      "Installation"
    ]
  },
  {
    "objectID": "pages/installation.html#installing-the-model-dependencies",
    "href": "pages/installation.html#installing-the-model-dependencies",
    "title": "Installation",
    "section": "Installing the model dependencies",
    "text": "Installing the model dependencies\nYou’ll also need to install the model dependencies. Your options for this include:\n\nInstalling into current environment\nIn Model_Structure.R, lines 6 to 28 contain instructions for installing the relevant packages. You can use ctrl+shift+c to uncomment these lines and ctrl+enter to run a line or a group of highlighted lines. You only need to do this once and then should recomment the lines using ctrl+shift+c.\nThis will install the packages into your current environment. If you want to create an isolated environment to install these packages into, then you can set up an R environment with renv by running:\ninstall.packages(\"renv\")\nrenv::init()\nInstall your packages as above, and then keep a record of what you installed by running:\nrenv::snapshot()\n\n\nRestoring provided renv\nWe have created an R environment with all the required packages and the versions we used. You can see the version of R this was set up with in the renv.lock file. To install the dependencies by copying this environment, run the following commands in your R console:\ninstall.packages(\"renv\")\nrenv::restore()",
    "crumbs": [
      "Installation"
    ]
  },
  {
    "objectID": "pages/plain_english.html",
    "href": "pages/plain_english.html",
    "title": "Plain english summary",
    "section": "",
    "text": "The analysis in this repository forms part of a technology appraisal by the National Institute for Health and Care Excellence. The purpose of an appraisal is to help inform whether the NHS should fund a new treatment. This is based on the cost-effectiveness of a treatment, as determined by comparing the health outcomes and costs resulting from this treatment, compared with other available treatments.\nThis appraisal evaluates a combination of two treatments: cabozantinib with nivolumab. It assesses whether these are cost-effective as a first-line treatment (i.e. the first treatment given for a disease, in otherwise untreated patients).\nIt is being evaluated in patients with renal cell carcinoma (RCC) which is a type of kidney cancer. Specifically, it focuses on patients with advanced RCC, which means the cancer has spread from their kidney to other areas of their body.",
    "crumbs": [
      "Model overview",
      "Plain english summary"
    ]
  },
  {
    "objectID": "pages/plain_english.html#what-does-the-analysis-do",
    "href": "pages/plain_english.html#what-does-the-analysis-do",
    "title": "Plain english summary",
    "section": "What does the analysis do?",
    "text": "What does the analysis do?\nThis diagram provides a broad summary of the steps required to perform this cost-effectiveness analysis. These are described in further detail below.\n\n\n\nBasic overview of the analysis",
    "crumbs": [
      "Model overview",
      "Plain english summary"
    ]
  },
  {
    "objectID": "pages/plain_english.html#compare-effectiveness-of-different-treatments",
    "href": "pages/plain_english.html#compare-effectiveness-of-different-treatments",
    "title": "Plain english summary",
    "section": "(1) Compare effectiveness of different treatments",
    "text": "(1) Compare effectiveness of different treatments\nClinical studies that compared different treatments for advanced RCC were identified. These studies measured outcomes like how long people survived, whether their cancer progressed, and how well their cancer responded to the treatments. The studies also looked at side effects and how the treatments impacted patients’ quality of life.\nSome treatments were not directly compared in head-to-head trials. For example, cabozantinib and pazopanib were both compared to another drug, sunitinib, in separate studies, but not directly against each other (A).\nIn these cases, a method called “network meta-analysis” can be used to estimate how two treatments might have compared to one another, if they had been included head-to-head in a trial in real life. For example, estimating the effectiveness of cabozantinib versus pazopanib, based on what is known from their seperate comparisons with sunitinib (B).\n\n\n\nNetwork meta-analysis example",
    "crumbs": [
      "Model overview",
      "Plain english summary"
    ]
  },
  {
    "objectID": "pages/plain_english.html#get-patient-outcomes-over-time-for-reference-treatment",
    "href": "pages/plain_english.html#get-patient-outcomes-over-time-for-reference-treatment",
    "title": "Plain english summary",
    "section": "(2) Get patient outcomes over time for reference treatment",
    "text": "(2) Get patient outcomes over time for reference treatment\nStudies were also found that looked at how advanced kidney cancer patients responded to treatments in the real world, outside of clinical trials. These studies provided data on things like how long patients survived and whether their cancer got worse.\nFor each stage of treatment (first-line, second-line, etc.), a “reference treatment” was chosen. This was the treatment most commonly used in practice. The outcomes for patients receiving those reference treatments were then taken from real-world data.\nHowever, because the analysis needed to predict outcomes over a long period (40 years), and the real-world data didn’t cover that entire time, a technique called “survival analysis” was used. This method estimates long-term outcomes based on the patterns observed over the shorter period covered by the data.\n\n\n\n\n\n\n\nIllustrative figure showing the proportion of patients who survived over time",
    "crumbs": [
      "Model overview",
      "Plain english summary"
    ]
  },
  {
    "objectID": "pages/plain_english.html#estimate-outcomes-over-time-for-each-treatment",
    "href": "pages/plain_english.html#estimate-outcomes-over-time-for-each-treatment",
    "title": "Plain english summary",
    "section": "(3) Estimate outcomes over time for each treatment",
    "text": "(3) Estimate outcomes over time for each treatment\nUsing the results from step (1), the real-world data can be adjusted to estimate how people might do on other treatments. This means we have predicted outcomes over time for each treatment, based on the comparison of effectiveness against the reference treatment.",
    "crumbs": [
      "Model overview",
      "Plain english summary"
    ]
  },
  {
    "objectID": "pages/plain_english.html#find-how-many-people-receive-each-treatment",
    "href": "pages/plain_english.html#find-how-many-people-receive-each-treatment",
    "title": "Plain english summary",
    "section": "(4) Find how many people receive each treatment",
    "text": "(4) Find how many people receive each treatment\nFrom the real-world data identified in step (2), we can also find the proportion of people that we expect to receive each treatment in practice.",
    "crumbs": [
      "Model overview",
      "Plain english summary"
    ]
  },
  {
    "objectID": "pages/plain_english.html#get-data-on-the-cost-and-health-utility-of-patients",
    "href": "pages/plain_english.html#get-data-on-the-cost-and-health-utility-of-patients",
    "title": "Plain english summary",
    "section": "(5) Get data on the cost and health utility of patients",
    "text": "(5) Get data on the cost and health utility of patients\nFor each treatment against advanced RCC, further studies were identified which reported either:\n\nThe costs of each treatment for the healthcare system (e.g. costs of drugs, appointments, care)\nThe quality of life for patients on or off each treatment at each line of therapy (first-line through to fourth-line). This is described using a measure called a “health utility value”.",
    "crumbs": [
      "Model overview",
      "Plain english summary"
    ]
  },
  {
    "objectID": "pages/plain_english.html#construct-an-economic-model",
    "href": "pages/plain_english.html#construct-an-economic-model",
    "title": "Plain english summary",
    "section": "(6) Construct an economic model",
    "text": "(6) Construct an economic model\nThe data from steps (3), (4) and (5) were then fed into a computer model. The model simulates what happens to groups of patients who receive each treatment: how long they live, how much their treatments cost, and what their quality of life is like. By comparing these results, decisions can be made as to which treatments offer the best combination of effectiveness and value for money.",
    "crumbs": [
      "Model overview",
      "Plain english summary"
    ]
  },
  {
    "objectID": "pages/publication.html",
    "href": "pages/publication.html",
    "title": "List of articles and reports",
    "section": "",
    "text": "As referred to in the description of the NICE appraisals, there are several articles and reports that have been published in relation to this model. Several of these are listed below.",
    "crumbs": [
      "Context",
      "List of articles and reports"
    ]
  },
  {
    "objectID": "pages/publication.html#web-pages",
    "href": "pages/publication.html#web-pages",
    "title": "List of articles and reports",
    "section": "Web pages",
    "text": "Web pages\nThe pathways pilot is mentioned as part of NICE’s webpage on taking a proportion approach to technology appraisals. [1] There are also then webpages available for each of the appraisals: the pathways pilot [2] and the appraisal of cabozatinib with nivolumab [3]",
    "crumbs": [
      "Context",
      "List of articles and reports"
    ]
  },
  {
    "objectID": "pages/publication.html#reports",
    "href": "pages/publication.html#reports",
    "title": "List of articles and reports",
    "section": "Reports",
    "text": "Reports\nThe above web pages link to relevant NICE reports, and these include….\n\nFinal analysis plan for the model available as a PDF [4]\nRenal cell carcinoma pathway model report, which is “a summary of the external assessment group’s model and assumptions on renal cell carcinoma, discussed by NICE’s technology appraisal committee B”. Available as a PDF or within their website [5]\nNICE’s technology appraisal guidance on cabozatinib with nivolumab for untreated advanced renal cell carcinoma. Avaliable as a PDF or within their website [3]\n\nAnd others from the appraisal history like:\n\nAssessment report plain english summary - PDF\nAssessment report final analysis plan - this appears the same as that from the alternative link above - PDF\nAssessment report - PDF",
    "crumbs": [
      "Context",
      "List of articles and reports"
    ]
  },
  {
    "objectID": "pages/publication.html#publications",
    "href": "pages/publication.html#publications",
    "title": "List of articles and reports",
    "section": "Publications",
    "text": "Publications\nThere has been one related publication: the article NICE’s Pathways Pilot: Pursuing Good Decision Making in Difficult Circumstances [6], with a later correction published. [7] These are licensed under a CC-BY-NC-4.0 license, which enables us to share them below.\nArticle [6]:\n\n\nCorrection [7]:",
    "crumbs": [
      "Context",
      "List of articles and reports"
    ]
  },
  {
    "objectID": "pages/walkthrough_preface.html",
    "href": "pages/walkthrough_preface.html",
    "title": "Preface",
    "section": "",
    "text": "The following pages will provide a walk-through for running the Base Case EOM:RCC model, including an explanation of the:\n\nInput data\nCode in Model_Structure.R\nOutput report\n\n\n\n\n\n\n\nBonus information\n\n\n\n\n\nThese drop-down boxes appear throughout the walkthrough, and contain additional code to help walk you through what is happening (for example, explaining a function or section of code).",
    "crumbs": [
      "Code walkthrough",
      "Preface"
    ]
  },
  {
    "objectID": "pages/walkthrough_preface.html#aim-of-the-walkthrough",
    "href": "pages/walkthrough_preface.html#aim-of-the-walkthrough",
    "title": "Preface",
    "section": "",
    "text": "The following pages will provide a walk-through for running the Base Case EOM:RCC model, including an explanation of the:\n\nInput data\nCode in Model_Structure.R\nOutput report\n\n\n\n\n\n\n\nBonus information\n\n\n\n\n\nThese drop-down boxes appear throughout the walkthrough, and contain additional code to help walk you through what is happening (for example, explaining a function or section of code).",
    "crumbs": [
      "Code walkthrough",
      "Preface"
    ]
  },
  {
    "objectID": "pages/walkthrough_preface.html#adjustments",
    "href": "pages/walkthrough_preface.html#adjustments",
    "title": "Preface",
    "section": "Adjustments",
    "text": "Adjustments\nIn order to run the code from Model_Structure.R within this documentation, minor adjustments have been made such as to:\n\nAmend file paths\nInclude additional pre-run results, enabling:\n\nQuicker run times\nThe code to be split across multiple pages\n\n\nHence, it is advised that you use the original R script when running the model for yourself, rather than these .qmd files.\n\n\n\n\n\n\nFull list of adjustments\n\n\n\n\nChanged the path to the folders - e.g. “./3_Functions” to “../../../3_Functions”.\n\nInstead of amending this in each string, I created path_ variables to store the path to the folder, and then imported individual files using file.path() to combine the folder path with the file name.\nThese folder paths are all set-up in a code chunk paths after we load the required packages.\n\nSet f_excel_extract() from verbose = TRUE to verbose = FALSE, as it otherwise repeatedly prints “Extracting named range X from ../../1_Data/ID6184_RCC_model inputs FAD version [UK RWE unredacted, ACIC redacted, cPAS redacted].xlsm” where X is the name of each parameter\nAdd library(knitr) so can use kable()\nPrevent f_pf_computePF() from running, and instead load some pre-run results\nDon’t need to keep saving copies of the data/report since running with the same dataset each time so:\n\nPrevented from saving an .rds file with the results (3.6.4)\nStill set Run_Date to current date despite using old pre-run\nSet autosave to FALSE in f_res_ProduceWordDoc() as don’t need to keep saving copies of the report since running with the same data each time",
    "crumbs": [
      "Code walkthrough",
      "Preface"
    ]
  },
  {
    "objectID": "pages/license.html",
    "href": "pages/license.html",
    "title": "License",
    "section": "",
    "text": "This repository is licensed under an MIT license:\n\n\n\n\n\n\nMIT License\nCopyright (c) 2024 University of Exeter, Exeter Oncology Model; RCC edition\nPermission is hereby granted, free of charge, to any person obtaining a copy of this model and associated documentation files (the “RCC Model”), to deal in the RCC Model without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the RCC Model, and to permit persons to whom the RCC Model is furnished to do so, subject to the following conditions:\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the RCC Model.\nTHE RCC MODEL IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE RCC MODEL.",
    "crumbs": [
      "License"
    ]
  },
  {
    "objectID": "pages/walkthrough/code2_extrapolate.html",
    "href": "pages/walkthrough/code2_extrapolate.html",
    "title": "Extrapolate real-world evidence",
    "section": "",
    "text": "This page performs a partitioned survival analysis on the patient-level data, which is real-world evidence (RWE). The analysis is performed in order to extrapolate the survival curves so they cover the full time horizon of the economic model (40 years).",
    "crumbs": [
      "Code walkthrough",
      "Extrapolate real-world evidence"
    ]
  },
  {
    "objectID": "pages/walkthrough/code2_extrapolate.html#import-patient-level-data",
    "href": "pages/walkthrough/code2_extrapolate.html#import-patient-level-data",
    "title": "Extrapolate real-world evidence",
    "section": "Import patient-level data",
    "text": "Import patient-level data\nThe patient-level data (or individual patient data (IPD)) is imported from IPD_R_input_noACIC.xlsx. This data has a row for each patient which states their population, line, treatment and trial, and then the time taken for them to experience an endpoint (e.g. overall survival) or be censored (i.e. stopped timing for some other reason). For more information, see the Input data page.\nThe data is imported using f_excel_extract() which produces the object wb. This is a list with a single item: the table from the IPD sheet of the workbook. The code chunk converts this to a data table and filters it just the relevant columns.\nAs a survival time of 0 is not allowed, these are converted to 1 day (hence, 1/7 as the time unit of the analysis is weeks).\n\n# 3.3. Survival analysis -------------------------------------------------------\n\n# All objects here go in i$surv initially, and are then streamlined down to \n# what's needed to run models in the transition from i to p.\n# \n# Some values of p are used during the below (primarily p$surv$distNames, which\n# controls which distributions are included in the flexsurv runs)\n\n\n# 3.3.1 Survival input structure ------------------------------------------\n\ni$surv &lt;- list()\n\n#### Read in survival data from Excel workbook \n\n# Pull out the raw data from the IPD excel book - one named range per treatment at each line\n# Each reference curve is defined in Excel as time (weeks), event/censor (event coded as 1, censor as 0), patient group, line, molecule, trial and endpoint\n# Pull all of the named ranges from the excel workbook, expand the parameters table\n\nexcel_path2 &lt;- file.path(d_path, \"IPD_R_input_noACIC.xlsx\")\nif (file.exists(excel_path2)) {\n  wb &lt;- f_excel_extract(excel_path2, verbose = TRUE)\n  i$surv$pld &lt;- as.data.table(wb$`_xlnm._FilterDatabase`)\n  rm(wb)\n} else {\n  wb &lt;- f_excel_extract(rstudioapi::selectFile(\n    caption = \"Select the IPD file (IPD_R_input_noACIC.xlsx)\",\n    label = \"IPD_R_input_noACIC.xlsx\",\n    path = \"./1_Data/\",\n    filter = \"Excel Files (*.xlsx)\",\n    existing = TRUE\n  ), verbose = TRUE)\n  i$surv$pld &lt;- as.data.table(wb$`_xlnm._FilterDatabase`)\n  \n}\n\n\n# Some small cleaning of the PLD.\ni$surv$pld &lt;- i$surv$pld[,list(population,line,molecule,trial,endpoint,timew,event_censor)]\n\n# Do not allow zero survival times, they have to be at least 1 day. the TUotA is\n# weeks, so 1 day is 1/7 weeks:\ni$surv$pld[timew ==0,\"timew\"] &lt;- 1/7\n\n# The named range r_pld has numeric identifiers for:\n# \n# - pop\n# - line\n# - mol (i.e., regimen - combination therapies are under the same number)\n# - trial (trial id WITHIN population line and molecule to set them apart from each other - usually just 1!)\n# - endpoint\n\n# These numeric identifiers are then used to create a nested list of survival regression models and\n# extrapolations. The extrapolations are filtered down to the extrapolations that are selected\n# within the excel input sheet, but the rest are kept here in i in case of scenario analysis.\n# \n# Note that the lookup tables in the next section are used to translate these numbers\n# into human-readable identifiers.\n\n\n\n\n\n\n\nPreview i$surv$pld\n\n\n\n\n\n\nkable(head(i$surv$pld))\n\n\n\n\npopulation\nline\nmolecule\ntrial\nendpoint\ntimew\nevent_censor\n\n\n\n\n0\n1\n1\n0\n0\n205.28572\n1\n\n\n0\n1\n1\n0\n0\n40.00357\n0\n\n\n0\n1\n1\n0\n0\n145.42857\n0\n\n\n0\n1\n1\n0\n0\n108.85714\n1\n\n\n0\n1\n1\n0\n0\n86.85714\n1\n\n\n0\n1\n1\n0\n0\n53.42857\n0",
    "crumbs": [
      "Code walkthrough",
      "Extrapolate real-world evidence"
    ]
  },
  {
    "objectID": "pages/walkthrough/code2_extrapolate.html#create-look-ups-to-convert-between-numeric-categories-and-labels",
    "href": "pages/walkthrough/code2_extrapolate.html#create-look-ups-to-convert-between-numeric-categories-and-labels",
    "title": "Extrapolate real-world evidence",
    "section": "Create look-ups to convert between numeric categories and labels",
    "text": "Create look-ups to convert between numeric categories and labels\nThis section creates “look-ups” which enable us to convert between numeric and categorical variables.\n\n# 3.3.2 Data identification ------------------------------------------\n\n# There is a lot of nesting involved in this part of the analysis, with population line, regimen trial and endpoint\n# making a total of 5 layers of nesting to automatically go through each endpoint for each trial for\n# each regimen for each line for each population, perform all regression analyses, produce parameters\n# and have an easily identifiable (and therefore programmable) spaces for the results of each analysis\n# which can then be spat out into reporting.\n\n# The first step is to break up r_pld into separate datasets depending on the identifiers. A function\n# is used to do this which returns nothing if such data for one id set doesn't exist. \n# \n# Note that at this stage it is just those contexts which HAVE got PLD which are to be organised.\n# For those endpoints and so on that do not have data, a separate step after this one to populate \n# every endpoint for every treatment line for every treatment sequence is performed.\n\ni$id$ipd &lt;- list(\n  pop      = i$r_pld_lookup_pop$Number[!is.na(i$r_pld_lookup_pop$Number)],\n  line     = i$r_pld_lookup_line$Number[!is.na(i$r_pld_lookup_line$Number)],\n  mol      = i$r_pld_lookup_mol$Number[!is.na(i$r_pld_lookup_mol$Number)],\n  trial    = i$r_pld_lookup_trial$Number[!is.na(i$r_pld_lookup_trial$Number)],\n  endpoint = i$r_pld_lookup_endpoint$Number[!is.na(i$r_pld_lookup_endpoint$Number)]\n)\n\nnames(i$id$ipd$pop)      &lt;- paste0(\"pop_\"     , i$id$ipd$pop)\nnames(i$id$ipd$line)     &lt;- paste0(\"line_\"    , i$id$ipd$line)\nnames(i$id$ipd$mol)      &lt;- paste0(\"mol_\"     , i$id$ipd$mol)\nnames(i$id$ipd$trial)    &lt;- paste0(\"trial_\"   , i$id$ipd$trial)\nnames(i$id$ipd$endpoint) &lt;- paste0(\"endpoint_\", i$id$ipd$endpoint)\n\n# to see this, we have:\n#i$id$ipd\n\n\n\n\n\n\n\nView the i$id$ipd look-up\n\n\n\n\n\nThe first step in creating these look-up tables was to find the unique values in each of the i$r_pld_lookup_... lists, which contain numeric categories.\nThis lookup simply contains the unique numeric values from the i$r_pld_lookup_... lists, either just as numeric values or appended with pop, line, mol, trial or endpoint.\n\ni$id$ipd\n\n$pop\npop_0 pop_1 pop_2 \n    0     1     2 \n\n$line\nline_1 line_2 line_3 line_4 line_5 \n     1      2      3      4      5 \n\n$mol\n  mol_0   mol_1   mol_2   mol_3   mol_4   mol_5   mol_6   mol_7   mol_8   mol_9 \n      0       1       2       3       4       5       6       7       8       9 \n mol_10  mol_11  mol_12 mol_999 \n     10      11      12     999 \n\n$trial\ntrial_0 trial_1 trial_2 \n      0       1       2 \n\n$endpoint\nendpoint_0 endpoint_1 endpoint_2 endpoint_3 endpoint_4 \n         0          1          2          3          4 \n\n\n\n\n\n\n# Generating the same structure but with the translation table from number to\n# text:\n\ni$lookup$ipd &lt;- list(\n  pop      = data.table(i$r_pld_lookup_pop)[Description != 0],\n  line     = data.table(i$r_pld_lookup_line)[Description != 0],\n  mol      = data.table(i$r_pld_lookup_mol)[Description != 0],\n  trial    = data.table(i$r_pld_lookup_trial)[Description != 0],\n  endpoint = data.table(i$r_pld_lookup_endpoint)[Description != 0]\n)\n\n# For treatment line, add a translator for the column in the sequences output:\n\ni$lookup$ipd$line$seq_col &lt;- paste0(\"V\",2:(nrow(i$lookup$ipd$line)+1))\ni$lookup$ipd$line$R_id    &lt;- paste0(\"line_\",1:nrow(i$lookup$ipd$line))\n\n\n\n\n\n\n\nView the i$lookup$ipd look-up\n\n\n\n\n\nThis look-up consists of five data tables for population, treatment, molecule, trial and endpoint. Each converts between the numeric and two different categorical versions of each variable.\n\nkable(i$lookup$ipd)\n\n\n\n\n\n\n\n\nDescription\nRCC_input_desc\nNumber\n\n\n\n\nAll\nAll risk groups\n0\n\n\nPoor / intermediate risk\nPoor or intermediate risk group\n1\n\n\nFavourable risk\nFavourable risk group\n2\n\n\n\n\n\n\n\n\nDescription\nRCC_input_desc\nNumber\nseq_col\nR_id\n\n\n\n\nPreviously untreated\n1L\n1\nV2\nline_1\n\n\n2nd line\n2L\n2\nV3\nline_2\n\n\n3rd line\n3L\n3\nV4\nline_3\n\n\n4th line\n4L\n4\nV5\nline_4\n\n\nBSC\n5L\n5\nV6\nline_5\n\n\n\n\n\n\n\n\nDescription\nRCC_input_desc\nNumber\n\n\n\n\nNivolumab monotherapy\nnivolumab_monotherapy\n0\n\n\nCabozantinib plus nivolumab\ncabozantinib_plus_nivolumab\n1\n\n\nNivolumab plus ipilimumab\nnivolumab_plus_ipilimumab\n2\n\n\nLenvatinib plus pembrolizumab\nlenvatinib_plus_pembrolizumab\n3\n\n\nAvelumab plus axitinib\navelumab_plus_axitinib\n4\n\n\nPazopanib\npazopanib\n5\n\n\nTivozanib\ntivozanib\n6\n\n\nSunitinib\nsunitinib\n7\n\n\nCabozantinib\ncabozantinib\n8\n\n\nLenvatinib plus everolimus\nlenvatinib_plus_everolimus\n9\n\n\nEverolimus\neverolimus\n10\n\n\nAxitinib\naxitinib\n11\n\n\nSorafenib\nsorafenib\n12\n\n\nPlacebo / BSC\nplacebo_BSC\n999\n\n\n\n\n\n\n\n\nDescription\nRCC_input_desc\nNumber\n\n\n\n\nCheckMate 9ER\nCheckMate_9ER\n0\n\n\nCheckMate 025\nCheckMate_025\n1\n\n\nReal world evidence\nRWE\n2\n\n\n\n\n\n\n\n\nDescription\nRCC_input_desc\nNumber\n\n\n\n\nOS\nOverall survival\n0\n\n\nPFS\nProgression free survival\n1\n\n\nTTD\nTime to treatment discontinuation\n2\n\n\nTTP\nTime to progression\n3\n\n\nPPS\nPost progression survival\n4\n\n\n\n\n\n\n\n\n\n\n\n\nThis pre-existing lookup is simply copied but with a new name.\n\ni$lookup$dist &lt;- i$r_pld_lookup_dist\n\n\n\n\n\n\n\nView the i$lookup$dist look-up\n\n\n\n\n\nThis look-up is for the distributions used in the survival analyses.\n\nkable(i$lookup$dist)\n\n\n\n\nDescription\nRCC_input_desc\nNumber\n\n\n\n\nGeneralised gamma\ngengamma\n0\n\n\nExponential\nexp\n1\n\n\nWeibull\nweibull\n2\n\n\nLog-normal\nlnorm\n3\n\n\nGamma\ngamma\n4\n\n\nGompertz\ngompertz\n5\n\n\nLog-logistic\nllogis\n6\n\n\n\n\n\n\n\n\n\n# This means that you can easily look up things like so:\n\n# i$lookup$ipd$mol[Number == 1,list(Description,RCC_input_desc)]\n# i$lookup$ipd$mol[Number == 2,list(Description,RCC_input_desc)]\n# i$lookup$ipd$line[Number == 1,list(Description,RCC_input_desc)]\n# i$lookup$ipd$pop[Number == 0,list(Description,RCC_input_desc)]\n\n# One can also do the opposite, translating input file descriptions into numbers:\n\n# i$lookup$ipd$mol[RCC_input_desc == \"ipi_nivo\",list(Description,Number)]\n\ni$lookup$trt &lt;- i$lookup$ipd$mol$Number\nnames(i$lookup$trt) &lt;- i$lookup$ipd$mol$RCC_input_desc\nnames(i$lookup$trt)[length(i$lookup$trt)] &lt;- \"BSC\"\n\n\n\n\n\n\n\nView the i$lookup$trt look-up\n\n\n\n\n\nThis look-up is for the treatments.\n\ni$lookup$trt\n\n        nivolumab_monotherapy   cabozantinib_plus_nivolumab \n                            0                             1 \n    nivolumab_plus_ipilimumab lenvatinib_plus_pembrolizumab \n                            2                             3 \n       avelumab_plus_axitinib                     pazopanib \n                            4                             5 \n                    tivozanib                     sunitinib \n                            6                             7 \n                 cabozantinib    lenvatinib_plus_everolimus \n                            8                             9 \n                   everolimus                      axitinib \n                           10                            11 \n                    sorafenib                           BSC \n                           12                           999",
    "crumbs": [
      "Code walkthrough",
      "Extrapolate real-world evidence"
    ]
  },
  {
    "objectID": "pages/walkthrough/code2_extrapolate.html#further-pre-processing-before-survival-analysis",
    "href": "pages/walkthrough/code2_extrapolate.html#further-pre-processing-before-survival-analysis",
    "title": "Extrapolate real-world evidence",
    "section": "Further pre-processing before survival analysis",
    "text": "Further pre-processing before survival analysis\n\nCopy items into p\nCopy look-ups and IDs from i into p.\n\n# pass to p whenever i$lookup has been populated/updated.\np$basic$lookup &lt;- i$lookup\np$basic$id &lt;- i$id\n\n# one can then simply i$lookup$trt[\"nivolumab\"] or i$lookup$trt[\"sorafenib\"] to \n# get the id numbers.\n\n\n\nTidy sequences for each population\nConvert sequences into a data table, but making some amendments:\n\nChanging population to start from 0 - so pop_0 to pop_3 (rather than pop_1 to pop_4) (as this aligns with populations elsewhere)\nChanging the columns to line_1 to line_5 (instead of V1 to V5)\nSeperating the tables for each of the four populations\n\n\n# This then means that one can translate the treatment sequence data generated earlier\n# into numerical versions in one go:\n\n# Start by making the id for population fit with the rest of the model (pop_ with pop\n# starting from 0). NOTE that there is 1 more population in treatment sequences than\n# in the rest of the model...\n\ni$seq_clean &lt;- data.table(i$sequences)\n\ni$seq_clean$V1 &lt;- paste0(\"pop_\",as.numeric(substr(i$seq_clean$V1,4,4)) - 1)\n\ni$seq_pops &lt;- unique(i$seq_clean$V1)\nnames(i$seq_pops) &lt;- i$seq_pops\n\n# The \"clean\" version of sequences - first with words, then with numbers, then references\n\ni$seq_clean &lt;- lapply(i$seq_pops, function(popu) {\n  tmp &lt;- i$seq_clean[V1 == popu,-1]\n  colnames(tmp) &lt;- i$lookup$ipd$line$R_id[1:(p$basic$R_maxlines + 1)]\n  tmp\n})\n\n\n\n\n\n\n\nView i$seq_clean\n\n\n\n\n\nAs described above, we started with i$sequences:\n\nkable(head(i$sequences))\n\n\n\n\n\n\n\n\n\n\n\n\nV1\nV2\nV3\nV4\nV5\nV6\n\n\n\n\npop1\navelumab_plus_axitinib\npazopanib\ncabozantinib\neverolimus\nBSC\n\n\npop1\navelumab_plus_axitinib\nsunitinib\ncabozantinib\neverolimus\nBSC\n\n\npop1\navelumab_plus_axitinib\ntivozanib\ncabozantinib\neverolimus\nBSC\n\n\npop1\ncabozantinib_plus_nivolumab\npazopanib\naxitinib\neverolimus\nBSC\n\n\npop1\ncabozantinib_plus_nivolumab\npazopanib\neverolimus\naxitinib\nBSC\n\n\npop1\ncabozantinib_plus_nivolumab\nsunitinib\naxitinib\neverolimus\nBSC\n\n\n\n\n\nWhich was tidied to create i$seq_clean with seperate dataframes for each population. For example, population 0:\n\nkable(head(i$seq_clean$pop_0))\n\n\n\n\n\n\n\n\n\n\n\nline_1\nline_2\nline_3\nline_4\nline_5\n\n\n\n\navelumab_plus_axitinib\npazopanib\ncabozantinib\neverolimus\nBSC\n\n\navelumab_plus_axitinib\nsunitinib\ncabozantinib\neverolimus\nBSC\n\n\navelumab_plus_axitinib\ntivozanib\ncabozantinib\neverolimus\nBSC\n\n\ncabozantinib_plus_nivolumab\npazopanib\naxitinib\neverolimus\nBSC\n\n\ncabozantinib_plus_nivolumab\npazopanib\neverolimus\naxitinib\nBSC\n\n\ncabozantinib_plus_nivolumab\nsunitinib\naxitinib\neverolimus\nBSC\n\n\n\n\n\n\n\n\nNumeric versions of the i$seq_clean tables are also created.\n\n# It's pretty nested this but simplifies upon explanation: lapply on a data.frame\n# or data.table goes column-wise, so going across columns substitute the values\n# for the values in i$lookup$trt which have corresponding names, returning the numbers\n# which are consistent throughout the model. The way of looking inside e.g. network\n# is e.g. pop_2$line_5$mol_2$endpoint_1, so now we can use the tables produced below\n# to \"order\" the inputs for a treatment pathway \ni$seq_n &lt;- lapply(i$seq_clean, function(popu) {\n  as.data.table(lapply(popu, function(co) i$lookup$trt[co]))\n})\ni$seq_ref &lt;- lapply(i$seq_clean, function(popu) {\n  tmp &lt;- as.data.table(lapply(popu, function(co) {\n    vals &lt;- paste0(\"mol_\",i$lookup$trt[co])\n    ifelse(vals == \"mol_NA\",NA,vals)\n  }))\n})\n\n\n\n\n\n\n\nView i$seq_n and i$seq_ref\n\n\n\n\n\nThese are numeric versions of the possible treatment sequences for each population.\nThey either represent each treatment just as a number (i$seq_n) or as mol_number (i$seq_ref).\nFor example, for population 0:\n\nkable(head(i$seq_n$pop_0))\n\n\n\n\nline_1\nline_2\nline_3\nline_4\nline_5\n\n\n\n\n4\n5\n8\n10\n999\n\n\n4\n7\n8\n10\n999\n\n\n4\n6\n8\n10\n999\n\n\n1\n5\n11\n10\n999\n\n\n1\n5\n10\n11\n999\n\n\n1\n7\n11\n10\n999\n\n\n\n\nkable(head(i$seq_ref$pop_0))\n\n\n\n\nline_1\nline_2\nline_3\nline_4\nline_5\n\n\n\n\nmol_4\nmol_5\nmol_8\nmol_10\nmol_999\n\n\nmol_4\nmol_7\nmol_8\nmol_10\nmol_999\n\n\nmol_4\nmol_6\nmol_8\nmol_10\nmol_999\n\n\nmol_1\nmol_5\nmol_11\nmol_10\nmol_999\n\n\nmol_1\nmol_5\nmol_10\nmol_11\nmol_999\n\n\nmol_1\nmol_7\nmol_11\nmol_10\nmol_999\n\n\n\n\n\n\n\n\nThese are then copied into p.\n\n# Now that we have the final sequence list, we can add them to p:\n\np$seq$n   &lt;- i$seq_n\np$seq$ref &lt;- i$seq_ref\np$seq$qc &lt;- i$seq_clean\n\n# NOTE: QC check here is for NAs that are not beyond a 999 (i.e. past BSC)\n\n# We now have all the treatment sequences in the form of the molecule\n# number and the consistent reference linking right back to the named range\n# r_pld_lookup_mol in the excel front end. This ensures that the R model is\n# consistent with the R model in terms of which drugs are feeding through\n# to different places, as manually checking that is a very difficult and time \n# consuming task.\n# \n# Long story short:\n# \n#  - i$seq_clean: names of treatments per excel front end in order for all populations. use i$lookup$ipd$mol as reference table.\n#  - i$seq_n: corresponding treatment numbers per named range r_pld_lookup_mol in excel\n#  - i$seq_ref: reference name for pulling things out of R lists (e.g. p$drug[unlist(i$seq_ref$pop_0[1,])]) pulls pop 0 first sequence drug info IN ORDER :)\n#\n# This is automatically in line with the reference tables in the excel front end\n# loaded at the time. If the ordering is changed there it needs updating in the IPD\n# and in the lookup tables in the lists sheet of excel (and throughout excel!)\n# \n# \n# \n# i.e, if Excel lookup tables are wrong, this will be wrong!!!\n# \n# \n\n\n\nMake a categorical version of the patient-level data\nFirst, the look-ups are converted into lists.\n\n# 3.3.3 TSD14 survival analysis ------------------------------------------\n\n# Now that treatment sequences are brought in and cleaned up ready for use, we\n# can perform the survival analysis.\n# \n# Use the function in Survival_functions.R to perform \"simple\" extrapolations\n# on all pop line mol trial endpoint combinations with available data and return\n# NULL for the rest\n\n# Let's  perform some labelling like we did for treatment sequences for convenience/QC\n\ni$surv$lab_pld &lt;- list()\n\ni$surv$lab_pld$population &lt;- i$lookup$ipd$pop$Number\nnames(i$surv$lab_pld$population) &lt;- i$lookup$ipd$pop$Description\n\ni$surv$lab_pld$line &lt;- i$lookup$ipd$line$Number\nnames(i$surv$lab_pld$line) &lt;- i$lookup$ipd$line$Description\n\ni$surv$lab_pld$molecule &lt;- i$lookup$ipd$mol$Number\nnames(i$surv$lab_pld$molecule) &lt;- i$lookup$ipd$mol$Description\n\ni$surv$lab_pld$trial &lt;- i$lookup$ipd$trial$Number\nnames(i$surv$lab_pld$trial) &lt;- i$lookup$ipd$trial$Description\n\ni$surv$lab_pld$endpoint &lt;- i$lookup$ipd$endpoint$Number\nnames(i$surv$lab_pld$endpoint) &lt;- i$lookup$ipd$endpoint$Description\n\n\n\n\n\n\n\nView i$surv$lab_pld\n\n\n\n\n\nThe look-up tables in i$lookup$ipd convert between the numeric and categorical variables, and we will use these to relabel the patient-level data. However, to do this, we need to convert them into lists, where the labels are the categories and the values are the numeric versions of each categories.\nFor example, the original population look-up table:\n\nkable(i$lookup$ipd$pop)\n\n\n\n\nDescription\nRCC_input_desc\nNumber\n\n\n\n\nAll\nAll risk groups\n0\n\n\nPoor / intermediate risk\nPoor or intermediate risk group\n1\n\n\nFavourable risk\nFavourable risk group\n2\n\n\n\n\n\nAnd the new list created from that:\n\ni$surv$lab_pld$population\n\n                     All Poor / intermediate risk          Favourable risk \n                       0                        1                        2 \n\n\n\n\n\nThese look-up lists are then used to convert the patient-level data from numeric to categorical versions of each variable.\n\n# Now, put the data in a space and replace numbers with labels:\n\ni$surv$lab_pld$dat &lt;- i$surv$pld\ni$surv$lab_pld$dat$population &lt;- names(i$surv$lab_pld$population)[match(i$surv$lab_pld$dat$population,i$surv$lab_pld$population)]\ni$surv$lab_pld$dat$line       &lt;- names(i$surv$lab_pld$line)[match(i$surv$lab_pld$dat$line,i$surv$lab_pld$line)]\ni$surv$lab_pld$dat$molecule   &lt;- names(i$surv$lab_pld$molecule)[match(i$surv$lab_pld$dat$molecule,i$surv$lab_pld$molecule)]\ni$surv$lab_pld$dat$trial      &lt;- names(i$surv$lab_pld$trial)[match(i$surv$lab_pld$dat$trial,i$surv$lab_pld$trial)]\ni$surv$lab_pld$dat$endpoint   &lt;- names(i$surv$lab_pld$endpoint)[match(i$surv$lab_pld$dat$endpoint,i$surv$lab_pld$endpoint)]\n\n# Now we have a labelled version which is a bit easier to QC.\n\n# Note to debug it is very helpful to set verbose to TRUE below so that you can identify\n# the datasets which are problematic (e.g. not converging, 0 time values)\n\n\n\n\n\n\n\nView i$surv$lab_pld$dat\n\n\n\n\n\nAs mentioned, this code has converted the numeric patient-level data (i$surv$pld)…\n\nkable(head(i$surv$pld))\n\n\n\n\npopulation\nline\nmolecule\ntrial\nendpoint\ntimew\nevent_censor\n\n\n\n\n0\n1\n1\n0\n0\n205.28572\n1\n\n\n0\n1\n1\n0\n0\n40.00357\n0\n\n\n0\n1\n1\n0\n0\n145.42857\n0\n\n\n0\n1\n1\n0\n0\n108.85714\n1\n\n\n0\n1\n1\n0\n0\n86.85714\n1\n\n\n0\n1\n1\n0\n0\n53.42857\n0\n\n\n\n\n\n…Into categorical…\n\nkable(head(i$surv$lab_pld$dat))\n\n\n\n\n\n\n\n\n\n\n\n\n\npopulation\nline\nmolecule\ntrial\nendpoint\ntimew\nevent_censor\n\n\n\n\nAll\nPreviously untreated\nCabozantinib plus nivolumab\nCheckMate 9ER\nOS\n205.28572\n1\n\n\nAll\nPreviously untreated\nCabozantinib plus nivolumab\nCheckMate 9ER\nOS\n40.00357\n0\n\n\nAll\nPreviously untreated\nCabozantinib plus nivolumab\nCheckMate 9ER\nOS\n145.42857\n0\n\n\nAll\nPreviously untreated\nCabozantinib plus nivolumab\nCheckMate 9ER\nOS\n108.85714\n1\n\n\nAll\nPreviously untreated\nCabozantinib plus nivolumab\nCheckMate 9ER\nOS\n86.85714\n1\n\n\nAll\nPreviously untreated\nCabozantinib plus nivolumab\nCheckMate 9ER\nOS\n53.42857\n0",
    "crumbs": [
      "Code walkthrough",
      "Extrapolate real-world evidence"
    ]
  },
  {
    "objectID": "pages/walkthrough/code2_extrapolate.html#count-the-number-of-patients-with-each-treatment-line-molecule-trial-and-endpoint-in-patient-level-data",
    "href": "pages/walkthrough/code2_extrapolate.html#count-the-number-of-patients-with-each-treatment-line-molecule-trial-and-endpoint-in-patient-level-data",
    "title": "Extrapolate real-world evidence",
    "section": "Count the number of patients with each treatment, line, molecule, trial and endpoint in patient-level data",
    "text": "Count the number of patients with each treatment, line, molecule, trial and endpoint in patient-level data\nThe first line of this code chunk counted the number of rows for each combination of population, line, molecule trial and endpoint (PLMTE - hence the name n_by_plmte).\nThe remaining lines convert the numeric categories into categorical versions\n\ni$surv$n_by_plmte &lt;- i$surv$pld[, .N, by = list(population, line,molecule,trial,endpoint)] %&gt;%\n  arrange(population,line, molecule,trial,endpoint)\n\ni$surv$n_by_plmte$population &lt;- i$lookup$ipd$pop[match(i$surv$n_by_plmte$population       ,i$lookup$ipd$pop$Number),Description]\ni$surv$n_by_plmte$line       &lt;- i$lookup$ipd$line[match(i$surv$n_by_plmte$line       ,i$lookup$ipd$line$Number),Description]\ni$surv$n_by_plmte$molecule   &lt;- i$lookup$ipd$mol[match(i$surv$n_by_plmte$molecule       ,i$lookup$ipd$mol$Number),Description]\ni$surv$n_by_plmte$molecule[which(is.na(i$surv$n_by_plmte$molecule))]   &lt;- \"Non-UK treatments (pooled)\"\ni$surv$n_by_plmte$trial      &lt;- i$lookup$ipd$trial[match(i$surv$n_by_plmte$trial       ,i$lookup$ipd$trial$Number),Description]\ni$surv$n_by_plmte$endpoint   &lt;- i$lookup$ipd$endpoint[match(i$surv$n_by_plmte$endpoint       ,i$lookup$ipd$endpoint$Number),Description]\n\n# The number of rows in this table is the number of SETS of regression analyses\n# that are going to be run (each is 7 regressions)\n\n\n\n\n\n\n\nView i$surv$n_by_plmte\n\n\n\n\n\n\nkable(head(i$surv$n_by_plmte))\n\n\n\n\n\n\n\n\n\n\n\n\npopulation\nline\nmolecule\ntrial\nendpoint\nN\n\n\n\n\nAll\nPreviously untreated\nNivolumab monotherapy\nReal world evidence\nOS\n86\n\n\nAll\nPreviously untreated\nNivolumab monotherapy\nReal world evidence\nPFS\n86\n\n\nAll\nPreviously untreated\nNivolumab monotherapy\nReal world evidence\nTTD\n84\n\n\nAll\nPreviously untreated\nNivolumab monotherapy\nReal world evidence\nTTP\n86\n\n\nAll\nPreviously untreated\nNivolumab monotherapy\nReal world evidence\nPPS\n16\n\n\nAll\nPreviously untreated\nCabozantinib plus nivolumab\nCheckMate 9ER\nOS\n323",
    "crumbs": [
      "Code walkthrough",
      "Extrapolate real-world evidence"
    ]
  },
  {
    "objectID": "pages/walkthrough/code2_extrapolate.html#run-model",
    "href": "pages/walkthrough/code2_extrapolate.html#run-model",
    "title": "Extrapolate real-world evidence",
    "section": "Run model",
    "text": "Run model\nIn Model_Structure.R, this section is not run as i$dd_run_surv_reg is set to “No”, as set in the excel workbook.\nHowever, if run, this function would:\n1. Run survival analysis. Using f_surv_runAllTSD14() from survival/ (see dropdown below). “TSD14” refers to technical support document 14 which is a methods guide from NICE for performing survival analysis, available here. The function;\n\nRuns through all possible populations, lines, molecules, trials and endpoints in id (i$id$ipd, the lookup of unique values for each of those items)\nIf there is data available in r_pld (i$surv$pld, the patient level data), then it performs survival analysis using the function flexsurv::flexsurvreg(). This data will need to meet the threshold you set for the number of observations (default 28).\nIt repeats this for each with each of the distributions in distnames\nIt saves the coefficients, variance covariance matrix, and goodness of fit statistics, and saves these as fs_fits (and also gof)\nThe survival curves are then extrapolated using the fitted models over the specified time cycle (t_cyc (p$basic$t_cyc)) using the function f_extrapolate(). These are saved in the matrix st (survival at time t, or st for short)\nIf creating plots, this is done using the function f_extrap_plot()\nFinally, the function returns the results for each combination\n\n2. Seperately, manually run survival analysis for best supportive care (BSC). This is done seperately as there is very little information available on BSC overall survival (OS). Hence, the best source of data is to use the pooled post-progression survival (PPS) data from 4L (fourth line) patients (since they are unlikely to receive something after that treatment). It has similar steps to f_surv_runAllTSD14().\n\n# The below code runs the survival analysis and saves as an RDS file for upload, this will only run if you set \n# i$dd_run_surv_reg to \"Yes\" either in the Excel input or here\n\nif (i$dd_run_surv_reg == \"Yes\") {\n  \n  i$surv$reg &lt;- f_surv_runAllTSD14(\n    r_pld             = i$surv$pld,\n    id                = i$id$ipd,\n    lookups           = i$lookup$ipd,\n    draw_plots        = FALSE,\n    distnames         = i$distnames,\n    cl_y              = p$basic$cl_y,\n    t_cyc             = p$basic$t_cyc,\n    xlim_survplots_yr = p$misc$plot$xlim_survplots_yr,\n    t_yr              = p$basic$t_yr,\n    verbose           = qc_mode,\n    min_obs           = 28\n  )\n  \n  # now, there is very little information available on BSC overall survival,\n  # for those people that decide they do not want further treatment\n  #\n  # The best data available currently is pooled PPS data on 4L patients, these\n  # are then 5L+ patients and given that there are currently 4 lines of therapy\n  # the proportion that receive something active subsequently is likely to be\n  # small. Consequently, this is likely a pooled analysis which can inform\n  # early (and 5L) BSC OVERALL SURVIVAL.\n  #\n  # Therefore the molecule 999 4th line PPS should be informed by a pooled analysis\n  # of all molecules' PPS at 4th line. That is, i$surv$pld[line == 4 & trial == 2 & endpoint == 4,]\n  # is the data that should inform endpoint 0 for all BSC.\n  \n  # MANUALLY RUN SURVIVAL FOR BSC PPS AS POOLED!!!\n  \n  i$surv$reg$pop_0$line_4$mol_999$trial_2$endpoint_4 &lt;- lapply(1:1,function(x) {\n    \n    # Filter down to the parameters above associated with this combination:\n    ipd &lt;- i$surv$pld[line==4 & endpoint==4,list(timew,event_censor)]\n    \n    names(ipd) &lt;- c(\"t\",\"e\")\n    \n    cat(paste0(\n      \"Survival analysis - population: \", i$lookup$ipd$pop[Number      == 0, Description],\n      \"\\t line: \"                       , i$lookup$ipd$line[Number     == 4, Description],\n      \"\\t molecule: \"                   , i$lookup$ipd$mol[Number     == 999, Description],\n      \"\\t trial: \"                      , i$lookup$ipd$trial[Number     == 2, Description],\n      \"\\t endpoint: \"                   , i$lookup$ipd$endpoint[Number == 4, Description], \"\\n\"\n    ))\n    \n    fs_fits &lt;- lapply(i$distnames, function(dist) {  # applying all parametric survival curves in the list of distNames\n      fs_fit &lt;- flexsurvreg(\n        formula = Surv(t, e) ~ 1,\n        data = ipd,\n        dist = dist\n      )\n      return(list(\n        coefs = coefficients(fs_fit),                                         # coefficients for the fitted model\n        vcov  = vcov(fs_fit),                                                 # variance covariance matrix for the fitted model\n        fit   = c(AIC= AIC(fs_fit), BIC=BIC(fs_fit), logLik = logLik(fs_fit)) # goodness of fit statistics for the fitted model\n      ))\n    })\n    \n    gof &lt;- do.call(rbind, lapply(i$distnames, function(dist) fs_fits[[dist]]$fit))\n    \n    st &lt;- matrix(\n      unlist(lapply(i$distnames, function(dist) {\n        f_extrapolate(p$basic$t_cyc, fs_fits[[dist]]$coefs, dist)\n      })),\n      ncol = length(i$distnames),\n      dimnames = list(NULL, i$distnames),\n      byrow = FALSE\n    )\n    \n    \n    # curly braces on their own mean do this stuff and only return the last thing\n    # or what's in a return call\n    plot &lt;- {\n      # First the IPD is produced in a format that survminer will accept. Data must all be\n      # the same format with the same column names.\n      # this assumes no covariate adjustment\n      \n      sm_ipd &lt;- f_ce_km_MakeDatSurvFriendly(\n        Data_required = ipd,\n        time_column   = \"t\",                 # note that this is taking IPD in weeks\n        event_column  = \"e\",\n        t_multiplier  = p$basic$cl_y             # data in weeks, cycle length in plot years\n      )\n      \n      # get the survival analysis in the form we need for survminer\n      # and make the extrapolations we need for survminer\n      \n      form          &lt;- Surv(t, ec) ~ 1\n      sm_surv_est   &lt;- surv_fit(formula = form, data = sm_ipd)\n      \n      # make the plot with the input data:\n      survival_plot &lt;- suppressMessages(f_extrap_plot(\n        SurvEstimate   = sm_surv_est,\n        Data_required  = sm_ipd,\n        curvefits_data = st,\n        time_vector    = p$basic$t_yr,\n        xlim           = p$misc$plot$xlim_survplots_yr,   #### this will need replacing dependent on how many years we decide to show per time horizon\n        break_by       = round(20/8,0) #### this will need replacing dependent on how many years we decide to show per time horizon\n      ))\n      list(\n        ipd     = sm_ipd,\n        formula = form,\n        plot    = survival_plot\n      )\n    }\n    \n    \n    # Now that we've done everything for this dataset, return a list of the stuff\n    # we need for it:\n    return(list(\n      pop      = i$lookup$ipd$pop[     Number == 0,Description],\n      line     = i$lookup$ipd$line[    Number == 4,Description],\n      mol      = i$lookup$ipd$mol[     Number == 999,Description],\n      tr       = i$lookup$ipd$trial[     Number == 2,Description],\n      endpoint = i$lookup$ipd$endpoint[Number == 4,Description],\n      ipd      = ipd,\n      fs_fits  = fs_fits,\n      gof      = gof,\n      st       = st,\n      plot     = plot\n    ))\n  })[[1]]\n  \n  saveRDS(i$surv$reg, file = file.path(d_path, \"Survival_analysis.rds\"))\n  \n}",
    "crumbs": [
      "Code walkthrough",
      "Extrapolate real-world evidence"
    ]
  },
  {
    "objectID": "pages/walkthrough/code2_extrapolate.html#load-pre-run-survival-analysis",
    "href": "pages/walkthrough/code2_extrapolate.html#load-pre-run-survival-analysis",
    "title": "Extrapolate real-world evidence",
    "section": "Load pre-run survival analysis",
    "text": "Load pre-run survival analysis\nThis section loads a provided pre-run survival analysis. It then limits the matrices with the extrapolated survival curves to the time horizon of the study (40 years).\n\n# to load in pre-run survival analysis select the RDS file here\n\n# option to load from pre-specified file path on local machine, uncomment this and comment out the line below to use\n\nRDS_path &lt;- file.path(d_path, \"survival_analysis_no_ipd_CompanyTTDTTPPPS_redacted.rds\")\nif (file.exists(RDS_path)) {\n  i$surv$reg &lt;- readRDS(RDS_path)\n} else {\n  i$surv$reg &lt;- readRDS(rstudioapi::selectFile(\n    caption = \"Please select 'Survival_analysis_noTTDorTTPorPPS[NoACIC].rds'\",\n    label = \"Survival_analysis_noTTDorTTPorPPS[NoACIC].rds\",\n    path = \"./1_Data/\",\n    filter = \"R Files (*.rds)\",\n    existing = TRUE\n  ))\n}\n\n\n# Limit to model time horizon\n\nTH &lt;- p$basic$th + 1\n\ni$surv$reg &lt;-lapply(i$surv$reg, function(popu) {\n  lapply(popu, function(li) {\n    lapply(li, function(mol) {\n      lapply(mol, function(tr) {\n        lapply(tr, function(endp) {\n          if (is.null(endp$st)) {\n            return(endp)\n          } else {\n            endp$st &lt;- endp$st[1:TH,]\n            return(endp)\n          }\n        })\n      })\n    })\n  })\n})\n\n\n\n\n\n\n\nView i$surv$reg\n\n\n\n\n\nThe result of the survival analysis is a large nested list.\nBelow is an example of the result for population 2 (favourable risk) 1L treatment with avelumab plus axitinib, with an endpoint of progression-free survival.\nFor each distribution, it has $coefs, $vcov and $fit - for example, for weibull:\n\ni$surv$reg$pop_2$line_1$mol_4$trial_2$endpoint_1$fs_fits$weibull\n\n$coefs\n    shape     scale \n0.1368876 4.9253396 \n\n$vcov\n            shape       scale\nshape  0.02973812 -0.01789284\nscale -0.01789284  0.04001588\n\n$fit\n      AIC       BIC    logLik \n 316.2418  320.5281 -156.1209 \n\n\nThe fit of each distribution is also summarised in a single table:\n\nkable(i$surv$reg$pop_2$line_1$mol_4$trial_2$endpoint_1$gof)\n\n\n\n\n\nAIC\nBIC\nlogLik\n\n\n\n\ngengamma\n317.6759\n324.1053\n-155.8380\n\n\nexp\n314.8361\n316.9792\n-156.4180\n\n\nweibull\n316.2418\n320.5281\n-156.1209\n\n\nlnorm\n316.5742\n320.8604\n-156.2871\n\n\ngamma\n316.0581\n320.3443\n-156.0290\n\n\ngompertz\n316.8228\n321.1090\n-156.4114\n\n\nllogis\n315.2343\n319.5206\n-155.6172\n\n\n\n\n\nAnd finally, the survival times for each distribution are provided:\n\nkable(head(i$surv$reg$pop_2$line_1$mol_4$trial_2$endpoint_1$st))\n\n\n\n\n\n\n\n\n\n\n\n\n\ngengamma\nexp\nweibull\nlnorm\ngamma\ngompertz\nllogis\n\n\n\n\n1.0000000\n1.0000000\n1.0000000\n1.0000000\n1.0000000\n1.0000000\n1.0000000\n\n\n0.9985777\n0.9933915\n0.9964812\n0.9996291\n0.9972167\n0.9935903\n0.9980669\n\n\n0.9958140\n0.9868266\n0.9922259\n0.9979763\n0.9935048\n0.9872169\n0.9950622\n\n\n0.9922663\n0.9803051\n0.9876526\n0.9950948\n0.9893592\n0.9808795\n0.9914695\n\n\n0.9881616\n0.9738267\n0.9828687\n0.9912317\n0.9849185\n0.9745780\n0.9874457\n\n\n0.9836342\n0.9673911\n0.9779288\n0.9866047\n0.9802557\n0.9683123\n0.9830798\n\n\n\n\n\nIf draw_plots was set to TRUE for f_surv_runAllTSD14() when this dataset was produced, then there is also a plot available - but in this case, it was not.\n\ni$surv$reg$pop_2$line_1$mol_4$trial_2$endpoint_1$plot\n\nNULL\n\n\n\n\n\nThere are also some comments afterwards would provide some further details around the survival analysis.\n\n# !!!!!!\n# !!!!!!\n# !!!!!!\n# !!!!!!\n# !!!!!!\n# Note: i$surv$reg$pop_0$line_4$mol_999$trial_2$endpoint_4 is used\n# to inform ALL BSC OS. This will be decided in the EXCEL FILE, which \n# dropdowns for BSC OS should link to 4L PPS for mol 999\n# !!!!!!\n# !!!!!!\n# !!!!!!\n# !!!!!!\n# !!!!!!\n\n\n\n# Note that draw_plots will be a switch in the shiny application.\n# In this case we draw plots because we need those plots later (for word output\n# assisting with model selection)\n\n\n# So that's all of the TSD14 survival analysis done. The next step is to programmatically \n# proliferate comparative efficacy \n\n\n\n# On a tablet with very little computational power this takes a couple of minutes to run. on a new\n# laptop its not long at all\n\n\n# So, to pull out the visual fit of the analysis of TTD for a population\n\n# i$surv$reg$pop_0$line_1$mol_7$trial_0$endpoint_0$plot$plot\n# i$surv$reg$pop_0$line_1$mol_1$trial_0$endpoint_3$plot$plot\n# i$surv$reg$pop_0$line_1$mol_7$trial_0$endpoint_1$plot$plot\n\n# More importantly, to pull a particular extrapolation:\n# i$surv$reg$pop_0$line_1$mol_1$trial_0$endpoint_1$st[,\"weibull\"]\n\n# Where the \"weibull\" part would come from a dropdown list in the Excel front-end of the model specific\n# to that endpoint for that treatment for that line for that population (i.e. a lot of selections need to be made!)\n\n\n# The stuff inside of i$surv$reg can be used to automatically populate a report presenting the full plot, regression summaries,\n# goodness-of-fit results and the fit of the selected (via excel) distribution. The output can then be manually appended to include\n# written justification for the selection(s) to drastically reduce the overhead associated with reporting survival analysis\n# results and decisions made.",
    "crumbs": [
      "Code walkthrough",
      "Extrapolate real-world evidence"
    ]
  },
  {
    "objectID": "pages/walkthrough/code2_extrapolate.html#make-survival-analysis-report",
    "href": "pages/walkthrough/code2_extrapolate.html#make-survival-analysis-report",
    "title": "Extrapolate real-world evidence",
    "section": "Make survival analysis report",
    "text": "Make survival analysis report\nIf i$dd_report_req_surv_reg==\"Yes\" then a report is create - by default, this was set to “No”.\nThis code will only work if you have run f_surv_runAllTSD14() with draw_plots set to TRUE. As the provided pre-run survival analysis does not include plots, this section will not run, and encounters an error if tried:\nError in optim(method = \"BFGS\", par = c(mu = 5.82584217367559, sigma = -0.208272130470619,  : \n  non-finite finite-difference value [1]\n\n# 3.3.4 Survival analysis reporting ---------------------------------------\n\n# the next step is to go through all of the results based directly on survival data\n# and produce a readout containing:\n# \n# - Regression summary tables\n# - goodness of fit\n# - extrapolations (short and long-term) for visual fit assessment\n# \n# Each of these should have a separate section which at least states the identifiers\n# (i.e., translating from numbers to text as in Section 3.4.2 above)\n# \n# The best way to do this is with either Reduce or base for loops:\n# \n\n# Produce all the KM, extrapolations and gof tables for decisions on the front-end\n\n# Note whether or not the survival analysis report is run by the code is set in Excel as this takes a long time to produce\n# This cannot be produced without access to PLD\n\nif (i$dd_report_req_surv_reg==\"Yes\") {\n  \n  doc_surv &lt;- f_surv_makeTSD14Report(\n    fs_res = i$surv$reg,\n    id     = i$id$ipd,\n    lookup = i$lookup$ipd\n  )\n  print(doc_surv, target = file.path(o_path, \"Survival_Analysis.docx\"))\n  \n  rm(doc_surv)\n}",
    "crumbs": [
      "Code walkthrough",
      "Extrapolate real-world evidence"
    ]
  },
  {
    "objectID": "pages/walkthrough/code4_prep.html",
    "href": "pages/walkthrough/code4_prep.html",
    "title": "Prepare other data",
    "section": "",
    "text": "This section processes data on demographics, quality-adjusted life years (QALYs), costs, adverse events (AEs), costs, subsequent treatments, and population mappings.",
    "crumbs": [
      "Code walkthrough",
      "Prepare other data"
    ]
  },
  {
    "objectID": "pages/walkthrough/code4_prep.html#pre-progression-deaths",
    "href": "pages/walkthrough/code4_prep.html#pre-progression-deaths",
    "title": "Prepare other data",
    "section": "Pre-progression deaths",
    "text": "Pre-progression deaths\nAdd a parameter to p which provides the proportion of deaths in the progress-free survival group (so assuming there are some pre-progression deaths)\n\n\n\n\n\n\nView i$dd_prop_deathinPFS\n\n\n\n\n\n\ni$dd_prop_deathinPFS\n\n[1] 0.1797068\n\n\n\n\n\n\n# 3.4 Preparation of p -------------------------------------\n\n# !!!!!!!!!!!!!!!!!!!IMPORTANT, PLEASE READ!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n# \n# Before the patient flow sheet can be computed, it is imperative to populate\n# all of the elements of p which are required to compute it, such that the\n# function f_pf_computePF() really only needs one argument, p, to run (with a \n# few extra arguments for verbosity and limiting which populations to run etc).\n# \n# This is true of all analyses, including PSA. In the PSA p_psa will contain\n# the components of p which require random number generation (RNG), whilst p \n# itself will be used for all the stuff that does not change.\n# \n# Therefore, this section populates the \"rest\" of the model inputs (i.e. those\n# that are not informing the sequences or disease models). This includes costs, \n# QALYs and AEs.\n# \n# !!!!!!!!!!!!!!!!!!!IMPORTANT, PLEASE READ!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n# \n\n# Passing along an input for the ps model in case it is needed. this assumes\n# prop of pre-progression deaths.\np$surv$prop_deathinPFS &lt;- i$dd_prop_deathinPFS",
    "crumbs": [
      "Code walkthrough",
      "Prepare other data"
    ]
  },
  {
    "objectID": "pages/walkthrough/code4_prep.html#demographics",
    "href": "pages/walkthrough/code4_prep.html#demographics",
    "title": "Prepare other data",
    "section": "Demographics",
    "text": "Demographics\nThe population demographics are provided in a table which was from Excel, i$R_table_ptchar. The function f_cleaning_ptchar() converts this table into a nested list p$demo$agg.\n\n# 3.4.1 Demographics ------------------------------------------------------\n\n# Demographics are simply processed from the tables in Excel.\n\np$demo$agg &lt;- f_cleaning_ptchar(i$R_table_ptchar, i$lookup)\n\n# Deterministic version is very easy.\np$demo$live &lt;- p$demo$agg\n\n\n\n\n\n\n\nView p$demo$agg\n\n\n\n\n\nThe original demographics table:\n\nkable(head(i$R_table_ptchar))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPopulation\nTreatment.line\nStarting.age..years..Mean\nStarting…female.Mean\nStarting…PorI.risk.Mean\nBody.weight..kg..Mean\nPrior.IO…in.12.months.Mean\nStarting.age..years..n\nStarting…female.n\nStarting…PorI.risk.n\nBody.weight..kg..n\nStarting…PIR.n\nPrior.IO…in.12.months.n\nStarting.age..years..SE\nStarting…female.SE\nStarting…PorI.risk.SE\nBody.weight..kg..SE\nPrior.IO…in.12.months.SE\n\n\n\n\nAll\n1\n64.40\n0.2903715\n0.7755725\n83.38000\n0\n1311\n1319\n1310\n114\n1310\n1319\n0.2856284\n0.0124989\n0.0115269\n1.686593\n0\n\n\nPoor / intermediate risk\n1\n64.20\n0.2952756\n1.0000000\n81.26353\n0\n1011\n1016\n0\n114\n0\n1319\n0.3273973\n0.0143112\n0.0000000\n1.686593\n0\n\n\nFavourable risk\n1\n65.40\n0.2653061\n0.0000000\n90.98037\n0\n293\n294\n0\n114\n0\n1319\n0.5596696\n0.0257486\n0.0000000\n1.686593\n0\n\n\nAll\n2\n63.04\n0.2848101\n0.0000000\n83.38000\n0\nNA\nNA\nNA\nNA\nNA\nNA\n0.4186000\n0.0179527\n0.0000000\n1.686593\n0\n\n\nAll\n3\n62.62\n0.2850467\n0.0000000\n83.38000\n0\nNA\nNA\nNA\nNA\nNA\nNA\n0.7288700\n0.0308596\n0.0000000\n1.686593\n0\n\n\nAll\n4\n62.37\n0.2962963\n0.0000000\n83.38000\n0\nNA\nNA\nNA\nNA\nNA\nNA\n1.2498500\n0.0621386\n0.0000000\n1.686593\n0\n\n\n\n\n\nAnd a snippet from the nested list:\n\np$demo$agg$pop_0$line_1\n\n$age\n$age$mean\n[1] 64.4\n\n$age$se\n[1] 0.2856284\n\n$age$n\nNULL\n\n\n$pr_fem\n$pr_fem$mean\n[1] 0.2903715\n\n$pr_fem$se\nNULL\n\n$pr_fem$n\nNULL\n\n\n$weight\n$weight$mean\nNULL\n\n$weight$se\nNULL\n\n$weight$n\nNULL\n\n\n$prior_io\n$prior_io$mean\nNULL\n\n$prior_io$se\nNULL\n\n$prior_io$se\nNULL\n\n\n$pr_i_rsk\n$pr_i_rsk$mean\n[1] 0.7755725\n\n$pr_i_rsk$se\n[1] 0.01152693\n\n$pr_i_rsk$n\nNULL",
    "crumbs": [
      "Code walkthrough",
      "Prepare other data"
    ]
  },
  {
    "objectID": "pages/walkthrough/code4_prep.html#qalys",
    "href": "pages/walkthrough/code4_prep.html#qalys",
    "title": "Prepare other data",
    "section": "QALYs",
    "text": "QALYs\nThe function add_population_utility_params() creates p$util$pop_norms, which are the EQ-5D (i.e. utility value) population norms for females and males. These are produced by extract_utility_ageadjust_coefs(), which generates age-adjusted utility values.\n\n# 3.4.2 QALYs -------------------------------------------------------------\n\n# Utilities are applied to the disease model by treatment by line and whether the patient is on or off treatment\n# Age adjustment is conducted multiplicatively in line with DSU guidance using earlier defined patient characteristics for age and sex\n\n# Extracting from excel file \n\np &lt;- add_population_utility_params(p, psa = FALSE, .i = i)\n\n# Pre-calculate the population utility norms since they will be the same across\n# all sequences (though may vary across populations), and store in p\n\n\n\n\n\n\n\nView p$util$pop_norms\n\n\n\n\n\nAs an example, the female values:\n\np$util$pop_norms$female\n\n$l_coefficients\n$l_coefficients[[1]]\n    Age/10 (Age/10)^2  intercept \n   -0.0774     0.0064     0.2990 \n\n$l_coefficients[[2]]\n    Age/10 (Age/10)^2  intercept \n   -0.0147    -0.0003     0.8708 \n\n$l_coefficients[[3]]\n    Age/10 (Age/10)^2  intercept \n    0.2043    -0.0241     1.1659 \n\n\n$l_mix_coef\n$l_mix_coef[[1]]\n   Age/10 intercept \n   0.4028   -4.4767 \n\n$l_mix_coef[[2]]\n   Age/10 intercept \n   0.1937   -1.3549 \n\n\n$v_sigma\n[1] 0.1282 0.0831 0.5230\n\n\n\n\n\nWe start then with base_utility, which is a table with 2089 rows (which is the time horizon TH), where each row is a cycle. For each, the utility is set to 1. This basically means that every individual in the population starts with a full quality of life (utility value of 1).\nHowever, if i$dd_ageadjuutilities==\"Yes\", then it is adjusted based on the age and sex of either:\n\nThe population (if based on means) (i$dd_age_sex_source == \"Mean\")\nThe individual patients (if based on individual patients)\n\nThe result is utilities for each population (pop_0, pop_1, pop_2) for each cycle.\n\nbase_utility &lt;- data.frame(cycle = 0:p$basic$th, utility = 1)\nif (i$dd_ageadjuutilities == \"Yes\") {\n  if (i$dd_age_sex_source == \"Mean\") {\n    # We find the row corresponding to line 1 for each relevant population\n    \n    # Do a lot of wrangling to get in the format we want...\n    ptc_L1 &lt;- i$R_table_ptchar[Treatment.line == 1, c(1, 3, 4)]\n    colnames(ptc_L1) &lt;- c(\"Population\", \"age\", \"sex\")\n    ptc_L1$sex &lt;- 1 - ptc_L1$sex\n    ptc_L1 &lt;- merge(ptc_L1, i$lookup$ipd$pop, by.x = \"Population\", by.y = \"Description\")\n    ptc_L1 &lt;- ptc_L1[order(ptc_L1$Number), c(\"age\", \"sex\", \"Number\")]\n    ptc_L1 &lt;- split(ptc_L1[, c(\"age\", \"sex\")], paste0(\"pop_\", ptc_L1$Number))\n    \n    p$util$gpop &lt;- lapply(ptc_L1, function(pop) adjust_utility(\n      age            = pop$age,\n      sex            = pop$sex,\n      utilities      = base_utility,\n      .patient_level = FALSE,\n      .p             = p\n    ))\n    \n  } else {\n    # We will only include IPD from line 1, since the population\n    # norm is applied according to absolute model time rather than\n    # than time in state. We don't know which population they are\n    # in, so we will replicate for pop_0, pop_1 and pop_2.\n    ipd_L1 &lt;- i$R_table_patientagesex$Line == 1\n    p$util$gpop &lt;- list()\n    p$util$gpop$pop_0 &lt;- adjust_utility(\n      age            = i$R_table_patientagesex$Age[ipd_L1],\n      sex            = if_else(i$R_table_patientagesex$Gender[ipd_L1] == \"M\", \"male\", \"female\"),\n      utilities      = base_utility,\n      .patient_level = TRUE,\n      .p             = p\n    )\n    p$util$gpop$pop_1 &lt;- p$util$gpop$pop_0\n    p$util$gpop$pop_2 &lt;- p$util$gpop$pop_0\n  }\n} else {\n  p$util$gpop &lt;- list(pop_0 = 1, pop_1 = 1, pop_2 = 1)\n}                 \n\n\n\n\n\n\n\nView p$util$gpop\n\n\n\n\n\nIn the base case, it produces age-adjusted utilities, with age from the patient-level data.\n\ni$dd_ageadjuutilities\n\n[1] \"Yes\"\n\ni$dd_age_sex_source\n\n[1] \"PLD\"\n\n\nThe resulting utilities from, for example, population 0 are:\n\nhead(p$util$gpop$pop_0, 20)\n\n [1] 1.0000000 0.9999149 0.9998297 0.9997446 0.9996594 0.9995742 0.9994889\n [8] 0.9994037 0.9993184 0.9992331 0.9991477 0.9990623 0.9989769 0.9988915\n[15] 0.9988061 0.9987206 0.9986351 0.9985496 0.9984640 0.9983784\n\n\n\n\n\nThe function f_process_utilities() simply extracts and renames some of the columns from i$R_table_util to create i$QALYs$utilities$means. However, if PSA = TRUE, it would generate multiple samples of utility values for use in probabilistic sensitivity analysis.\n\n# Remove the object we made which is not used again\nrm(base_utility)\n\ni$QALYs &lt;- list()\n\ni$QALYs$utilities$means &lt;- f_process_utilities(raw_utilities = i$R_table_util,\n                                               PSA = FALSE,\n                                               samples = FALSE)\n# Sample code for PSA - temporariliy in file probabilistic_model_DEV.R\n\n# For the deterministic analysis, pass the means into p for use in the model.\n# We now have our population norms for calculating gpop utility multiplier\n# compared to baseline as well as our HSUVs by PLM and treatment status. everything\n# we need.\n# \np$util$mk &lt;- data.table(i$QALYs$utilities$means)\n\n\n\n\n\n\n\nNote\n\n\n\n\n\nOriginal table of utilities:\n\nkable(head(i$R_table_util))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPopulation\nPopulation.name\nTreatment.line\nMolecule\nTreatment.name\nOnTxtMean\nOffTxtMean\nPFSMean\nPDMean\nOnTxtSE\nOffTxtSE\nPFSSE\nPDSE\n\n\n\n\n0\nAll\n1\n0\nnivolumab_monotherapy\n0.753\n0.753\n0.753\n0.683\n0.0753\n0.0753\n0.0753\n0.0683\n\n\n0\nAll\n1\n1\ncabozantinib_plus_nivolumab\n0.753\n0.753\n0.753\n0.683\n0.0753\n0.0753\n0.0753\n0.0683\n\n\n0\nAll\n1\n2\nnivolumab_plus_ipilimumab\n0.753\n0.753\n0.753\n0.683\n0.0753\n0.0753\n0.0753\n0.0683\n\n\n0\nAll\n1\n3\nlenvatinib_plus_pembrolizumab\n0.753\n0.753\n0.753\n0.683\n0.0753\n0.0753\n0.0753\n0.0683\n\n\n0\nAll\n1\n4\navelumab_plus_axitinib\n0.753\n0.753\n0.753\n0.683\n0.0753\n0.0753\n0.0753\n0.0683\n\n\n0\nAll\n1\n5\npazopanib\n0.753\n0.753\n0.753\n0.683\n0.0753\n0.0753\n0.0753\n0.0683\n\n\n\n\n\nTable f_process_utilities():\n\nkable(head(i$QALYs$utilities$means))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPopulation\nPopulation.name\nTreatment.line\nMolecule\nTreatment.name\nOnTxt\nOffTxt\nPFS\nPD\n\n\n\n\n0\nAll\n1\n0\nnivolumab_monotherapy\n0.753\n0.753\n0.753\n0.683\n\n\n0\nAll\n1\n1\ncabozantinib_plus_nivolumab\n0.753\n0.753\n0.753\n0.683\n\n\n0\nAll\n1\n2\nnivolumab_plus_ipilimumab\n0.753\n0.753\n0.753\n0.683\n\n\n0\nAll\n1\n3\nlenvatinib_plus_pembrolizumab\n0.753\n0.753\n0.753\n0.683\n\n\n0\nAll\n1\n4\navelumab_plus_axitinib\n0.753\n0.753\n0.753\n0.683\n\n\n0\nAll\n1\n5\npazopanib\n0.753\n0.753\n0.753\n0.683",
    "crumbs": [
      "Code walkthrough",
      "Prepare other data"
    ]
  },
  {
    "objectID": "pages/walkthrough/code4_prep.html#aes",
    "href": "pages/walkthrough/code4_prep.html#aes",
    "title": "Prepare other data",
    "section": "AEs",
    "text": "AEs\nThis section processes data on adverse events. There are three outputs of this:\n\nAE type/approach (p$ae$aetype and p$ae$approach) - which is defined by a single string (same value for each of those variables)\nAE duration (p$ae$duration) - a table which, for particular molecules and treatment lines, the rate and duration of specific adverse events is listed\nAE impact (p$ae$mk$per_cycle) - a table which, for particular molecules and treatment lines, the cost and QALY impact of adverse events is specified\n\n\n# 3.4.3 AEs ---------------------------------------------------------------\n\n# the method to apply AEs (one-off or per cycle) is defined in the Excel inputs file\n# this applies to both costs and QALYs\n\n# options related to the source of AE data are defined in the Excel workbook\n# the functions below read in the information required to produce AE costs and utilities per cycle, this includes AE durations\n# and the trial durations associated with the rates which are used to produce one off cost and QALY impacts\n\np$ae$aetype &lt;- i$dd_apply_AE_options\n\n# when one off we need trial duration:\np$ae$duration &lt;- data.table(i$R_table_AE_rates)\n\n# produce the per cycle impact for each of the AEs\n\np$ae$mk$per_cycle &lt;- data.table(f_process_adverse_events(\n  AE_costs = i$R_table_AE_costs,\n  AE_disutil = i$R_table_AE_util,\n  AE_duration = i$R_table_duration,\n  AE_rate = i$R_table_AE_rates,\n  comparators = i$lookup$trt,\n  weeks_per_year = p$basic$cl_w / p$basic$cl_y,\n  PSA = FALSE\n))\n\nMean cost and QALY impact due to AEs per patient per week:\n\n# they all match up with column RCC_input_desc from Excel except BSC (mol_999). \n# Set BSC (assumed to have 0 AE impact):\np$ae$mk$per_cycle[trt == \"BSC\",]$trt &lt;- i$lookup$ipd$mol[match(999,Number),]$RCC_input_desc\n\n# Convert to numbers. Now it's ready for use in the patient flow sheet.\np$ae$mk$per_cycle$molecule &lt;- i$lookup$ipd$mol[match(p$ae$mk$per_cycle$trt,RCC_input_desc),]$Number\n\n# Add in the AE approach switch\np$ae$approach &lt;- i$dd_apply_AE_options\n\n\n\n\n\n\n\nView the AE type/approach, and the duration and impact tables\n\n\n\n\n\nAE type/approach:\n\np$ae$aetype  # same as p$ae$approach\n\n[1] \"one-off\"\n\n\nAE rate and duration:\n\nkable(head(p$ae$duration))\n\n\n\n\n\n\n\n\n\n\n\n\nTreatment.name\nMolecule\nTreatment.line\nAE\nRate.per.patient.per.week\nduration_weeks\n\n\n\n\nnivolumab_monotherapy\n0\n2\nG3+ ALT increased\n0.0000000\n23.91518\n\n\nnivolumab_monotherapy\n0\n2\nG3+ Anaemia\n0.0028248\n23.91518\n\n\nnivolumab_monotherapy\n0\n2\nG3+ Decreased appetite\n0.0000000\n23.91518\n\n\nnivolumab_monotherapy\n0\n2\nG3+ Diarrhoea _TKI induced\n0.0004556\n23.91518\n\n\nnivolumab_monotherapy\n0\n2\nG3+ Diarrhoea _IO induced\n0.0000000\n23.91518\n\n\nnivolumab_monotherapy\n0\n2\nG3+ Fatigue\n0.0010023\n23.91518\n\n\n\n\n\nAE cost and QALY impact:\n\nkable(head(p$ae$mk$per_cycle))\n\n\n\n\ntrt\nline\ncost\nQALYs\nmolecule\n\n\n\n\nnivolumab_monotherapy\n1\n6.737719\n-0.0000668\n0\n\n\ncabozantinib_plus_nivolumab\n1\n11.887276\n-0.0001200\n1\n\n\nnivolumab_plus_ipilimumab\n1\n9.745281\n-0.0000884\n2\n\n\nlenvatinib_plus_pembrolizumab\n1\n14.363607\n-0.0001422\n3\n\n\navelumab_plus_axitinib\n1\n17.905744\n-0.0001771\n4\n\n\npazopanib\n1\n14.707425\n-0.0001450\n5",
    "crumbs": [
      "Code walkthrough",
      "Prepare other data"
    ]
  },
  {
    "objectID": "pages/walkthrough/code4_prep.html#costs",
    "href": "pages/walkthrough/code4_prep.html#costs",
    "title": "Prepare other data",
    "section": "Costs",
    "text": "Costs\nThis section processes cost data:\n\nCosts of drug administration and medical resource use (MRU) (p$costs$mk)\nOne-off costs like end of life care and subsequent treatment (p$costs$oneoff)\n\nThere is some code within an if (FALSE) {} statement, meaning it is never run, but that would generate values for the probablistic sensitivity analysis (i$cost$drug_and_admin_cost_by_tunnel_state$PSA).\n\n# 3.4.4 Costs -------------------------------------------------------------\n\n# Drug and admin costs and MRU costs are considered within this section\n# Drug and admin costs are applied per treatment per line (as drug costs may differ depending on what line treatment is used at)\n# The impact of stopping rules is consider as part of the calculation of drug and admin costs rather than in determining whether \n# patients in the on or off treatment health states\n# MRU costs are applied per treatment and by on and off treatment status as the EAG was advised that MRU is the same across different lines\n# When this model is expanded to a generic version flexibility to define per line will be added\n# One off costs are included for treatment initiation at each line of treatment, terminal care at the end of life (applied on death) \n# and progression (radiotherapy and surgery costs)\n\ni$cost &lt;- list()\n\n# Put the deterministic drug cost inputs into p:\n# \np$costs$mk &lt;- f_process_cost_data(\n  drug_and_admin  = i$R_table_drug_admin_costs,\n  per_cycle_costs = i$R_table_MRU,\n  time_horizon    = p$basic$th,\n  max_trt_lines   = p$basic$R_maxlines,\n  RDI_source      = i$dd_sc_RDI,\n  verbose         = FALSE,\n  PSA             = FALSE, \n  samples         = 1)\n\nWarning in FUN(X[[i]], ...): NAs introduced by coercion\n\n# For PSA, You can pull psa iteration like this (done with random as test):\n# psa_it &lt;- round(runif(1)*1000,0)\n# ooc_psa &lt;- one_off_costs[,c(\"Type.of.cost\", \"Type\", \"Apply.to\",paste0(\"V\",psa_it)),with = FALSE]\n# setnames(ooc_psa, paste0(\"V\",psa_it),\"cost\")\n# print(ooc_psa)\n# \n# Alternatively, passs the whole table into PSA version of model as it's small\n# data. Can't do that for survival obviously, but we can for smaller data.\n# \np$costs$oneoff &lt;-  f_process_other_cost_data(\n  one_off_costs = i$R_table_MRU_oneoff,\n  PSA = FALSE\n)\n\n# pull out the individual inputs required for the ST model. In a PSA run\n# this would be the nth iteration.\np$costs$oneoff_mk &lt;- p$costs$oneoff[,.(cost = sum(cost)),by=list(Apply.to)]\np$costs$oneoff_mk &lt;- lapply(structure(\n  p$costs$oneoff_mk$Apply.to,\n  .Names = p$costs$oneoff_mk$Apply.to\n), function(x) {\n  p$costs$oneoff_mk[Apply.to == x, ]$cost\n})\n\n# These are then added to the first element of the cost vectors in the patient flow\n# function.\n\n#holding line for PSA - this will be replaced by function sampling from means and SEs\n\nif (FALSE) {\n  i$cost$drug_and_admin_cost_by_tunnel_state$PSA &lt;- f_process_drug_and_admin_cost_data(\n    raw_table = i$R_table_drug_admin_costs,\n    PSA_samples = TRUE)\n}  \n\n\n\n\n\n\n\nView the costs\n\n\n\n\n\np$costs$mk contains the costs per cycle for each molecule and line (hence length 2089, as 2089 weeks = 40 years). It has options of:\n\nDrug\nAdmin\nMRU on\nMRU off\n\n\n# Length of costs\nlength(p$costs$mk$drug$line_1$mol_4)\n\n[1] 2089\n\n# Example\nhead(p$costs$mk$drug$line_1$mol_4, 20)\n\n [1] 5627.810    0.000 2666.496    0.000 5627.810    0.000 2666.496    0.000\n [9] 5627.810    0.000 2666.496    0.000 5627.810    0.000 2666.496    0.000\n[17] 5627.810    0.000 2666.496    0.000\n\n\nWhilst p$costs$oneoff and p$costs$oneoff_mk contain one-off costs.\n\nkable(p$costs$oneoff)\n\n\n\n\n\n\n\n\n\n\nType.of.cost\nType\nApply.to\ncost\n\n\n\n\nEnd of life (EOL) or terminal care\n\n\n\n\n\n(applied at death)\none-off\nDeath\n8714.034\n\n\nSubsequent radiotherapy (following progression)\none-off\nProg\n511.020\n\n\nSubsequent surgery (following progression)\none-off\nProg\n5393.256\n\n\n\n\np$costs$oneoff_mk\n\n$Death\n[1] 8714.034\n\n$Prog\n[1] 5904.276",
    "crumbs": [
      "Code walkthrough",
      "Prepare other data"
    ]
  },
  {
    "objectID": "pages/walkthrough/code4_prep.html#subsequent-treatments",
    "href": "pages/walkthrough/code4_prep.html#subsequent-treatments",
    "title": "Prepare other data",
    "section": "Subsequent treatments",
    "text": "Subsequent treatments\n\n# 3.4.4 Subsequent treatment -------------------------------------------------------------\n\n# Read in cost and QALY consequences for subsequent treatments per first line option from Excel\n# This information is only used whaen the PartSA model structure is selected\n\np$substrt$partsa  &lt;- as.data.table(f_process_subs_txt_data(\n  subs_txt = i$R_table_sub_txt_cum_costs,\n  PSA             = FALSE\n))\n\n\n\n\n\n\n\nView p$substrt$parts\n\n\n\n\n\nThis table contains information on the costs and AEs associated with subsequent treatment, as specified for each treatment and population.\n\nkable(head(p$substrt$partsa))\n\n\n\n\n\n\n\n\n\n\n\n\nTreatment\nPopulation\ndrug_cost\nadmin_cost\nAE_cost\nAE_QALY_impact\n\n\n\n\nnivolumab_monotherapy\npop0\n0.00\n0.0000\n0.0000\n0.0000000\n\n\ncabozantinib_plus_nivolumab\npop0\n39268.59\n795.5377\n707.1494\n-0.0063590\n\n\nnivolumab_plus_ipilimumab\npop0\n0.00\n0.0000\n0.0000\n0.0000000\n\n\nlenvatinib_plus_pembrolizumab\npop0\n0.00\n0.0000\n0.0000\n0.0000000\n\n\navelumab_plus_axitinib\npop0\n39608.96\n703.3352\n555.6036\n-0.0049325\n\n\npazopanib\npop0\n54145.22\n4320.7039\n787.5639\n-0.0071626",
    "crumbs": [
      "Code walkthrough",
      "Prepare other data"
    ]
  },
  {
    "objectID": "pages/walkthrough/code4_prep.html#population-mappings",
    "href": "pages/walkthrough/code4_prep.html#population-mappings",
    "title": "Prepare other data",
    "section": "Population mappings",
    "text": "Population mappings\nThere are:\n\nThree risk populations (all risk, favourable risk, intermediate/poor risk)\nTwo immuno-oncology (IO) populations (whether or not patients had prior adjuvant therapy with IO treatment within 12 months)\n\nThese leads to six possible combinations overall. We can use this table to map from those six, to those used in the analysis:\n\nTreatment sequences are sorted into 4 populations (Sequencing.population.number)\nSurvival extrapolations, costs, QALYs and AEs are sorted into 3 populations (Risk.population.number)\n\n\n# 3.5 Population mapping --------------------------------------------------\n\n# There are 6 populations. These are combinations of \n#   \n#   - the risk populations (3 of them)\n#   - whether or not patients have had prior adjuvant therapy with immune-oncology treatments (2 of them)\n#   \n#   This makes for a possible 6 combinations, which are mapped to each other\n#   in the excel table i$r_overall_lookup_pop\n#   \n#   Currently the treatment sequences are sorted into 4 different populations. (combination)\n#   Currently the final survival extrapolations are sorted into 3 different populations (risk)\n#   Currently the costs, QALYs and AEs are sorted into 3 different populations (risk)\n#   \n#   Fortunately this table allows us to simply refer to the appropriate populations\n#   whilst calculating the patient flow. As an example:\n#   \n#   for overall population 1:\n#   \n#   seq_pop  &lt;- p$basic$lookup$pop_map[1,]$Sequencing.population.number\n#   risk_pop &lt;- p$basic$lookup$pop_map[1,]$Risk.population.number\n#   \n#   Then use seq_pop to pull sequences & risk_pop for everything else.\n#   \n#   \n\np$basic$lookup$pop_map &lt;- data.table(i$r_overall_lookup_pop)\n\n# SECOND NOTE: In later treatment lines the risk population is always 0.\n# PLEASE READ  To prevent replicating more and more data, the model simply\n#              pulls from (risk) population 0 for later lines within the function\n#              f_seq_extrapCollector, which \"collects\" the correct extrapolations.\n#              This simply pulls from (risk) population 0 if line is more than 1\n#              \n#              THIS IS A MODELLING ASSUMPTION AS WE WERE INFORMED THAT RISK IS NOT\n#              MEASURED AT 2L AND PRIOR RISK STATUS DOES NOT IMPACT TREATMENT\n#              OUTSIDE OF PRIOR THERAPY RECEIVED. A FULLY GENERIC MODEL WOULD NOT MAKE THIS ASSUMPTION\n#              AND INSTEAD WOULD HAVE A LARGER TABLE IN THE EFFICACY SETTINGS\n#              SHEET COVERING THE WHOLE MATRIX OF POP/LINE\n#              \n\n\n\n\n\n\n\nView p$basic$lookup$pop_map\n\n\n\n\n\n\nkable(p$basic$lookup$pop_map)\n\n\n\n\n\n\n\n\n\n\n\nSequencing.population\nRisk.population\nSequencing.population.number\nRisk.population.number\nOverall.population.number\n\n\n\n\nAll risk and favourable risk no prior adjuvant\nAll risk\n0\n0\n1\n\n\nAll risk and favourable risk no prior adjuvant\nFavourable risk\n0\n2\n2\n\n\nInt / poor risk no prior adjuvant\nInt/poor\n1\n1\n3\n\n\nAll risk and favourable risk prior adjuvant\nAll risk\n2\n0\n4\n\n\nAll risk and favourable risk prior adjuvant\nFavourable risk\n2\n2\n5\n\n\nInt / poor risk prior adjuvant\nInt/poor\n3\n1\n6",
    "crumbs": [
      "Code walkthrough",
      "Prepare other data"
    ]
  },
  {
    "objectID": "pages/scenarios.html",
    "href": "pages/scenarios.html",
    "title": "Scenario analysis",
    "section": "",
    "text": "In the assessment report, [1] Table 95 provides a very clear overview of the scenarios explored. It details how these differ from the base case, and justification for the scenario. Further description is also offered elsewhere in the report.\nAs an example, one of the scenarios is:\n\n\n\n\n\n\n\n\n\nParameter\nBase case\nScenario\nJustification\n\n\n\n\nBaseline risk\nUK RWE\nCheckMate 9ER\nTesting impact of baseline risk\n\n\n\nIn this scenario, the reference surival curves providing baseline risk for the reference treatments are calculated using clinical trial data, rather than using the real-world evidence.\nIn addition to the scenarios described in Table 95, there was also an exploratory analysis on the impact of prior adjuvant therapy. This is detailed in section 4.3.5.8 of the assessment report. [1]",
    "crumbs": [
      "Scenario analysis"
    ]
  },
  {
    "objectID": "pages/scenarios.html#what-scenario-analyses-were-conducted",
    "href": "pages/scenarios.html#what-scenario-analyses-were-conducted",
    "title": "Scenario analysis",
    "section": "",
    "text": "In the assessment report, [1] Table 95 provides a very clear overview of the scenarios explored. It details how these differ from the base case, and justification for the scenario. Further description is also offered elsewhere in the report.\nAs an example, one of the scenarios is:\n\n\n\n\n\n\n\n\n\nParameter\nBase case\nScenario\nJustification\n\n\n\n\nBaseline risk\nUK RWE\nCheckMate 9ER\nTesting impact of baseline risk\n\n\n\nIn this scenario, the reference surival curves providing baseline risk for the reference treatments are calculated using clinical trial data, rather than using the real-world evidence.\nIn addition to the scenarios described in Table 95, there was also an exploratory analysis on the impact of prior adjuvant therapy. This is detailed in section 4.3.5.8 of the assessment report. [1]",
    "crumbs": [
      "Scenario analysis"
    ]
  },
  {
    "objectID": "pages/scenarios.html#how-can-these-scenarios-be-run",
    "href": "pages/scenarios.html#how-can-these-scenarios-be-run",
    "title": "Scenario analysis",
    "section": "How can these scenarios be run?",
    "text": "How can these scenarios be run?\nTo run these scenarios, you’ll need to alter the model script (for example, altering Model_Structure.R).\nA table of scenarios is provided in the excel input sheet and imported into i as i$R_table_scenarios. This outlines the inputs that will need to be changed in order to run the scenario analysis. Each row in this table has:\n\nScenario category (e.g. “Model structure”)\nScenario number (e.g. 1)\nScenario label (e.g. “PartSA 4 lines” - i.e. using a partitioned survival model instead of state transition)\nInputs.required (i.e. number of inputs to be altered) (e.g. 2)\nA set of columns for each input with:\n\nSheet (i.e. source of input in excel) (e.g. “Model settings”)\nRange (i.e. named range in excel that imports the input) (e.g. “dd_model_struct”)\nValue (e.g. “Partitioned survival)\nIn this example, the second input (as detailed in the subsequent columns) was sheet “Model settings”, range “R_max_trt_lines” and value 4\n\n\n\n\n\n\n\n\nView i$R_table_scenarios\n\n\n\n\n\n\nkable(i$R_table_scenarios)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nX1\nX0\nScenario.label\nInputs.required\nSheet\nRange\nValue\nSheet.1\nRange.1\nValue.1\nSheet.2\nRange.2\nValue.2\nSheet.3\nRange.3\nValue.3\nSheet.4\nRange.4\nValue.4\nSheet.5\nRange.5\nValue.5\nSheet.6\nRange.6\nValue.6\nSheet.7\nRange.7\nValue.7\nSheet.8\nRange.8\nValue.8\nSheet.9\nRange.9\nValue.9\nSheet.10\nRange.10\nValue.10\nSheet.11\nRange.11\nValue.11\nTrace_Needed\nFull_Trace_Needed\n\n\n\n\nModel structure\n1\nPartSA 4 lines\n2\nModel settings\ndd_model_struct\nPartitioned survival\nModel settings\nR_max_trt_lines\n4\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_model_struct\nState transition\nModel settings\nR_max_trt_lines\n4\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nNo\n\n\nNA\n2\nState transition 3 lines\n2\nModel settings\ndd_model_struct\nState transition\nModel settings\nR_max_trt_lines\n3\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_model_struct\nState transition\nModel settings\nR_max_trt_lines\n4\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nNo\n\n\nNA\n3\nState transition 2 lines\n2\nModel settings\ndd_model_struct\nState transition\nModel settings\nR_max_trt_lines\n2\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_model_struct\nState transition\nModel settings\nR_max_trt_lines\n4\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nNo\n\n\nDiscount rate\n4\nDiscount rate-0%\n2\nModel settings\nui_disc_cost\n0\nModel settings\nui_disc_qaly\n0\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\nui_disc_cost\n3.5000000000000003E-2\nModel settings\nui_disc_qaly\n3.5000000000000003E-2\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNo\nNo\n\n\nNA\n5\nDiscount rate-6%\n2\nModel settings\nui_disc_cost\n0.06\nModel settings\nui_disc_qaly\n0.06\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\nui_disc_cost\n3.5000000000000003E-2\nModel settings\nui_disc_qaly\n3.5000000000000003E-2\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nPrimary data source\n6\nTrial-based analyses, state transition model\n5\nModel settings\ndd_baseline_risk_from\nTrial data\nPatient characteristics\ndd_pc\nTrial data\nTreatment sequence\ndd_sub_txt_prop_sources\nTrial data\nModel settings\ndd_model_struct\nState transition\nModel settings\ndd_age_sex_source\nMean\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_baseline_risk_from\nRWE\nModel settings\ndd_model_struct\nState transition\nPatient characteristics\ndd_pc\nRWE\nTreatment sequence\ndd_sub_txt_prop_sources\nRWE\nModel settings\ndd_age_sex_source\nPLD\nYes\nYes\n\n\nPrimary data source\n7\nTrial-based analyses, PartSA\n5\nModel settings\ndd_baseline_risk_from\nTrial data\nPatient characteristics\ndd_pc\nTrial data\nTreatment sequence\ndd_sub_txt_prop_sources\nTrial data\nModel settings\ndd_model_struct\nPartitioned survival\nModel settings\ndd_age_sex_source\nMean\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_baseline_risk_from\nRWE\nModel settings\ndd_model_struct\nState transition\nPatient characteristics\ndd_pc\nRWE\nTreatment sequence\ndd_sub_txt_prop_sources\nRWE\nModel settings\ndd_age_sex_source\nPLD\nYes\nNo\n\n\nPop characteristics\n8\nData source-CheckMate 9ER\n2\nPatient characteristics\ndd_pc\nTrial data\nPatient characteristics\ndd_age_sex_source\nMean\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nPatient characteristics\ndd_pc\nRWE\nPatient characteristics\ndd_age_sex_source\nPLD\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nPop characteristics\n9\nAge-Mean\n1\nModel settings\ndd_age_sex_source\nMean\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_age_sex_source\nPLD\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nEffectiveness\n10\nBaseline risk-CheckMate 9ER\n1\nModel settings\ndd_baseline_risk_from\nTrial data\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_baseline_risk_from\nRWE\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n11\nPreferred NMA 1st line-PH NMA\n1\nModel settings\ndd_use_PHnma_for_Fpnma\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_use_PHnma_for_Fpnma\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n12\nPreferred 2nd line NMA-FP NMA\n1\nModel settings\ndd_2ndline_NMA\nFP_NMA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_2ndline_NMA\nPH_NMA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n13\nPreferred NMA for pem+lenv-FP NMA\n1\nModel settings\ndd_pemlen_NMA\nFP_NMA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_pemlen_NMA\nPH_NMA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n14\nMethod used to adjust crossing curves-Survivor function\n1\nModel settings\ndd_adj_cross_curves\nUse absolute survival\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_adj_cross_curves\nUse hazards\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n15\nAssume pazo equal to suni\n1\nModel settings\ndd_eq_eff_pazo_suni\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_eq_eff_pazo_suni\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n16\nAssume tivo equal to suni\n1\nModel settings\ndd_eq_eff_tivo_suni\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_eq_eff_tivo_suni\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n17\nAssume axi equal to evero\n1\nModel settings\ndd_eq_eff_evero_axi\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_eq_eff_evero_axi\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n18\nTime on treatment data taken from-TTD equal to PFS, state transition model\n1\nModel settings\ndd_TTD_same_as_PFS\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_TTD_same_as_PFS\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n19\nTime on treatment data taken from-TTD equal to PFS, PartSA\n2\nModel settings\ndd_TTD_same_as_PFS\nYes\nModel settings\ndd_model_struct\nPartitioned survival\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNA\n20\nRelative effectiveness for nivo+ipi from PFS consistent with other treatments\n1\nModel settings\ndd_CheckMate214_TTD\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_CheckMate214_TTD\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n21\nPartSA analysis with efficacy using the PH NMA\n5\nModel settings\ndd_model_struct\nPartitioned survival\nModel settings\ndd_cabo_nivo_outcome_from\nPH_NMA\nModel settings\ndd_use_PHnma_for_Fpnma\nYes\nModel settings\ndd_2ndline_NMA\nPH_NMA\nModel settings\ndd_pemlen_NMA\nPH_NMA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_model_struct\nState transition\nModel settings\ndd_cabo_nivo_outcome_from\nFP_NMA\nModel settings\ndd_use_PHnma_for_Fpnma\nNo\nModel settings\ndd_2ndline_NMA\nPH_NMA\nModel settings\ndd_pemlen_NMA\nPH_NMA\nYes\nNo\n\n\nTreatment waning scenarios\n22\nTreatment effectiveness waning -10 years for IO/TKIs, all endpoints, based on hazards\n1\nModel settings\ndd_TE_sc_10y_IO_TKI\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n23\nTreatment effectiveness waning-10 years all IO combinations, all endpoints, based on hazards\n1\nModel settings\ndd_TE_sc_10y_all_IO\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n24\nTreatment effectiveness waning-Between 5 and 20 years all IO/TKIs, all endpoints, based on hazards\n1\nModel settings\ndd_TE_sc_5and20y_IO_TKI\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n25\nTreatment effectiveness waning-Between 5 and 20 years all IO, all endpoints, based on hazards\n1\nModel settings\ndd_TE_sc_5and20y_all_IO\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n26\nNo treatment effect waning\n1\nModel settings\ndd_no_TE_waning\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n27\nTreatment effectiveness waning-PartSA: 5 years for IO/TKIs, OS only, based on hazards\n2\nModel settings\ndd_TE_sc_PartSA_5y_IO_TKI_OS\nYes\nModel settings\ndd_model_struct\nPartitioned survival\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_TE_sc_PartSA_5y_IO_TKI_OS\nNo\nModel settings\ndd_model_struct\nState transition\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n28\nTreatment effectiveness waning-PartSA:between 4 and 6 years for IO/TKIs, OS only, based on absolute survival\n2\nModel settings\ndd_TE_sc_4and6y_IO_TKI_OS_absSurv\nYes\nModel settings\ndd_model_struct\nPartitioned survival\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_TE_sc_4and6y_IO_TKI_OS_absSurv\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nParametric curves*\n29\nSunitinib RWE 1L PFS all risk group: Weibull\n2\nModel settings\ndd_surv_cur\nScenario\nEffectiveness settings\ni_sun_RWE_1L_PFS_all_sc\nScenario_1\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_surv_cur\nBase case\nEffectiveness settings\ni_sun_RWE_1L_PFS_all_sc\nBase case\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n30\nSunitinib RWE 1L TTD int/poor and all risk: Weibull and favourable risk: gen gamma\n4\nModel settings\ndd_surv_cur\nScenario\nEffectiveness settings\ni_sun_RWE_1L_TTD_porI_all_sc_1\nScenario_1\nEffectiveness settings\ni_sun_RWE_1L_TTD_porI_all_sc_2\nScenario_1\nEffectiveness settings\ni_sun_RWE_1L_TTD_porI_all_sc_3\nScenario_1\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_surv_cur\nBase case\nEffectiveness settings\ni_sun_RWE_1L_TTD_porI_all_sc_1\nBase case\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n31\nSunitinib RWE 1L TTP all risk groups: Weibull\n2\nModel settings\ndd_surv_cur\nScenario\nEffectiveness settings\ni_sun_RWE_1L_TTP_all_sc\nScenario_1\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_surv_cur\nBase case\nEffectiveness settings\ni_sun_RWE_1L_TTP_all_sc\nBase case\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n32\nCabozantinib RWE 2L All risk PFS: Generalised gamma\n2\nModel settings\ndd_surv_cur\nScenario\nEffectiveness settings\ni_cabo_RWE_2L_PFS_all_sc\nScenario_1\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_surv_cur\nBase case\nEffectiveness settings\ni_cabo_RWE_2L_PFS_all_sc\nBase case\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n33\nCabozantinib RWE 2L All risk PFS: Weibull\n2\nModel settings\ndd_surv_cur\nScenario\nEffectiveness settings\ni_cabo_RWE_2L_PFS_all_sc\nScenario_2\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_surv_cur\nBase case\nEffectiveness settings\ni_cabo_RWE_2L_PFS_all_sc\nBase case\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n34\nCabozantinib RWE 2L All risk TTP: Weibull\n2\nModel settings\ndd_surv_cur\nScenario\nEffectiveness settings\ni_cabo_RWE_2L_TTP_all_sc\nScenario_1\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_surv_cur\nBase case\nEffectiveness settings\ni_cabo_RWE_2L_TTP_all_sc\nBase case\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n35\nCabozantinib RWE 3L All risk PFS: Generalised gamma\n2\nModel settings\ndd_surv_cur\nScenario\nEffectiveness settings\ni_cabo_RWE_3L_PFS_all_sc\nScenario_1\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_surv_cur\nBase case\nEffectiveness settings\ni_cabo_RWE_3L_PFS_all_sc\nBase case\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n36\nCabozantinib RWE 3L All risk PFS: Weibull\n2\nModel settings\ndd_surv_cur\nScenario\nEffectiveness settings\ni_cabo_RWE_3L_PFS_all_sc\nScenario_2\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_surv_cur\nBase case\nEffectiveness settings\ni_cabo_RWE_3L_PFS_all_sc\nBase case\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n37\nCabozantinib RWE 3L All risk TTP: Log-logistic\n2\nModel settings\ndd_surv_cur\nScenario\nEffectiveness settings\ni_cabo_RWE_3L_TTP_all_sc\nScenario_1\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_surv_cur\nBase case\nEffectiveness settings\ni_cabo_RWE_3L_TTP_all_sc\nBase case\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n38\nCabozantinib RWE 3L All risk TTP: Generalised gamma\n2\nModel settings\ndd_surv_cur\nScenario\nEffectiveness settings\ni_cabo_RWE_3L_TTP_all_sc\nScenario_2\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_surv_cur\nBase case\nEffectiveness settings\ni_cabo_RWE_3L_TTP_all_sc\nBase case\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n39\n4L PPS pooled BSC\n2\nModel settings\ndd_surv_cur\nScenario\nEffectiveness settings\ni_4L_PPS_pooled_BSC\nScenario_1\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_surv_cur\nBase case\nEffectiveness settings\ni_4L_PPS_pooled_BSC\nBase case\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nCosts/RDI\n40\nNumber of administrations for fixed duration treatments based on-Mean number of administrations\n1\nModel settings\ndd_no_of_admin_options\nMean no of admin\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_no_of_admin_options\nUse TTD\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n41\nAll RDI to 100%\n3\nResource use and costs\ndd_sc_RDI\nSet all RDI to 100%\nResource use and costs\ndd_txt_line_drug_cost\n2L\nModel settings\ndd_lenv_sc_2pills\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nResource use and costs\ndd_sc_RDI\nBase case\nResource use and costs\ndd_txt_line_drug_cost\n2L\nModel settings\ndd_lenv_sc_2pills\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n42\nRDI proportions based on RWE\n2\nResource use and costs\ndd_sc_RDI\nRDI per RWE\nResource use and costs\ndd_txt_line_drug_cost\n2L\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nResource use and costs\ndd_sc_RDI\nBase case\nResource use and costs\ndd_txt_line_drug_cost\n2L\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n43\nAssume effectiveness of Pem+Len same as Nivo+cabo, with alternative RDI\n2\nModel settings\ndd_pemlen_equal\nYes\nResource use and costs\ndd_sc_RDI\nAlternative RDI_all\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_model_struct\nState transition\nModel settings\ndd_alt_RDI_nivo_ST\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n44\nAssume effectiveness of Pem+Len same as Nivo+cabo, without alternative RDI\n1\nModel settings\ndd_pemlen_equal\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_model_struct\nState transition\nModel settings\ndd_alt_RDI_nivo_PartSA\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n45\nApply all alternative RDI (state transition)\n3\nResource use and costs\ndd_sc_RDI\nAlternative RDI_all\nResource use and costs\ndd_txt_line_drug_cost\n2L\nModel settings\ndd_model_struct\nState transition\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nResource use and costs\ndd_sc_RDI\nBase case\nResource use and costs\ndd_txt_line_drug_cost\n2L\nModel settings\ndd_model_struct\nState transition\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNA\n46\nApply alternative RDI for IO combinations (state transition)\n3\nResource use and costs\ndd_sc_RDI\nAlternative RDI_IO_TKI\nResource use and costs\ndd_txt_line_drug_cost\n2L\nModel settings\ndd_model_struct\nState transition\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nResource use and costs\ndd_sc_RDI\nBase case\nResource use and costs\ndd_txt_line_drug_cost\n2L\nModel settings\ndd_model_struct\nState transition\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNA\n47\nApply all alternative RDI (PartSA)\n3\nResource use and costs\ndd_sc_RDI\nAlternative RDI_all\nResource use and costs\ndd_txt_line_drug_cost\n2L\nModel settings\ndd_model_struct\nPartitioned survival\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nResource use and costs\ndd_sc_RDI\nBase case\nResource use and costs\ndd_txt_line_drug_cost\n2L\nModel settings\ndd_model_struct\nState transition\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNA\n48\nApply alternative RDI for IO combinations (PartSA)\n3\nResource use and costs\ndd_sc_RDI\nAlternative RDI_IO_TKI\nResource use and costs\ndd_txt_line_drug_cost\n2L\nModel settings\ndd_model_struct\nPartitioned survival\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nResource use and costs\ndd_sc_RDI\nBase case\nResource use and costs\ndd_txt_line_drug_cost\n2L\nModel settings\ndd_model_struct\nState transition\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nUtilities\n49\nCheckMate 9ER for 1L\n1\nUtilities\ndd_util_scenarios\nTrial utilities for 1L\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nUtilities\ndd_util_scenarios\nBase case\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nNo\n\n\nNA\n50\nCheckMate 9ER for all lines (state transition)\n3\nUtilities\ndd_util_scenarios\nTrial utilities for all lines\nModel settings\ndd_ageadjuutilities\nYes\nModel settings\ndd_model_struct\nState transition\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nUtilities\ndd_util_scenarios\nBase case\nModel settings\ndd_ageadjuutilities\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nNo\n\n\nNA\n51\nCheckMate 9ER for all lines (PartSA)\n3\nUtilities\ndd_util_scenarios\nTrial utilities for all lines\nModel settings\ndd_ageadjuutilities\nYes\nModel settings\ndd_model_struct\nPartitioned survival\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNA\n52\nCheckMate 9ER for all lines with no age adjustment (state transition)\n3\nUtilities\ndd_util_scenarios\nTrial utilities for all lines\nModel settings\ndd_ageadjuutilities\nNo\nModel settings\ndd_model_struct\nState transition\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nUtilities\ndd_util_scenarios\nBase case\nModel settings\ndd_ageadjuutilities\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNA\n53\nCheckMate 9ER for all lines with no age adjustment (PartSA)\n3\nUtilities\ndd_util_scenarios\nTrial utilities for all lines\nModel settings\ndd_ageadjuutilities\nNo\nModel settings\ndd_model_struct\nPartitioned survival\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNA\n54\nSame PFS and PD utilities from 2L onwards\n1\nUtilities\ndd_util_scenarios\nSame PFS and PD utilities from 2L onwards\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nUtilities\ndd_util_scenarios\nBase case\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nNo\n\n\nNA\n55\nHigher proportional decrease for 3L and 4L\n1\nUtilities\ndd_util_scenarios\nHigher proportional decrease for 3L and 4L\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nUtilities\ndd_util_scenarios\nBase case\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nNo\n\n\nNA\n56\nBSC utility same as progression free: current line\n1\nUtilities\ndd_BSC_util_scenarios\nAssume same as progression free: current line\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nUtilities\ndd_BSC_util_scenarios\nAssume same as progressed: current line\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nNo\n\n\nNA\n57\nBSC utility same as final health state\n1\nUtilities\ndd_BSC_util_scenarios\nAssume same as final health state\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nUtilities\ndd_BSC_util_scenarios\nAssume same as progressed: current line\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nNo\n\n\nAEs\n58\nData source used for AEs-Individual trials\n1\nSafety parameters\ndd_incl_NMA_AEs\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nSafety parameters\ndd_incl_NMA_AEs\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n59\nAEs applied-Per cycle\n1\nSafety parameters\ndd_apply_AE_options\nPer cycle\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nSafety parameters\ndd_apply_AE_options\none-off\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n60\nAE disutilities not considered\n1\nUtilities\ndd_util_scenarios\nAE disutilities not considered\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nUtilities\ndd_util_scenarios\nBase case\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nNo\n\n\nNA\n61\nDouble AE impact\n1\nModel settings\ndd_double_AE_impact\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_double_AE_impact\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n62\nAssume AE impact of axi same as tivo\n1\nModel settings\ndd_AE_impact_axi_equal_tivo\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_AE_impact_axi_equal_tivo\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nSub txts\n63\nSubsequent treatment data source-Trial\n1\nTreatment sequence\ndd_sub_txt_prop_sources\nTrial data\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nTreatment sequence\ndd_sub_txt_prop_sources\nRWE\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNo\nNo\n\n\n% prior IO adjuvant\n64\nPercentage of eligible patients receiving adjuvant pem-20%\n3\nPatient characteristics\ndd_udadj\nYes\nPatient characteristics\ni_ui_prop_prior_IO_RWE\n0.2\nModel settings\ndd_adjforprioradjuvant\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nPatient characteristics\ndd_udadj\nNo\nPatient characteristics\ni_ui_prop_prior_IO_RWE\n0\nModel settings\ndd_adjforprioradjuvant\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nNA\n65\nPercentage of eligible patients receiving adjuvant pem-65%\n3\nPatient characteristics\ndd_udadj\nYes\nPatient characteristics\ni_ui_prop_prior_IO_RWE\n0.65\nModel settings\ndd_adjforprioradjuvant\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nPatient characteristics\ndd_udadj\nNo\nPatient characteristics\ni_ui_prop_prior_IO_RWE\n0\nModel settings\ndd_adjforprioradjuvant\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\nPem+lenv inputs\n66\nPem+lenv assumed to have same RDI as nivo+cabo;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPH NMA used for all 1st line treatments\n2\nModel settings\ndd_pemLen_RDI_eq_nivoCabo\nYes\nModel settings\ndd_use_PHnma_for_Fpnma\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_pemLen_RDI_eq_nivoCabo\nNo\nModel settings\ndd_use_PHnma_for_Fpnma\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nYes\nYes\n\n\n\n\nTime horizon\n67\nTime horizon = 5 years (state transition)\n3\nModel settings\nui_time_horizon\n5\nModel settings\ndd_model_struct\nState transition\nModel settings\nR_max_trt_lines\n4\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\nui_time_horizon\n40\nModel settings\ndd_model_struct\nState transition\nModel settings\nR_max_trt_lines\n4\nNA\nNA\nNA\nNA\nNA\nNA\nNo\nNo\n\n\nNA\n68\nTime horizon = 10 years (state transition)\n3\nModel settings\nui_time_horizon\n10\nModel settings\ndd_model_struct\nState transition\nModel settings\nR_max_trt_lines\n4\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\nui_time_horizon\n40\nModel settings\ndd_model_struct\nState transition\nModel settings\nR_max_trt_lines\n4\nNA\nNA\nNA\nNA\nNA\nNA\nNo\nNo\n\n\nNA\n69\nTime horizon = 20 years (state transition)\n3\nModel settings\nui_time_horizon\n20\nModel settings\ndd_model_struct\nState transition\nModel settings\nR_max_trt_lines\n4\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\nui_time_horizon\n40\nModel settings\ndd_model_struct\nState transition\nModel settings\nR_max_trt_lines\n4\nNA\nNA\nNA\nNA\nNA\nNA\nNo\nNo\n\n\nNA\n70\nTime horizon = 5 years (PartSA)\n3\nModel settings\nui_time_horizon\n5\nModel settings\ndd_model_struct\nPartitioned survival\nModel settings\nR_max_trt_lines\n4\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\nui_time_horizon\n40\nModel settings\ndd_model_struct\nState transition\nModel settings\nR_max_trt_lines\n4\nNA\nNA\nNA\nNA\nNA\nNA\nNo\nNo\n\n\nNA\n71\nTime horizon = 10 years (PartSA)\n3\nModel settings\nui_time_horizon\n10\nModel settings\ndd_model_struct\nPartitioned survival\nModel settings\nR_max_trt_lines\n4\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\nui_time_horizon\n40\nModel settings\ndd_model_struct\nState transition\nModel settings\nR_max_trt_lines\n4\nNA\nNA\nNA\nNA\nNA\nNA\nNo\nNo\n\n\nNA\n72\nTime horizon = 20 years (PartSA)\n3\nModel settings\nui_time_horizon\n20\nModel settings\ndd_model_struct\nPartitioned survival\nModel settings\nR_max_trt_lines\n4\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\nui_time_horizon\n40\nModel settings\ndd_model_struct\nState transition\nModel settings\nR_max_trt_lines\n4\nNA\nNA\nNA\nNA\nNA\nNA\nNo\nNo\n\n\nEfficacy-TTNT\n73\nUsing TTNT data as a proxy for PFS for nivo+ipi\n1\nModel settings\ndd_nivoipiPFS\nTTNT\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNA\n74\nUsing TTNT data as a proxy for PFS for nivo+ipi and PH NMA\n2\nModel settings\ndd_nivoipiPFS\nTTNT\nModel settings\ndd_use_PHnma_for_Fpnma\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nDosing Lenv source\n75\nUsing estimates from NHSE for the proportion of patients using each long-term dose of lenvatinib within pembrolizumab plus lenvatinib\n1\nModel settings\ndd_lenv_dose_source\nNHSE\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nImpact of prior TKI\n76\nImpact of prior TKI on effectiveness included\n1\nModel settings\ndd_priorTKIimpact\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nCompany scenarios\n77\nC1:1L treatment efficacy: proportional hazards NMA for all treatments\n1\nModel settings\ndd_cabo_nivo_outcome_from\nPH_NMA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNA\n78\nC2:Limit to 2 lines of treatment\n3\nModel settings\ndd_cabo_nivo_outcome_from\nPH_NMA\nModel settings\ndd_model_struct\nState transition\nModel settings\nR_max_trt_lines\n2\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNA\n79\nC3:Time on treatment, TTD=PFS\n4\nModel settings\ndd_cabo_nivo_outcome_from\nPH_NMA\nModel settings\ndd_model_struct\nState transition\nModel settings\nR_max_trt_lines\n2\nModel settings\ndd_TTD_same_as_PFS\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNA\n80\nC4:Data source used for AEs-Individual trials\n5\nModel settings\ndd_cabo_nivo_outcome_from\nPH_NMA\nModel settings\ndd_model_struct\nState transition\nModel settings\nR_max_trt_lines\n2\nModel settings\ndd_TTD_same_as_PFS\nYes\nSafety parameters\ndd_incl_NMA_AEs\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNA\n81\nC5:RDIs informed by company’s alternative RDIs\n6\nModel settings\ndd_cabo_nivo_outcome_from\nPH_NMA\nModel settings\ndd_model_struct\nState transition\nModel settings\nR_max_trt_lines\n2\nModel settings\ndd_TTD_same_as_PFS\nYes\nSafety parameters\ndd_incl_NMA_AEs\nNo\nModel settings\ndd_RDI_new_bc\nCompany value\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNA\n82\nC6:1L treatment efficacy: proportional hazards NMA for all treatments, PartSA\n2\nModel settings\ndd_cabo_nivo_outcome_from\nPH_NMA\nModel settings\ndd_model_struct\nPartitioned survival\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNA\n83\nC7: Limit to 2 lines of treatment, PartSA\n3\nModel settings\ndd_cabo_nivo_outcome_from\nPH_NMA\nModel settings\ndd_model_struct\nPartitioned survival\nModel settings\ndd_PartSA_2_lines\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNA\n84\nC8:Time on treatment, TTD=PFS, PartSA\n4\nModel settings\ndd_cabo_nivo_outcome_from\nPH_NMA\nModel settings\ndd_model_struct\nPartitioned survival\nModel settings\ndd_PartSA_2_lines\nYes\nModel settings\ndd_TTD_same_as_PFS\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNA\n85\nC9:Data source used for AEs-Individual trials, PartSA\n5\nModel settings\ndd_cabo_nivo_outcome_from\nPH_NMA\nModel settings\ndd_model_struct\nPartitioned survival\nModel settings\ndd_PartSA_2_lines\nYes\nModel settings\ndd_TTD_same_as_PFS\nYes\nSafety parameters\ndd_incl_NMA_AEs\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNA\n86\nC10:RDIs informed by company’s alternative RDIs, PartSA\n6\nModel settings\ndd_cabo_nivo_outcome_from\nPH_NMA\nModel settings\ndd_model_struct\nPartitioned survival\nModel settings\ndd_PartSA_2_lines\nYes\nModel settings\ndd_TTD_same_as_PFS\nYes\nSafety parameters\ndd_incl_NMA_AEs\nNo\nModel settings\ndd_RDI_new_bc\nCompany value\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNew scenarios following ACM\n87\n2 pills for penm+lenv\n1\nModel settings\ndd_lenv_sc_2pills\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_lenv_sc_2pills\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNA\n88\napplying the NMA results for the all-risk NMA to the favourable risk reference curve\n1\nModel settings\ndd_apply_allrisk_NMA_to_favrisk\nYes\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nModel settings\ndd_apply_allrisk_NMA_to_favrisk\nNo\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\n\n\nNA\n89\ncompany approach to utilities\n1\nUtilities\ndd_util_scenarios\n% PFS to PD drop in base case applied to 9ER (1L)\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nUtilities\ndd_util_scenarios\nBase case\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA\nNA",
    "crumbs": [
      "Scenario analysis"
    ]
  }
]